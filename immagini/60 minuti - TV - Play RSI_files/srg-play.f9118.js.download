"use strict";$.ajaxSetup({cache:!0}),Number.prototype.toHMMSS=function(){var seconds=Math.floor(this),hours=Math.floor(seconds/3600);seconds-=3600*hours;var minutes=Math.floor(seconds/60);seconds-=60*minutes;var timestring="";return hours>0&&(timestring=timestring+hours+":"),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),timestring+minutes+":"+seconds},String.prototype.contains=function(string){return-1!=this.indexOf(string)};var namedQueries={small_retina:"only screen and (min-width: 1px) and (-webkit-min-device-pixel-ratio: 2),only screen and (min-width: 1px) and (min--moz-device-pixel-ratio: 2),only screen and (min-width: 1px) and (-o-min-device-pixel-ratio: 2/1),only screen and (min-width: 1px) and (min-device-pixel-ratio: 2),only screen and (min-width: 1px) and (min-resolution: 192dpi),only screen and (min-width: 1px) and (min-resolution: 2dppx)",medium_retina:"only screen and (min-width: 639px) and (-webkit-min-device-pixel-ratio: 2),only screen and (min-width: 639px) and (min--moz-device-pixel-ratio: 2),only screen and (min-width: 639px) and (-o-min-device-pixel-ratio: 2/1),only screen and (min-width: 639px) and (min-device-pixel-ratio: 2),only screen and (min-width: 639px) and (min-resolution: 192dpi),only screen and (min-width: 639px) and (min-resolution: 2dppx)",large_retina:"only screen and (min-width: 976px) and (-webkit-min-device-pixel-ratio: 2),only screen and (min-width: 976px) and (min--moz-device-pixel-ratio: 2),only screen and (min-width: 976px) and (-o-min-device-pixel-ratio: 2/1),only screen and (min-width: 976px) and (min-device-pixel-ratio: 2),only screen and (min-width: 976px) and (min-resolution: 192dpi),only screen and (min-width: 976px) and (min-resolution: 2dppx)",xlarge_retina:"only screen and (min-width: 1276px) and (-webkit-min-device-pixel-ratio: 2),only screen and (min-width: 1276px) and (min--moz-device-pixel-ratio: 2),only screen and (min-width: 1276px) and (-o-min-device-pixel-ratio: 2/1),only screen and (min-width: 1276px) and (min-device-pixel-ratio: 2),only screen and (min-width: 1276px) and (min-resolution: 192dpi),only screen and (min-width: 1276px) and (min-resolution: 2dppx)"},app=angular.module("srg-play",["ui.date","ui.router","ngAria","ngCookies","ngStorage","ngResource","ngSanitize","ngActivityIndicator","angularSmoothscroll","ngDropdowns","mm.foundation.interchange","vcRecaptcha","monospaced.elastic","debounce","srgPlayConfig","srg-play.features","srg-play.scrollOffsetRestoration"]);function portalConfig($rootScope,$window,SRGConfig,$state){var portalConfig={};portalConfig.currentSubPortalBasePath="/play/"+SRGConfig.currentSubPortal,portalConfig.isOutsideCurrentSubportal=function(newUrl){var location=$window.location,port=location.port.length>0?":".concat(location.port):"",protocol=location.protocol.length>0?"".concat(location.protocol,"//"):"",subPortalBasePath="".concat(protocol).concat(location.hostname).concat(port).concat(portalConfig.currentSubPortalBasePath);return newUrl.indexOf(subPortalBasePath)<0},portalConfig.isPortalRouteOutsideCurrentSubPortal=function(route){return!route.abstract&&route.url&&route.url.indexOf(portalConfig.currentSubPortalBasePath)<0},portalConfig.isNotFoundUrl=function(url){return notFound&&decodeURI(url).contains(notFound.url)};var portalRoutes=$state.get(),portalRoutesOutsideCurrentSubPortal=portalRoutes.filter(portalConfig.isPortalRouteOutsideCurrentSubPortal),notFound=portalRoutes.filter(function(route){return"notFound"===route.name})[0];return portalConfig.isInPortalRoutesOutsideCurrentSubPortal=function(newUrl){var isInPortalRoutes=!1;return portalRoutesOutsideCurrentSubPortal.forEach(function(routePath){var routeRegex=new RegExp(routePath.url.replace(/:[-a-zA-Z0-9]+/g,"[-a-zA-Z0-9]+").replace(/\//g,"\\/"));newUrl.search(routeRegex)>=0&&(isInPortalRoutes=!0)}),isInPortalRoutes},$rootScope.$on("$locationChangeStart",function(event,newUrl){!portalConfig.isOutsideCurrentSubportal(newUrl)||portalConfig.isInPortalRoutesOutsideCurrentSubPortal(newUrl)||portalConfig.isNotFoundUrl(newUrl)||(event.preventDefault(),$window.location.assign(newUrl))}),portalConfig}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}angular.module("srg-play.features",[]),app.config(["$interpolateProvider",function($interpolateProvider){$interpolateProvider.startSymbol("[{["),$interpolateProvider.endSymbol("]}]")}]),app.config(["$ariaProvider",function($ariaProvider){$ariaProvider.config({ariaHidden:!0,ariaChecked:!1,ariaDisabled:!1,ariaRequired:!1,ariaInvalid:!1,ariaMultiline:!1,ariaValue:!1,tabindex:!1,bindKeydown:!0})}]),app.config(["$animateProvider",function($animateProvider){$animateProvider.classNameFilter(/angular-animate/)}]),app.config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|itpc):/),$compileProvider.debugInfoEnabled(!1)}]),app.config(["$localStorageProvider",function($localStorageProvider){try{$localStorageProvider.setKeyPrefix("");var moduleMeasurementKeyContent=$localStorageProvider.get("srf:analytics:mod");$localStorageProvider.remove("srf:analytics:mod"),$localStorageProvider.setKeyPrefix("playSRG-"),$localStorageProvider.set("srf:analytics:mod",moduleMeasurementKeyContent)}catch(e){$localStorageProvider.remove("srf:analytics:mod"),$localStorageProvider.setKeyPrefix("playSRG-")}}]),app.config(["$sessionStorageProvider",function($sessionStorageProvider){$sessionStorageProvider.setKeyPrefix("playSRG-")}]),app.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("personalizationRequestInterceptor")}]),app.config(["$urlMatcherFactoryProvider",function($urlMatcherFactoryProvider){$urlMatcherFactoryProvider.strictMode(!1)}]),app.config(["$uiViewScrollProvider",function($uiViewScrollProvider){$uiViewScrollProvider.useAnchorScroll()}]),app.run(["interchangeQueriesManager",function(interchangeQueriesManager){interchangeQueriesManager.add("small_retina",namedQueries.small_retina),interchangeQueriesManager.add("medium_retina",namedQueries.medium_retina),interchangeQueriesManager.add("large_retina",namedQueries.large_retina),interchangeQueriesManager.add("xlarge_retina",namedQueries.xlarge_retina)}]),app.run(["$rootScope","$anchorScroll",function($rootScope,$anchorScroll){$rootScope.$on("$locationChangeSuccess",function(event,newLocation){newLocation.indexOf("#")>=0?$anchorScroll():document.body.scrollTop=document.documentElement.scrollTop=0})}]),app.run(["$state",function($state){$state.defaultErrorHandler(function(){$state.go("errorPage")})}]),app.run(["$rootScope","$window","SRGConfig","$state",portalConfig]),$(document).foundation("interchange",{named_queries:namedQueries}),function(global){global.browserSupport=global.browserSupport||{},global.browserSupport.supportsHistoryApi=global.history&&history.pushState,global.browserSupport.supportsHistoryApi}(window),angular.module("srg-play.scrollOffsetRestoration",["ngStorage"]).run(["$rootScope","$window","$location","$timeout","$sessionStorage",function($rootScope,$window,$location,$timeout,$sessionStorage){$rootScope.$watch(function(){return $location.path()},function(newLocation){$rootScope.actualLocation===newLocation?$timeout(function(){$window.scrollTo(0,$sessionStorage.pageOffset),delete $sessionStorage.pageOffset}):$sessionStorage.pageOffset=$window.pageYOffset}),$rootScope.$on("$locationChangeSuccess",function(){$rootScope.actualLocation=$location.path()})}]),function(){function abroadSettings(localStoreFactory){return localStoreFactory.getStoreEntry("abroadSettings")}angular.module("srg-play.features").factory("abroadSettings",abroadSettings),abroadSettings.$inject=["localStoreFactory"]}(),function(){function AssetDownloadController($scope,localStoreFactory,localStoreKeys){var userSettingsStore,downloadUrl;function setDownloadUrl(url){downloadUrl=url}function acceptTACAndStartDownload(){var link;userSettingsStore.acceptedDownloadTAC=!0,$scope.showStandardDownloadButton=!0,link=angular.element("<a>").attr("href",downloadUrl).attr("target","_blank").attr("download",""),angular.element(document.body).append(link),link.get(0).click()}$scope.showStandardDownloadButton=!0,!0!==(userSettingsStore=localStoreFactory.getStoreEntry(localStoreKeys.userSettings)).acceptedDownloadTAC&&($scope.showStandardDownloadButton=!1,$scope.acceptTACAndStartDownload=acceptTACAndStartDownload,$scope.setDownloadUrl=setDownloadUrl)}angular.module("srg-play.features").controller("AssetDownloadController",AssetDownloadController),AssetDownloadController.$inject=["$scope","localStoreFactory","localStoreKeys"]}(),function(){function assetSharesRequestService(UrlPatternResolver,PlayJSONWebservice){return{request:function(assetId,assetType){return assetSharesUrl=function(assetId,assetType){return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SOCIAL_SHARES,{id:assetId,assetType:assetType})}(assetId,assetType),PlayJSONWebservice.getResource(assetSharesUrl).get().$promise;var assetSharesUrl}}}angular.module("srg-play.features").factory("assetSharesRequestService",assetSharesRequestService),assetSharesRequestService.$inject=["UrlPatternResolver","PlayJSONWebservice"]}(),function(){function AssetToShareSelectionStrategy(SocialCountStates){return function(currentPlayingAsset){if(currentPlayingAsset){var assetToShare=currentPlayingAsset;return SocialCountStates.CURRENT_STATE===SocialCountStates.FULL_LENGTH_SHARING&&isFullLengthSet(currentPlayingAsset)?assetToShare=currentPlayingAsset.fullLength:SocialCountStates.CURRENT_STATE===SocialCountStates.START_TIME_SHARING&&isFullLengthSet(currentPlayingAsset)&&function(assetToShare){return assetToShare.isVideo===assetToShare.fullLength.isVideo}(currentPlayingAsset)&&currentPlayingAsset.isPlayBackContextFullLength&&(assetToShare=currentPlayingAsset.fullLength),assetToShare}};function isFullLengthSet(asset){return asset&&asset.fullLength&&asset.fullLength.assetId&&""!==asset.fullLength.assetId}}angular.module("srg-play.features").factory("AssetToShareSelectionStrategy",AssetToShareSelectionStrategy),AssetToShareSelectionStrategy.$inject=["SocialCountStates"]}(),function(){function EmbedFormularController($scope,SRGConfig,segments,UrlPatternResolver,SocialCountStates,AssetToShareSelectionStrategy){var assetToEmbed,currentPlayingSegment,assetStartTime=0;function startTimeLinkAndEmbedUpdate(startTime){var time;assetStartTime=startTime,time=startTime,setAbsoluteLink(),$scope.absoluteLink+="&startTime="+time,function(startTime){changeEmbedCode(assetToEmbed,startTime)}(startTime)}function setAbsoluteLink(){$scope.absoluteLink=assetToEmbed.url||$scope.absoluteLink}function setEmbedCode(){changeEmbedCode(assetToEmbed)}function changeEmbedCode(assetToEmbed,time){var urn=(assetToEmbed=assetToEmbed||{}).urn||"",title=assetToEmbed.title||"";time=time||0,void 0===$scope.iframeWidthValue&&($scope.iframeWidthValue=assetToEmbed.isVideo?624:392),void 0===$scope.iframeHeightValue&&($scope.iframeHeightValue=assetToEmbed.isVideo?351:58);var iframeWidth=$scope.iframeWidthValue||"",iframeHeight=$scope.iframeHeightValue||"",params={urn:urn,startTime:time},embedCode="<iframe src='"+UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.EMBEDPLAYERURL,params)+"' allowfullscreen width='"+iframeWidth+"' height='"+iframeHeight+"' frameborder='0' name='"+title+'\' allow="geolocation *; autoplay; encrypted-media"></iframe>';$scope.embedIframe=embedCode}$scope.embedIframe=SRGConfig.sharedPortal.embed.embedCode||"",$scope.absoluteLink=SRGConfig.sharedPortal.embed.absoluteLink||"",$scope.selectTextOnClick=function($event){$event.target.select()},$scope.changeIframeSize=function(){assetToEmbed&&changeEmbedCode(assetToEmbed)},SocialCountStates.onSharingStateChange(function(state){currentPlayingSegment&&(assetToEmbed=AssetToShareSelectionStrategy(currentPlayingSegment),state===SocialCountStates.START_TIME_SHARING?startTimeLinkAndEmbedUpdate(assetStartTime):(setAbsoluteLink(),setEmbedCode()))}),SocialCountStates.onSharingStartTimeChange(function(startTime){startTimeLinkAndEmbedUpdate(startTime)}),segments.onSegmentChanged(function(segment){(currentPlayingSegment=segment||{})&&(assetToEmbed=AssetToShareSelectionStrategy(currentPlayingSegment)),setAbsoluteLink(),setEmbedCode()})}angular.module("srg-play.features").controller("EmbedFormularController",EmbedFormularController),EmbedFormularController.$inject=["$scope","SRGConfig","segments","UrlPatternResolver","SocialCountStates","AssetToShareSelectionStrategy"]}(),function(){function mailFormController(_,$scope,$attrs,$http,$timeout,segments,SocialCountStates,SocialInteractionToggleStates,AssetToShareSelectionStrategy,vcRecaptchaService){var captchaId,captchaResponse,currentSegment,assetToSend={};function setCaptchaId(id){captchaId=id}function setCaptchaRespone(response){captchaResponse=response,$scope.captchaResponseIsSet=!0}function reloadCaptcha(){$scope.captchaResponseIsSet=!1,vcRecaptchaService.reload(captchaId)}function sendMail(isFormValid){isFormValid&&function(){$scope.mailError=!1,$scope.mailSuccess=!1;var params={id:assetToSend.assetId||$attrs.id,startTime:SocialCountStates.CURRENT_STATE===SocialCountStates.START_TIME_SHARING?SocialCountStates.startTime:0,senderName:$scope.senderName,email:$scope.email,message:$scope.message,captchaResponse:captchaResponse};$http.post($attrs.url,params).then(sendingMailWasSuccess).catch(invalidCaptchaResponse)}()}function invalidCaptchaResponse(){reloadCaptcha(),$scope.mailError=!0}function sendingMailWasSuccess(){$scope.mailSuccess=!0,$timeout(function(){SocialInteractionToggleStates.showSendFormular=!1,delete $scope.email,delete $scope.message,delete $scope.senderName,$scope.mailError=!1,$scope.mailSuccess=!1,$scope.mailForm.$setPristine(),reloadCaptcha()},6e3)}function updateCurrentSegment(newSegment){currentSegment=newSegment}function updateAssetToSend(){currentSegment&&(assetToSend=AssetToShareSelectionStrategy(currentSegment))}$scope.mailError=!1,$scope.mailSuccess=!1,$scope.captchaResponseIsSet=!1,$scope.sendMail=sendMail,$scope.setCaptchaId=setCaptchaId,$scope.setCaptchaResponse=setCaptchaRespone,$scope.reloadCaptcha=reloadCaptcha,SocialCountStates.onSharingStateChange(updateAssetToSend),segments.onSegmentChanged(_.pipe(updateCurrentSegment,updateAssetToSend))}angular.module("srg-play.features").controller("mailFormController",mailFormController),mailFormController.$inject=["_","$scope","$attrs","$http","$timeout","segments","SocialCountStates","SocialInteractionToggleStates","AssetToShareSelectionStrategy","vcRecaptchaService"]}(),angular.module("srg-play.features").controller("SendFormularController",["$scope","$attrs","$http","$timeout","SocialInteractionToggleStates","segments","SocialCountStates","AssetToShareSelectionStrategy",function($scope,$attrs,$http,$timeout,SocialInteractionToggleStates,segments,SocialCountStates,AssetToShareSelectionStrategy){var assetToSend,currentSegment;function updateAssetToSend(){assetToSend=AssetToShareSelectionStrategy(currentSegment)}$scope.formSubmitted=!1,$scope.captchaIsInvalid=!1,$scope.showSendMailErrorMessage=!1,$scope.showSendMailSuccessMessage=!1,$scope.message="",$scope.submitFormular=function(form){$("#recaptcha_response_field").removeClass("ng-invalid"),$scope.formSubmitted=!0,form.$invalid||(SocialCountStates.CURRENT_STATE===SocialCountStates.START_TIME_SHARING?$scope.sendVideoFormular(SocialCountStates.startTime):$scope.sendVideoFormular(0))},$scope.sendVideoFormular=function(time){$scope.captchaIsInvalid=!1,$scope.showSendMailErrorMessage=!1;var params={sendmedia_id:assetToSend.assetId||$attrs.id,sendmedia_startposition:time,sendmedia_name:$scope.fullName,sendmedia_receiver:$scope.email,sendmedia_text:$scope.message,recaptcha_challenge_field:$("#recaptcha_challenge_field ").val(),recaptcha_response_field:$scope.captchaResponse};$http.get($attrs.action,{method:"GET",params:params}).success(function(data,status,headers,config){$scope.showSendMailSuccessMessage=!0,$("#succesMessageSendFormular .mail_theirs").text($scope.email),$timeout(function(){SocialInteractionToggleStates.showSendFormular=!1,$scope.showSendMailSuccessMessage=!1,$scope.fullName="",$scope.email="",$scope.message="",$scope.captchaResponse="",$scope.captchaIsInvalid=!1,$scope.formSubmitted=!1,$scope.sendForm.$setPristine(),Recaptcha.reload()},1e4)}).error(function(data,status,headers,config){Recaptcha.reload(),400==status?$scope.captchaIsInvalid=!0:$scope.showSendMailErrorMessage=!0,$("#recaptcha_response_field").addClass("ng-invalid")})},segments.onSegmentChanged(function(metadata){currentSegment=metadata,updateAssetToSend()}),SocialCountStates.onSharingStateChange(function(){updateAssetToSend()})}]),function(){function sharingService(userId,postRequestService,sharingServiceStorage){return function(sharingServiceName,assetTrackingUrlGenerator){var sharingStorage=sharingServiceStorage(sharingServiceName);return{share:function(assetMetadata){sharingStorage.wasSharedBefore(assetMetadata.assetId)||(!function(assetMetadata){postRequestService(assetTrackingUrlGenerator(assetMetadata.assetId),function(eventData){var payload={eventData:eventData},id=userId.get();id&&(payload.userId=id);return payload}(assetMetadata.eventData))}(assetMetadata),sharingStorage.safeAsShared(assetMetadata.assetId))}}}}angular.module("srg-play.features").factory("sharingService",sharingService),sharingService.$inject=["userId","postRequestService","sharingServiceStorage"]}(),function(){function SharingService(OpenUrlInPopUpService,CookieService,postRequestService,userId,trackingPayloadGenerator){return function(sharingServiceName,popupWidth,popupHeight){return{name:sharingServiceName,popupWidth:popupWidth,popupHeight:popupHeight,shareCount:0,share:function(popupUrl,countUrl,assetId,shareCountCallback){popupUrl&&this.openInPopup(popupUrl),this.alreadyShared(assetId)||(this.shareCount+=1,this.countSocialInteraction(countUrl),this.addIdToCookie(assetId)),"function"==typeof shareCountCallback&&shareCountCallback(this.shareCount)},alreadyShared:function(assetId){return-1!==this.getSharedAssetIdsFromCookie().indexOf(assetId)},addIdToCookie:function(assetId){var idsInCookie=this.getSharedAssetIdsFromCookie();idsInCookie.push(assetId),CookieService.setCookieValue(this.name,idsInCookie)},getSharedAssetIdsFromCookie:function(){var cookie=CookieService.getCookieValue(this.name);return cookie?cookie.split(","):[]},openInPopup:function(url){OpenUrlInPopUpService.openCentered(url,this.popupWidth,this.popupHeight)},countSocialInteraction:function(countUrl){postRequestService(countUrl,function(){var payload={},id=userId.get();id&&(payload.userId=id);return trackingPayloadGenerator.addAssetDataToPayload(payload),payload}())}}}}angular.module("srg-play.features").factory("SharingService",SharingService),SharingService.$inject=["OpenUrlInPopUpService","CookieService","postRequestService","userId","trackingPayloadGenerator"]}(),function(){function sharingServiceStorage(CookieService){return function(sharingServiceName){return{safeAsShared:function(assetId){if(!wasSharedBefore(assetId)){var idsInCookie=getSharedAssetIdsFromCookie();idsInCookie.push(assetId),CookieService.setCookieValue(sharingServiceName,idsInCookie)}},wasSharedBefore:wasSharedBefore};function wasSharedBefore(assetId){return-1!==getSharedAssetIdsFromCookie().indexOf(assetId)}function getSharedAssetIdsFromCookie(){var cookie=CookieService.getCookieValue(sharingServiceName);return cookie?cookie.split(","):[]}}}angular.module("srg-play.features").factory("sharingServiceStorage",sharingServiceStorage),sharingServiceStorage.$inject=["CookieService"]}(),function(){function SocialCountController($scope,SharingService,GetRequestService,UrlPatternResolver,segments,SeoStringGenerator,SRGConfig,SocialCountStates,AssetToShareSelectionStrategy){var currentPlayingAsset,currentAssetId,faceBookShareUrl="",twitterShareUrl="",whatsAppShareUrl="",seoStringGenerator=new SeoStringGenerator,srgViews=SharingService("srgViews"),srgLikes=SharingService("srgLikes"),facebook=SharingService("facebookShares",630,400),twitter=SharingService("twitterShares",630,400),whatsApp=SharingService("whatAppShares",630,400),aggregatedViewCounts=SRGConfig.sharedPortal.detailPage.assetSetViewcount,assetToShare={assetId:SRGConfig.sharedPortal.detailPage.assetId,title:SRGConfig.sharedPortal.detailPage.assetTitle,groupTitle:SRGConfig.sharedPortal.detailPage.groupTitle};function updateSocialShareUrls(metadata,includeStartTime){var additionalParams;if(metadata){includeStartTime&&(additionalParams={startTime:SocialCountStates.startTime});var encodedRedirectUrl,title,encodedTitle,urlParams=function(metadata){return{title:getSeoString(metadata.title),groupTitle:getSeoString(metadata.groupTitle),id:metadata.assetId}}(metadata),detailUrl=resolveUrlPattern(UrlPatternResolver.DETAIL,urlParams,additionalParams),detailRedirectUrl=resolveUrlPattern(UrlPatternResolver.REDIRECT,{id:metadata.assetId},additionalParams),encodedDetailUrl=encodeURIComponent(detailUrl);!function(detailUrl){faceBookShareUrl=resolveUrlPattern(UrlPatternResolver.FACEBOOKSHARE,{url:detailUrl})}(encodedDetailUrl),function(detailUrl,title){var shortTitle=function(title){title.length>96&&(title=title.substr(0,93)+"...");return encodeURIComponent(title)}(title),twitterParams={url:detailUrl,via:SRGConfig.sharedPortal.socialSharing.twitterName,text:shortTitle};twitterShareUrl=resolveUrlPattern(UrlPatternResolver.TWITTERSHARE,twitterParams)}(encodedDetailUrl,metadata.title),encodedRedirectUrl=encodeURIComponent(detailRedirectUrl),title=metadata.title,encodedTitle=encodeURIComponent(title),whatsAppShareUrl=resolveUrlPattern(UrlPatternResolver.WHATSAPPSHARE,{url:encodedRedirectUrl,title:encodedTitle})}}function getAndUpdateViewCounts(metadata){GetRequestService(resolveUrlPattern(UrlPatternResolver.SHAREGET,{id:metadata.assetId}),function(data){metadata.isFullLength&&(data.srgViews=aggregatedViewCounts||data.srgViews),function(data){var parsedViews=parseInt(data.srgViews),parsedLikes=parseInt(data.srgLikes);srgViews.shareCount=isNaN(parsedViews)?0:parsedViews,srgLikes.shareCount=isNaN(parsedLikes)?0:parsedLikes,$scope.shares.srgViews=0===srgViews.shareCount?"":srgViews.shareCount,$scope.shares.srgLikes=0===srgLikes.shareCount?"":srgLikes.shareCount}(data)})}function updateAssetToShare(sharingState){if(currentPlayingAsset){assetToShare=AssetToShareSelectionStrategy(currentPlayingAsset);var includeStartTime=sharingState===SocialCountStates.START_TIME_SHARING;updateSocialShareUrls(assetToShare,includeStartTime)}}function shareOnSocialMedia(serviceName,sharingService,popupUrl){var countUrl=resolveUrlPattern(UrlPatternResolver.SHARECOUNT,{assetId:assetToShare.assetId,serviceName:serviceName});sharingService.share(popupUrl,countUrl,assetToShare.assetId)}function resolveUrlPattern(urlType,urlParamObject,additionalParams){return UrlPatternResolver.resolveUrlPattern(urlType,urlParamObject,additionalParams)}function getSeoString(url){return seoStringGenerator.getSeoString(url)}currentPlayingAsset=assetToShare,getAndUpdateViewCounts(assetToShare),updateSocialShareUrls(assetToShare),SocialCountStates.onSharingStateChange(function(sharingState){updateAssetToShare(sharingState)}),SocialCountStates.onSharingStartTimeChange(function(time){updateSocialShareUrls(assetToShare,time)}),$scope.shares={srgViews:"",srgLikes:""},segments.onSegmentChanged(function(metadata){currentPlayingAsset=metadata,updateAssetToShare(SocialCountStates.CURRENT_STATE),currentAssetId!==currentPlayingAsset.assetId&&getAndUpdateViewCounts(metadata),currentAssetId=currentPlayingAsset.assetId}),$scope.srgLike=function(){var asset=currentPlayingAsset,countUrl=resolveUrlPattern(UrlPatternResolver.LIKECOUNT,{assetId:asset.assetId});srgLikes.share("",countUrl,asset.assetId,function(count){$scope.shares.srgLikes=count})},$scope.shareOnFacebook=function(){shareOnSocialMedia("facebook",facebook,faceBookShareUrl)},$scope.shareOnTwitter=function(){shareOnSocialMedia("twitter",twitter,twitterShareUrl)},$scope.shareOnWhatsApp=function(){shareOnSocialMedia("whatsapp",whatsApp,whatsAppShareUrl)},$scope.shareByEmail=function(){},$scope.shareByEmbed=function(){},$scope.addAssetToMaRTS=function(){},$scope.downloadAsset=function(){}}angular.module("srg-play.features").controller("SocialCountController",SocialCountController),SocialCountController.$inject=["$scope","SharingService","GetRequestService","UrlPatternResolver","segments","SeoStringGenerator","SRGConfig","SocialCountStates","AssetToShareSelectionStrategy"]}(),function(){function SocialCountStateSelectionController($scope,SocialCountStates,segments,technicalPlayerService){var callback,timeUpdateFunction=null;function selectFullLengthSharing(){$scope.fullLengthSharingSelected||(activateFullLengthSharing(),SocialCountStates.selectFullLengthSharing())}function selectSegmentSharing(){$scope.segmentSharingSelected||(activateSegmentSharing(),SocialCountStates.selectSegmentSharing())}function selectStartTimeSharing(){$scope.startTimeSharingSelected||(technicalPlayerService.pause(),activateStartTimeSharing(),SocialCountStates.selectStartTimeSharing())}function changeActiveSharingOption(state){state===SocialCountStates.FULL_LENGTH_SHARING?activateFullLengthSharing():state===SocialCountStates.SEGMENT_SHARING?activateSegmentSharing():state===SocialCountStates.START_TIME_SHARING&&activateStartTimeSharing()}function updateAvailableSharingOptions(metadata){$scope.segmentSharingAvailable=!isCurrentSegmentFullLength(metadata),isCurrentSegmentFullLength(metadata)&&$scope.segmentSharingSelected&&$scope.selectFullLengthSharing()}function isCurrentSegmentFullLength(metadata){return metadata.isFullLength}function activateFullLengthSharing(){$scope.fullLengthSharingSelected=!0,$scope.segmentSharingSelected=!1,$scope.startTimeSharingSelected=!1,disablePlayerTimeSync()}function activateSegmentSharing(){$scope.segmentSharingAvailable&&($scope.segmentSharingSelected=!0,$scope.fullLengthSharingSelected=!1,$scope.startTimeSharingSelected=!1,disablePlayerTimeSync())}function activateStartTimeSharing(){$scope.startTimeSharingSelected=!0,$scope.fullLengthSharingSelected=!1,$scope.segmentSharingSelected=!1,function(){if(timeUpdateFunction)return;timeUpdateFunction=function(timeInSeconds){var time;time=timeInSeconds.toHMMSS(),$scope.$evalAsync(function(){$scope.currentTime=time}),SocialCountStates.setStartTime(timeInSeconds)},technicalPlayerService.getCurrentTime(timeUpdateFunction),technicalPlayerService.registerTimeUpdateCallback(timeUpdateFunction)}()}function disablePlayerTimeSync(){timeUpdateFunction&&(technicalPlayerService.unregisterTimeChangeCallback(),timeUpdateFunction=null)}$scope.fullLengthSharingSelected=!0,$scope.segmentSharingSelected=!1,$scope.segmentSharingAvailable=!0,$scope.startTimeSharingSelected=!1,$scope.currentTime="-",$scope.selectFullLengthSharing=selectFullLengthSharing,$scope.selectSegmentSharing=selectSegmentSharing,$scope.selectStartTimeSharing=selectStartTimeSharing,callback=changeActiveSharingOption,SocialCountStates.onSharingStateChange(callback),function(callback){segments.onSegmentChanged(callback)}(updateAvailableSharingOptions)}angular.module("srg-play.features").controller("SocialCountStateSelectionController",SocialCountStateSelectionController),SocialCountStateSelectionController.$inject=["$scope","SocialCountStates","segments","technicalPlayerService"]}(),function(){function SocialCountStates(segments){var $self=this,sharingChangeCallbacks=[],sharingStartTimeChangeCallbacks=[];function triggerSharingStateChangeCallbacks(response){$self.CURRENT_STATE=response,sharingChangeCallbacks.forEach(function(callback){callback(response)})}return segments.onSegmentChanged(function(newSegment){newSegment.isPlayBackContextFullLength?$self.selectFullLengthSharing():$self.selectSegmentSharing()}),this.START_TIME_SHARING="startTimeSharing",this.FULL_LENGTH_SHARING="fullLengthSharing",this.SEGMENT_SHARING="segmentSharing",this.CURRENT_STATE=$self.FULL_LENGTH_SHARING,this.startTime=0,this.onSharingStateChange=function(callback){sharingChangeCallbacks.push(callback)},this.onSharingStartTimeChange=function(callback){sharingStartTimeChangeCallbacks.push(callback)},this.selectFullLengthSharing=function(){triggerSharingStateChangeCallbacks($self.FULL_LENGTH_SHARING)},this.selectSegmentSharing=function(){triggerSharingStateChangeCallbacks($self.SEGMENT_SHARING)},this.selectStartTimeSharing=function(){triggerSharingStateChangeCallbacks($self.START_TIME_SHARING)},this.setStartTime=function(startTime){var time,state;state=$self.START_TIME_SHARING,$self.CURRENT_STATE!==state||function(startTime){return $self.startTime===startTime}(startTime)||($self.startTime=startTime,time=startTime,sharingStartTimeChangeCallbacks.forEach(function(callback){callback(time)}))},this}angular.module("srg-play.features").service("SocialCountStates",SocialCountStates),SocialCountStates.$inject=["segments"]}(),function(){function SocialSharingController($scope,$attrs,sharingService,UrlPatternResolver,segments,SocialCountStates,assetSharesRequestService,AssetToShareSelectionStrategy,maRTSPlaylist,URI){var currentPlayingAsset,assetToShare,assetType,srgLike,twitter,facebook,whatsApp;function buildSharingService(serviceName){return sharingService(serviceName,function(assetId){return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SOCIAL_SHARE_TRACKING,{id:assetId,assetType:assetType,service:serviceName})})}function likeAsset(){srgLike.share(currentPlayingAsset),updateSocialCounts(currentPlayingAsset)}function shareOnFacebook(){facebook.share(assetToShare)}function shareOnTwitter(){twitter.share(assetToShare)}function shareOnWhatsApp(){whatsApp.share(assetToShare)}function shareByEmail(){}function shareByEmbed(){}function trackAssetDownload(){}function updateAssetToShare(playingAsset,sharingState){assetToShare=AssetToShareSelectionStrategy(playingAsset);var includeStartTime=sharingState===SocialCountStates.START_TIME_SHARING;updateSocialSharingUrls(assetToShare,includeStartTime)}function setScopeSocialCounts(data){$scope.views=0===data.srgView?"":data.srgView,$scope.likes=0===data.srgLike?"":data.srgLike}function updateSocialSharingUrls(assetMetadata,includeStartTime){if(assetMetadata){var additionalSharingUrlParams={};includeStartTime&&(additionalSharingUrlParams={startTime:SocialCountStates.startTime});var encodedRedirectUrl,title,encodedTitle,detailUrl=function(){if(!assetMetadata.url)return;return new URI(assetMetadata.url).addQuery(additionalSharingUrlParams).toString()}(),detailRedirectUrl=resolveUrlPattern(UrlPatternResolver.REDIRECT,{id:assetMetadata.assetId},additionalSharingUrlParams),encodedDetailUrl=encodeURIComponent(detailUrl);$scope.facebookShareUrl=function(detailUrl){return resolveUrlPattern(UrlPatternResolver.FACEBOOKSHARE,{url:detailUrl})}(encodedDetailUrl),$scope.twitterShareUrl=function(detailUrl,title){var shortTitle=function(title){var twitterShareText=title;title.length>96&&(twitterShareText=title.substr(0,93)+"...");return encodeURIComponent(twitterShareText)}(title),twitterParams={url:detailUrl,via:$attrs.twitterName,text:shortTitle};return resolveUrlPattern(UrlPatternResolver.TWITTERSHARE,twitterParams)}(encodedDetailUrl,assetMetadata.title),$scope.whatsAppShareUrl=(encodedRedirectUrl=encodeURIComponent(detailRedirectUrl),title=assetMetadata.title,encodedTitle=encodeURIComponent(title),resolveUrlPattern(UrlPatternResolver.WHATSAPPSHARE,{url:encodedRedirectUrl,title:encodedTitle}))}}function updateSocialCounts(assetMetadata){assetSharesRequestService.request(assetMetadata.assetId,assetType).then(setScopeSocialCounts)}function resolveUrlPattern(urlType,urlParamObject,additionalParams){return UrlPatternResolver.resolveUrlPattern(urlType,urlParamObject,additionalParams)}$scope.views="",$scope.likes="",$scope.twitterShareUrl=null,$scope.facebookShareUrl=null,$scope.whatsAppShareUrl=null,srgLike=sharingService("srgLikes",function(assetId){return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SOCIAL_LIKE_TRACKING,{id:assetId,assetType:assetType})}),facebook=buildSharingService("facebook"),twitter=buildSharingService("twitter"),whatsApp=buildSharingService("whatsapp"),$scope.likeAsset=likeAsset,$scope.shareByEmail=shareByEmail,$scope.shareByEmbed=shareByEmbed,$scope.trackAssetDownload=trackAssetDownload,$scope.shareOnFacebook=shareOnFacebook,$scope.shareOnTwitter=shareOnTwitter,$scope.shareOnWhatsApp=shareOnWhatsApp,assetToShare={assetId:"",title:"",groupTitle:""},assetType=$attrs.assetType,currentPlayingAsset=assetToShare,SocialCountStates.onSharingStateChange(function(sharingState){updateAssetToShare(currentPlayingAsset,sharingState)}),SocialCountStates.onSharingStartTimeChange(function(){updateSocialSharingUrls(assetToShare,!0)}),$scope.showSharingOptions=!1,segments.onSegmentChanged(function(assetMetadata){$scope.showSharingOptions=!0,currentPlayingAsset=assetMetadata,updateSocialCounts(assetMetadata),updateAssetToShare(currentPlayingAsset,SocialCountStates.CURRENT_STATE)})}angular.module("srg-play.features").controller("SocialSharingController",SocialSharingController),SocialSharingController.$inject=["$scope","$attrs","sharingService","UrlPatternResolver","segments","SocialCountStates","assetSharesRequestService","AssetToShareSelectionStrategy","maRTSPlaylist","URI"]}(),angular.module("srg-play.features").service("SocialInteractionToggleStates",function(){this.showEmbedFormular=!1,this.showSendFormular=!1}).controller("SocialInteractionsToggleController",["$scope","SocialInteractionToggleStates",function($scope,SocialInteractionToggleStates){$scope.showShareDialog=!1,$scope.toggleShareDialog=function(){$scope.showShareDialog=!$scope.showShareDialog},$scope.socialElements=!1,$scope.toggleSocialElements=function(){$scope.socialElements=!$scope.socialElements},$scope.showEmbedFormular=function(){return SocialInteractionToggleStates.showEmbedFormular},$scope.toggleEmbedFormular=function(){SocialInteractionToggleStates.showEmbedFormular=!SocialInteractionToggleStates.showEmbedFormular,SocialInteractionToggleStates.showSendFormular=!1,$(".buttonImgEmbed").trigger("blur")},$scope.showSendFormular=function(){return SocialInteractionToggleStates.showSendFormular},$scope.toggleSendFormular=function(){SocialInteractionToggleStates.showSendFormular=!SocialInteractionToggleStates.showSendFormular,SocialInteractionToggleStates.showEmbedFormular=!1,$(".buttonImgEmail").trigger("blur")}}]),function(){function userHistoryTracker(videoHistoryUpdater,watchTimeObserver){return{startTracking:function(){watchTimeObserver.setupTechnicalPlayerEventCallbacks(),videoHistoryUpdater.startUpdatingHistory()},stopTracking:function(){videoHistoryUpdater.stopUpdatingHistory()}}}angular.module("srg-play.features").factory("userHistoryTracker",userHistoryTracker),userHistoryTracker.$inject=["videoHistoryUpdater","watchTimeObserver"]}(),function(){function datePicker(moment,$timeout){return{restrict:"E",template:'<div class="datePickerOverlay"><div ui-date="dateOptions"></div></div>',scope:{config:"="},link:function(scope,element){scope.dateOptions=function(datePickerConfig,element,scope){var localTimeToSwissTimeOffsetInMinutes=moment().utcOffset()-60;return{firstDay:1,dateFormat:"dd-mm-yy",maxDate:moment().subtract(localTimeToSwissTimeOffsetInMinutes,"minutes").toDate(),showOtherMonths:!0,selectOtherMonths:!0,defaultDate:datePickerConfig.defaultDate||moment().format("DD-MM-YYYY"),monthNames:datePickerConfig.months,dayNamesMin:datePickerConfig.weekdays,prevText:datePickerConfig.previousMonth,nextText:datePickerConfig.nextMonth,onSelect:function(dateString){scope.$apply(function(){datePickerConfig.onSelect({dateString:dateString})})},onChangeMonthYear:function(){configureDatePickerMarkup(datePickerConfig,element)}}}(scope.config,element,scope),function(config,element){$timeout(function(){configureDatePickerMarkup(config,element)})}(scope.config,element)}};function configureDatePickerMarkup(config,element){config.configureMarkup&&config.configureMarkup(element),$timeout(function(){element.find(".ui-datepicker-prev").attr("href","#").attr("onclick","return false;"),element.find(".ui-datepicker-next").not(".ui-state-disabled").attr("href","#").attr("onclick","return false;")})}}angular.module("srg-play.features").directive("datePicker",datePicker),datePicker.$inject=["moment","$timeout"]}(),function(){function datePicker(moment,$timeout){var dateFormat="dd-mm-yy";return{restrict:"E",template:'\n        <div class="datePickerOverlay">\n          <div ui-date="dateOptions"\n            ng-model="dateModel"\n            ui-date-format="'.concat(dateFormat,'">\n          </div>\n        </div>'),scope:{config:"=",dateModel:"=?",onSelect:"&",beforeShowDay:"&"},link:function(scope,element){scope.dateModel||(scope.dateModel=moment(scope.config.defaultDate,"DD-MM-YYYY").toDate()),scope.dateOptions=function(datePickerConfig,element,scope){return{firstDay:1,dateFormat:dateFormat,minDate:datePickerConfig.minDate,maxDate:(localTimeToSwissTimeOffsetInMinutes=moment().utcOffset()-60,moment().subtract(localTimeToSwissTimeOffsetInMinutes,"minutes").toDate()),showOtherMonths:!0,selectOtherMonths:!0,defaultDate:datePickerConfig.defaultDate||moment().format("DD-MM-YYYY"),monthNames:datePickerConfig.months,dayNamesMin:datePickerConfig.weekdays,prevText:datePickerConfig.previousMonth,nextText:datePickerConfig.nextMonth,onSelect:function(dateString){scope.onSelect({dateString:dateString})},onChangeMonthYear:function(){modifyUiDatepickerElements(element)},beforeShowDay:function(date){var defaultDayConfig=[!0,"",""];return scope&&scope.beforeShowDay&&scope.beforeShowDay({date:date})||defaultDayConfig}};var localTimeToSwissTimeOffsetInMinutes}(scope.config||{},element,scope),modifyUiDatepickerElements(element)}};function modifyUiDatepickerElements(element){$timeout(function(){element.find(".ui-datepicker-prev").attr("href","#").attr("onclick","return false;"),element.find(".ui-datepicker-next").not(".ui-state-disabled").attr("href","#").attr("onclick","return false;")})}}angular.module("srg-play.features").directive("datePickerWithModel",datePicker),datePicker.$inject=["moment","$timeout"]}(),function(){function datePickerWrapper($compile){return{restrict:"E",template:'<div on-escape="visibility = false;"><date-picker config="datePickerSettings" /></div>',scope:{config:"@",onSelect:"&",requestToday:"&",requestYesterday:"&",visibility:"=?"},controller:["$scope","$attrs",function($scope,$attrs){var config,scope,datePickerConfig=$scope.$eval($attrs.config);$scope.datePickerSettings=(scope=$scope,(config=datePickerConfig).onSelect=scope.onSelect,config.configureMarkup=function(scope,datePickerConfig){return function(datePickerElement){!function(datePickerElement,datePickerConfig,scope){var jqueryUiDatePicker=datePickerElement.find(".ui-datepicker");datePickerElement.find(".yesterdayButton").length||function(scope,datePickerConfig){return $compile('<button class="datePickerButton yesterdayButton" ng-click="requestYesterday()">'+datePickerConfig.yesterday+"</button>"+function(buttonText){return'<button class="datePickerButton todayButton" ng-click="requestToday()">'+buttonText+"</button>"}(datePickerConfig.today))(scope)}(scope,datePickerConfig).insertBefore(jqueryUiDatePicker)}(datePickerElement,datePickerConfig,scope)}}(scope,config),config)}]}}angular.module("srg-play.features").directive("datePickerWrapper",datePickerWrapper),datePickerWrapper.$inject=["$compile"]}(),function(){function appearActiveForRoutes($transitions){return{restrict:"A",link:function(scope,element,attrs){attrs.appearActiveForRoutes.split(",").forEach(function(routeName){$transitions.onEnter({to:routeName},function(){element.addClass(attrs.appearActiveClass)}),$transitions.onStart({from:routeName},function(){element.removeClass(attrs.appearActiveClass)}),$transitions.onBefore({from:"errorPage"},function(){element.removeClass(attrs.appearActiveClass)})})}}}angular.module("srg-play.features").directive("appearActiveForRoutes",appearActiveForRoutes),appearActiveForRoutes.$inject=["$transitions"]}(),function(){function routeContent(_,$document,angularElement,peachService,translator){var podcastFeedLink;return{restrict:"E",scope:{config:"=",translations:"="},link:{pre:function(scope,element,attrs){translator.add(scope.translations)},post:function(scope,element,attrs){var newMetadata,metadata,title;newMetadata=scope.config.metaInformation,title=newMetadata.pageTitle,$document.find(".currentSubNavigationTitle").html(title),function(title){$document[0].title=title}(newMetadata.title),metadata=newMetadata,_.keys(metadata).forEach(function(key){var metaTag=$document.find('meta[name="'+key+'"]');metaTag.attr("content",metadata[key])}),peachService.sendPageView(scope.config.tracking.peach.isActive),function(metadata){metadata.podcastFeedUrl&&(podcastFeedLink=angularElement('<link rel="alternate" type="application/rss+xml" title="'.concat(metadata.pageTitle,'" href="').concat(metadata.podcastFeedUrl,'"/>')),$document.find("head").prepend(podcastFeedLink))}(scope.config.metaInformation),scope.$on("$destroy",function(){return function(element){element.find(".hasDatepicker").datepicker("destroy"),$document.find(".hasDatepicker").datepicker("refresh"),podcastFeedLink&&podcastFeedLink.detach()}(element)})}}}}angular.module("srg-play.features").directive("routeContent",routeContent),routeContent.$inject=["_","$document","angularElement","peachService","translator"]}(),function(){function uiViewLoader($transitions){return{restrict:"E",template:'<div class="loadingContainer loadingContainer--big" ng-show="viewLoading" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div><ui-view ng-hide="viewLoading" autoscroll="true"></ui-view>',link:function(scope,element,attrs){scope.viewLoading=!0,$transitions.onSuccess({},function(){scope.viewLoading=!1}),$transitions.onBefore({},function(){scope.viewLoading=!0})}}}angular.module("srg-play.features").directive("uiViewLoader",uiViewLoader),uiViewLoader.$inject=["$transitions"]}(),function(){function srgDateModelEnhancer(moment){return{restrict:"A",require:"ngModel",scope:{maxDate:"=?",displayDateFormat:"@?",prependWeekdays:"<",todayLabel:"@?",yesterdayLabel:"@?",weekdayLabels:"<"},link:function(scope,element,attrs,ngModel){var displayFormat=scope.displayDateFormat||"DD.MM.YYYY";locale=moment.locale(),weekdayDateFormat="dd, "+displayFormat,moment.updateLocale(locale,{weekdaysMin:scope.weekdayLabels,calendar:{sameDay:"["+scope.todayLabel+"], "+displayFormat,nextDay:weekdayDateFormat,lastDay:"["+scope.yesterdayLabel+"], "+displayFormat,nextWeek:weekdayDateFormat,lastWeek:weekdayDateFormat,sameElse:weekdayDateFormat}}),ngModel.$formatters.push(toDisplayDate),ngModel.$parsers.push(function(dateString){if(dateString){var parsedDate=moment.utc(dateString,displayFormat).toDate();return isNaN(parsedDate)?void ngModel.$setValidity("date",!1):(ngModel.$setValidity("date",!0),parsedDate)}}),scope.maxDate&&(ngModel.$validators.maxDate=function(date){return moment(date).isBefore(moment(scope.maxDate))});var locale,weekdayDateFormat;function toDisplayDate(dateObject){if(dateObject&&dateObject instanceof Date)return ngModel.$setValidity("date",!0),scope.prependWeekdays?moment(dateObject).calendar(moment()):moment(dateObject).format(displayFormat)}element.on("blur",function(){var dateObject;dateObject=ngModel.$modelValue,ngModel.$setViewValue(toDisplayDate(dateObject)),ngModel.$render()})}}}angular.module("srg-play.features").directive("srgDateModelEnhancer",srgDateModelEnhancer),srgDateModelEnhancer.$inject=["moment"]}(),function(){function dateSelector(moment,$compile){return{restrict:"E",scope:{dateModel:"=?",config:"=",onSubmit:"&",calendarToggle:"=?",hideNextPrevDayButtons:"<",prependWeekdays:"<"},link:function(scope,element){scope.maxDate=moment().utcOffset(60).toDate(),function(scope,element){var template='\n<form name="form" ng-submit="submit()" class="dateSelector__form" autocomplete="off">\n    <button\n        class="dataSelector__previousDayButton iconImg iconImgArrowLeftSmall"\n        aria-label="[{[config.previousDay]}]"\n        ng-click="previousDay()"\n        ng-hide="hideNextPrevDayButtons"\n        type="button"\n    ></button>\n    <div>\n        <div class="dateSelector__inputWrapper" ng-show="!showNativeDateInput">\n            <input\n              class="dateSelector__input"\n              aria-label="[{[config.ariaLabels.openCalendar]}]"\n              max-date="maxDate"\n              novalidate\n              spellcheck="false"\n              srg-date-model-enhancer\n              display-date-format="[{[config.displayDateFormat]}]"\n              prepend-weekdays="prependWeekdays"\n              today-label="[{[config.today]}]"\n              yesterday-label="[{[config.yesterday]}]"\n              weekday-labels="config.weekdays"\n              ng-focus="onInputFocus()"\n              ng-blur="onInputBlur()"\n              ng-change="onInputChange()"\n              ng-model="dateModel"\n              ng-model-options="{ timezone: \'UTC\', updateOn: \'default blur\', debounce: {default: 250, blur: 0} }"\n            />\n            <button class="dateSelector__calendarButton" ng-click="focusInput()" aria-hidden="true" type="button">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M18.222 7.333H5.778v10.111h12.444V7.334zM5.778 17.513c0-.078 0-.107.005-.114.038.042.018.045-.04.045h.035v.07zm.044-.08c0-.005-.01-.014-.023-.025-.008-.008-.013-.013-.016-.009l.039.035zm13.1-11.655c.403 0 .615.04.863.336a.883.883 0 0 1 .207.5c.007.073.008.114.008.238v10.661c0 .136 0 .19-.004.262-.01.23-.041.419-.125.607a1.015 1.015 0 0 1-.949.618H5.564C4.84 19 4 18.233 4 17.513V6.878c0-.548.37-.875.846-1.013.223-.065.458-.087.718-.087h13.358z"/><path d="M5.342 11.056c-.43 0-.778-.274-.778-.612 0-.337.349-.61.778-.61h12.882c.43 0 .778.273.778.61 0 .338-.348.612-.778.612H5.342zM6.556 5A.778.778 0 1 1 8.11 5v1.556a.778.778 0 0 1-1.555 0V5zM15.889 5a.778.778 0 0 1 1.555 0v1.556a.778.778 0 1 1-1.555 0V5z"/><path d="M7.687 13.556a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.195 0 .354.16.354.354v.848c0 .194-.16.354-.354.354h-.848zM12.424 13.556h-.848a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.194 0 .354.16.354.354v.848c0 .194-.16.354-.354.354M16.313 13.556h-.848a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.194 0 .354.16.354.354v.848c0 .194-.16.354-.354.354"/></g></svg>\n            </button>\n            <button type="submit" class="dateSelector__submitButton" ng-class="{ \'dateSelector__submitButton-active\': inputFocus }" ng-disabled="form.$invalid || form.$pristine"></button>\n        </div>\n        <div class="dateSelector__errorWrapper" ng-show="form.$invalid">\n            <div class="dateSelector__error" ng-show="form.$error.parse">[{[config.errorMessages.invalid]}]</div>\n            <div class="dateSelector__error" ng-show="form.$error.maxDate">[{[config.errorMessages.maxDate]}]</div>\n        </div>\n    </div>\n    <button\n        class="dataSelector__nextDayButton iconImg iconImgArrowRightSmall"\n        aria-label="[{[config.nextDay]}]"\n        ng-click="nextDay()"\n        ng-disabled="currentDateIsMaxDate"\n        ng-hide="hideNextPrevDayButtons"\n        type="button"\n    ></button>\n</form>';element.append($compile(template)(scope))}(scope,element),scope.dateModel||(scope.dateModel=moment.utc(scope.config.defaultDate,"DD-MM-YYYY").toDate());function setPristine(){scope.form.$setPristine()}scope.lastKnownValidDate=scope.dateModel,scope.$watch("dateModel",function(newVal,oldVal){newVal||(scope.lastKnownValidDate=oldVal),newVal&&"dateSelector-input"!==newVal.changedBy&&setPristine(),scope.currentDateIsMaxDate=moment.utc(newVal).add(1,"day").isAfter(scope.maxDate)}),scope.submit=function(){setPristine(),scope.onSubmit({dateString:moment.utc(scope.dateModel).format("DD-MM-YYYY")})},scope.previousDay=function(){scope.dateModel=moment.utc(scope.dateModel).subtract(1,"day").toDate(),scope.submit()},scope.nextDay=function(){scope.dateModel=moment.utc(scope.dateModel).add(1,"day").toDate(),scope.submit()},scope.onInputChange=function(){scope.dateModel&&(scope.dateModel.changedBy="dateSelector-input")},scope.onInputFocus=function(){var inputWidth,input;scope.inputFocus=!0,scope.toggleCalendar(),inputWidth=element.find(".dateSelector__inputWrapper").outerWidth(),element.find(".dateSelector__errorWrapper").css("maxWidth",inputWidth),(input=element.find(".dateSelector__input")[0]).setSelectionRange(0,input.value.length)},scope.onInputBlur=function(){scope.inputFocus=!1,scope.form.$invalid&&(scope.dateModel=scope.lastKnownValidDate),scope.form.$dirty&&scope.submit()},scope.focusInput=function(){element.find(".dateSelector__input").focus()},scope.toggleCalendar=function(){"function"==typeof scope.calendarToggle?scope.calendarToggle():scope.calendarToggle=!scope.calendarToggle}}}}angular.module("srg-play.features").directive("dateSelector",dateSelector),dateSelector.$inject=["moment","$compile"]}(),function(){angular.module("srg-play.features").component("srgGeneralInformation",{template:'\n        <div class="general-information general-information--hidden" ng-class="{ \'general-information--hidden\': $ctrl.hidden }">\n          <div class="general-information__message">\n            <span>\n              <span tabindex="0">{{ $ctrl.message }}</span>\n              <a class="general-information__link" ng-if="$ctrl.url" ng-href="{{ $ctrl.url }}">{{ $ctrl.showMoreText }}</a>\n            </span>\n            <a tabindex="0" ng-click="$ctrl.close()" aria-label="{{ $ctrl.closeText }}">\n              <span class="iconImg iconImgCloseLight" />\n            </a>\n          </div>\n        </div>\n      ',bindings:{showMoreText:"<",closeText:"<"},controller:["localStoreFactory","localStoreKeys","PlayJSONWebservice",function(localStoreFactory,localStoreKeys,PlayJSONWebservice){var vm=this;vm.hidden=!0;var store=localStoreFactory.getStoreEntry(localStoreKeys.generalInformationMessages);function handleResponse(data){data&&data.text&&(vm.message=data.text,vm.id=data.id,vm.url=data.url,vm.hidden=store.closed.indexOf(vm.id)>=0)}store.closed=store.closed||[],vm.$onInit=function(){PlayJSONWebservice.getResource("/play/general-information").get(handleResponse)},vm.close=function(){store.closed.push(vm.id),vm.hidden=!0}}]})}(),function(){function generalNavigationBarController($scope,$attrs,PlayJSONWebservice,$interval,moment){var vm=this,NOW_AND_NEXT_UPDATE_MILLIS=6e4;function getChannelNowAndNextInformation(type,url){return requestNowAndNextInformation(url).then(function(res){return setNowAndNextInformationOnScope(res,type)}).then(function(url,type){$interval(function(){requestNowAndNextInformation(url).then(function(res){return setNowAndNextInformationOnScope(res,type)})},NOW_AND_NEXT_UPDATE_MILLIS)}(url,type)).then(function(type){"tv"===type?vm.tvRequestInProcess=!1:"radio"===type&&(vm.radioRequestInProcess=!1)}(type)).finally(function(){vm.allRequestsFinished=!vm.tvRequestInProcess&&!vm.radioRequestInProcess})}function requestNowAndNextInformation(url){return PlayJSONWebservice.getResource(url,{},{cache:!1}).get().$promise}function setNowAndNextInformationOnScope(res,type){"tv"===type?(vm.tvChannelInfo=res.teaser,function(){var info=vm.tvChannelInfo;if(angular.isUndefined(info)||angular.isUndefined(info.length))return;for(var i=0;i<info.length;i++){var hasNowAndNextItems=info[i].nowAndNext.programItems&&info[i].nowAndNext.programItems[0]&&info[i].nowAndNext.programItems[1];if(hasNowAndNextItems){var startTimeString=info[i].nowAndNext.programItems[0].startTime,endTimeString=info[i].nowAndNext.programItems[1].startTime,startTime=convertTimeStringToMinutes(startTimeString),endTime=convertTimeStringToMinutes(endTimeString),currentHour=moment().hours(),currentMinute=moment().minutes(),currentMinutesInDay=60*currentHour+currentMinute,videoLength=endTime-startTime,currentProgress=currentMinutesInDay-startTime;info[i].nowAndNext.programItems[0].progress=Math.round(100*currentProgress/videoLength)+"%"}}}()):"radio"===type&&(vm.radioChannelInfo=res.overview)}function convertTimeStringToMinutes(string){var timeComponents=string.split(" ").filter(function(component){return component.indexOf(":")>=0})[0].split(":");return 60*parseInt(timeComponents[0])+parseInt(timeComponents[1])}vm.tvNowAndNextUrl=$attrs.tvNowAndNextUrl,vm.radioNowAndNextUrl=$attrs.radioNowAndNextUrl,vm.tvRequestInProcess=!0,vm.radioRequestInProcess=!0,vm.allRequestsFinished=!1,vm.tvChannelInfo={},vm.radioChannelInfo={},getChannelNowAndNextInformation("tv",vm.tvNowAndNextUrl),getChannelNowAndNextInformation("radio",vm.radioNowAndNextUrl)}angular.module("srg-play.features").controller("generalNavigationBarController",generalNavigationBarController),generalNavigationBarController.$inject=["$scope","$attrs","PlayJSONWebservice","$interval","moment"]}(),function(){function generalNavigationBarDirective(generalNavigationBarTrackingService,viewPorts,$window,Modernizr){return{restrict:"E",templateUrl:"play/general-navigation-bar",link:function(scope,element){function handleScreenResize(){scope.isTabletDevice=!isSmallViewPort()&&Modernizr.touch,scope.isSmallViewPort=isSmallViewPort()}function isSmallViewPort(){return viewPorts.getCurrent()===viewPorts.SMALL_TYPE}function hideNavigation(){scope.selectedType=null,scope.touchedItemId=void 0}function trackClick(action,type){generalNavigationBarTrackingService.trackClick(action,type)}scope.selectedType=null,scope.isTouchDevice=Modernizr.touch,scope.isSmallViewPort=!1,scope.touchedItemId=void 0,scope.toggleNavigation=function(type){isSmallViewPort()?function(type){if(type===scope.selectedType)return hideNavigation();"tv"===type?scope.selectedType="tv":"radio"===type&&(scope.selectedType="radio");trackClick("FlyoutOpening",type)}(type):function(type){element.hasClass("scroll-down-hide")&&trackClick("FlyoutOpening",type);element.toggleClass("scroll-up-show scroll-down-hide"),scope.touchedItemId=void 0}(type)},scope.hideNavigation=hideNavigation,scope.showPreview=function(type,object){if(isSmallViewPort()&&Modernizr.touch)return null;!function(type,object){if(!scope.isTouchDevice)return trackClick("LivestreamOpening",type);var channel="radio"===type?JSON.parse(object):object,isSameItem=scope.touchedItemId===channel.id;scope.touchedItemId=channel.id,isSameItem&&trackClick("LivestreamOpening",type);"tv"===type&&isSameItem?$window.location.href=channel.urlToLivePage:"radio"===type&&isSameItem&&($window.open(channel.liveplayerUrl,channel.name,"width=".concat(channel.radioPopupSizeWidth,",\n              height=").concat(channel.radioPopupSizeHeight,",\n              toolbar=0,\n              menubar=0,\n              location=0")),scope.touchedItemId=void 0)}(type,object)},handleScreenResize(),angular.element($window).bind("resize",function(){scope.$apply(handleScreenResize)})}}}angular.module("srg-play.features").directive("generalNavigationBar",generalNavigationBarDirective),generalNavigationBarDirective.$inject=["generalNavigationBarTrackingService","viewPorts","$window","Modernizr"]}(),function(){function generalNavigationBarTrackingService(tcEvents){return{trackClick:function(action,type){tcEvents({id:"hidden_event",data:{event_type:"GeneralNavigationBar",event_name:action,event_value_1:type}})}}}angular.module("srg-play.features").factory("generalNavigationBarTrackingService",generalNavigationBarTrackingService),generalNavigationBarTrackingService.$inject=["tcEvents"]}(),function(){function mediaStageAssets(_,mediaStageGeoblockFilter){return function(assetIdToBeExcluded){var listOfAllTeaser=[];return{all:function(){return mediaStageGeoblockFilter.filter(listOfAllTeaser)},set:function(list){listOfAllTeaser=_.pipe(removeExcludedAssetFromList,addComscoreIndexesToAssets)(list)}};function addComscoreIndexesToAssets(list){return _.addIndex(_.forEach)(function(asset,positionInList){asset.comscoreIndex=positionInList+1},list)}function removeExcludedAssetFromList(list){return assetIdToBeExcluded?_.reject(_.propEq("id",assetIdToBeExcluded),list):list}}}angular.module("srg-play.features").factory("mediaStageAssets",mediaStageAssets),mediaStageAssets.$inject=["_","mediaStageGeoblockFilter"]}(),function(){function MediaStageController($scope,$attrs,$timeout,PlayJSONWebservice,PagedList,viewPorts,mediaStageLayoutFactory,mediaStageTeaserBuilder,mediaStageAssets,mediaStageTeaser,mediaStageLoadMore,angularElement,peachService){var layout,teaserBuilder,pagedList,lastUrlParams,leadingLoadedTeaserId,layoutConfig=$scope.$eval($attrs.config);function showFirstPage(){$scope.teaser.reset(),pagedList=PagedList($scope.requestedAssets.all(),layout.defaultPageSizeForViewPort($scope.currentViewPort),layout.firstPageSizeForViewPort($scope.currentViewPort)),$scope.teaser.visible=buildTeaser(pagedList.getNextPage())}function buildTeaser(assetList){return teaserBuilder.build({assetList:assetList,viewport:$scope.currentViewPort,startIndexForTeaserLayout:$scope.teaser.visible.length})}function loadMore(){$scope.loadMoreButton.clicked();var teaserOfNextPage=buildTeaser(pagedList.getNextPage());if(leadingLoadedTeaserId=teaserOfNextPage[0].id,$scope.teaser.extendVisibleTeaserWith(teaserOfNextPage),!pagedList.isNextPageAvailable()&&$scope.$eval($attrs.includeshowall)){var showAllTeaser=teaserBuilder.buildViewAllTeaser($scope.currentViewPort);$scope.teaser.extendVisibleTeaserWith(showAllTeaser)}$scope.recommendationId&&peachService.sendRecommendationDisplayedLoadMore($scope.recommendationId),$timeout(function(){angularElement('[data-teaser-id="'.concat(leadingLoadedTeaserId,'"]')).find("a")[0].focus()},300)}function shouldLoadMoreBeVisible(){return!$scope.requestInProcess&&pagedList&&pagedList.isNextPageAvailable()}function viewportChangedHandler(viewPort){$scope.$apply(function(){$scope.currentViewPort=viewPort,showFirstPage()})}function requestTeaser(){var url=$attrs.url,urlParams=$scope.$eval($attrs.urlParams);function isUrlStillTheSame(){return url===$attrs.url}$scope.teaser.reset(),$scope.loadMoreButton.reset(),$scope.requestInProcess=!0,$scope.contentAvailable=!0,function(url,urlParams){return PlayJSONWebservice.getResource(url,urlParams).get().$promise}(url,urlParams).then(function(data){isUrlStillTheSame()&&($scope.requestInProcess=!1,$scope.lastResponse=data,$scope.viewCountActive=$scope.$eval($attrs.viewcountactive)&&data.viewCountActive,$scope.requestedAssets.set(data.teaser||[]),$scope.recommendationId=data.recommendationId,$scope.$eval($attrs.onDataLoaded),0===$scope.requestedAssets.all().length&&($scope.contentAvailable=!1),showFirstPage())}).catch(function(error){isUrlStillTheSame()&&($scope.requestInProcess=!1,$scope.contentAvailable=!1)})}function addTeaserFlagToClickedEvent($event,recommendationId){$event&&$event.originalEvent&&($event.originalEvent.srgClickTarget="teaser"),$scope.recommendationId&&peachService.sendRecommendationHit($scope.recommendationId,$event.currentTarget.dataset.teaserId)}$scope.teaser=mediaStageTeaser(),$scope.currentViewPort=viewPorts.getCurrent(),$scope.requestedAssets=mediaStageAssets($attrs.assetidtoberemovedfromlist),$scope.loadMoreButton=mediaStageLoadMore(shouldLoadMoreBeVisible,$attrs.srgmodname),$scope.loadMore=loadMore,$scope.teaserClicked=addTeaserFlagToClickedEvent,layout=mediaStageLayoutFactory(layoutConfig),teaserBuilder=mediaStageTeaserBuilder(layout),viewPorts.callbackForAny(viewportChangedHandler,function(){}),function(){if($attrs.teaser){var predefinedTeaser=$scope.$eval($attrs.teaser);predefinedTeaser&&predefinedTeaser.length&&($scope.contentAvailable=!0,$scope.requestedAssets.set(predefinedTeaser),showFirstPage())}else $attrs.$observe("url",requestTeaser),$attrs.$observe("urlParams",function(){var urlParams=$scope.$eval($attrs.urlParams);(urlParams||lastUrlParams)&&(lastUrlParams=urlParams,requestTeaser())})}()}angular.module("srg-play.features").controller("MediaStageController",MediaStageController),MediaStageController.$inject=["$scope","$attrs","$timeout","PlayJSONWebservice","PagedList","viewPorts","mediaStageLayoutFactory","mediaStageTeaserBuilder","mediaStageAssets","mediaStageTeaser","mediaStageLoadMore","angularElement","peachService"]}(),function(){function mediaStageLayoutFactory(_){return function(viewports){viewports=viewports||[];var defaultOrFallbackPageSize=_.propOr(5,"defaultPageSize"),defaultOrFallbackWidth=_.propOr(0,"teaserWidth"),defaultOrFallbackType=_.propOr("","defaultType"),itemFromList=_.curry(function(listname,index){var find=_.addIndex(_.find);return _.pipe(_.propOr([],listname),find(function(val,idx){return idx===index}))});return{firstPageSizeForViewPort:_.memoize(function(viewPortKey){var findPageSize=_.either(_.prop("firstPageSize"),defaultOrFallbackPageSize);return _.pipe(findViewport(viewPortKey),findPageSize)()}),defaultPageSizeForViewPort:_.memoize(function(viewPortKey){return _.pipe(findViewport(viewPortKey),defaultOrFallbackPageSize)()}),styleForTeaserAtIndex:_.memoize(function(index,viewPortKey){return _.pipe(findViewport(viewPortKey),function(index){return _.either(itemFromList("customTeaserWidths")(index),defaultOrFallbackWidth)}(index),cssWidthObject)()}),styleForShowAllTeaser:_.memoize(function(viewPortKey){return _.pipe(findViewport(viewPortKey),defaultOrFallbackWidth,cssWidthObject)()}),teaserTypeForIndexInViewport:_.memoize(function(index,viewPortKey){return _.pipe(findViewport(viewPortKey),function(index){return _.either(itemFromList("types")(index),defaultOrFallbackType)}(index))()})};function cssWidthObject(widthInPercent){return{width:widthInPercent+"%"}}function findViewport(vpname){return _.pipe(_.always(viewports),_.find(_.propEq("viewport",vpname)),_.defaultTo({}))}}}angular.module("srg-play.features").factory("mediaStageLayoutFactory",mediaStageLayoutFactory),mediaStageLayoutFactory.$inject=["_"]}(),function(){function mediaStageLoadMore(tcEvents){return function(visibilityFunction,moduleName){var loadMoreButton={triggered:!1,shouldBeDisplayed:visibilityFunction,clicked:function(){loadMoreButton.triggered=!0,moduleName&&tcEvents({id:"hidden_event",data:{event_type:moduleName,event_name:"LoadMoreButtonClick"}})},reset:function(){loadMoreButton.triggered=!1}};return loadMoreButton}}angular.module("srg-play.features").factory("mediaStageLoadMore",mediaStageLoadMore),mediaStageLoadMore.$inject=["tcEvents"]}(),function(){function mediaStageTeaser(){return function(){var teaser={visible:[],extendVisibleTeaserWith:function(list){teaser.visible=teaser.visible.concat(list)},reset:function(){teaser.visible=[]}};return teaser}}angular.module("srg-play.features").factory("mediaStageTeaser",mediaStageTeaser),mediaStageTeaser.$inject=[]}(),function(){function mediaStageTeaserBuilder(_){return function(layout){return{build:function(dto){var assetList=(dto=dto||{}).assetList||[],viewport=dto.viewport||"",startIndex=dto.startIndexForTeaserLayout||0;return _.addIndex(_.reduce)(function(models,teaser,teaserIndex){return models.push(function(teaserIndex,teaser){var layout;layout=function(teaser){return"SCHEDULED_LIVESTREAM"===teaser.assetType||teaser.isScheduledLivestream}(teaser)?buildEventLivestreamLayoutObject(teaserIndex,viewport):function(teaser){return teaser.overviewUrl&&void 0===teaser.mediaType&&teaser.isEditorialPick}(teaser)?buildEditorialShowLayoutObject(teaserIndex,viewport):buildLayoutObject(teaserIndex,viewport);return function(layout,teaser){return _.merge(_.clone(teaser),layout)}(layout,teaser)}(startIndex+teaserIndex,teaser)),models})([],assetList)},buildViewAllTeaser:function(viewport){return{type:"viewAll",style:layout.styleForShowAllTeaser(viewport)}}};function buildLayoutObject(index,viewport){return{type:layout.teaserTypeForIndexInViewport(index,viewport),style:layout.styleForTeaserAtIndex(index,viewport)}}function buildEventLivestreamLayoutObject(index,viewport){return{type:"eventLivestream",style:layout.styleForTeaserAtIndex(index,viewport)}}function buildEditorialShowLayoutObject(index,viewport){return{type:layout.teaserTypeForIndexInViewport(index,viewport)+" editorialShowTeaser",style:layout.styleForTeaserAtIndex(index,viewport)}}}}angular.module("srg-play.features").factory("mediaStageTeaserBuilder",mediaStageTeaserBuilder),mediaStageTeaserBuilder.$inject=["_"]}(),function(){function blockReasonDecorator(userLocationFactory,SRGConfig){var userLocation=userLocationFactory();return{restrict:"A",scope:{blockReasonDecorator:"<"},link:function(scope,element,attrs){var teaser=scope.blockReasonDecorator;(function(element,teaser){isActuallyGeoblocked(teaser)&&element.attr("title",(labelKey="geoblock",mediaType="audio"===(mediaType=teaser.mediaType)?"audio":"video",SRGConfig.label.blockReasonHint[labelKey]&&SRGConfig.label.blockReasonHint[labelKey][mediaType]));var labelKey,mediaType})(element,teaser),function(element,teaser){isActuallyGeoblocked(teaser)&&element.addClass("blockReason-geoblock")}(element,teaser)}};function isActuallyGeoblocked(teaser){return userLocation.isAbroad&&!0===teaser.isGeoblocked}}angular.module("srg-play.features").directive("blockReasonDecorator",blockReasonDecorator),blockReasonDecorator.$inject=["userLocationFactory","SRGConfig"]}(),function(){function mediaStageGeoblockFilter(_,abroadSettings,userLocationFactory){return{filter:function(mediaList){if(!mediaList)return[];if(userLocationFactory().isAbroad&&abroadSettings.hideGeoblockedMedia)return _.reject(isGeoblocked,mediaList);return mediaList}};function isGeoblocked(teaser){return!0===teaser.isGeoblocked}}angular.module("srg-play.features").factory("mediaStageGeoblockFilter",mediaStageGeoblockFilter),mediaStageGeoblockFilter.$inject=["_","abroadSettings","userLocationFactory"]}(),function(){function PersonalizationController($scope,PersonalizationSettings,localStoreFactory,localStoreKeys,userId,_){$scope.personalizationActive=PersonalizationSettings.isPersonalizationActive(),$scope.togglePersonalization=_.ifElse(PersonalizationSettings.isPersonalizationActive,function(){PersonalizationSettings.deactivatePersonalization(),$scope.personalizationActive=!1,userId.destroy(),localStoreFactory.deleteStoreEntry(localStoreKeys.videoHistory),localStoreFactory.deleteStoreEntry(localStoreKeys.favShows)},function(){PersonalizationSettings.activatePersonalization(),$scope.personalizationActive=!0}),PersonalizationSettings.deactivateHeaderPersonalizationMessage()}angular.module("srg-play.features").controller("PersonalizationController",PersonalizationController),PersonalizationController.$inject=["$scope","PersonalizationSettings","localStoreFactory","localStoreKeys","userId","_"]}(),function(){function PersonalizationSettings(localStoreFactory,_,PersonalizationSettingsObserver,personalizationSettingsTracking,SRGConfig){var PERSONALIZATION_DEACTIVATION_KEY="personalizationInactive",HEADER_MESSAGE_ACTIVE_KEY="showHeaderMessage",personalizationStore=localStoreFactory.getStoreEntry("personalizationSettings");return personalizationSettingsTracking.startTrackingSettingChanges(),{isPersonalizationActive:function(){return SRGConfig.isPersonalizationOffered&&_.not(_.prop(PERSONALIZATION_DEACTIVATION_KEY,getPersonalizationSettings()))},deactivatePersonalization:function(){_.pipe(getPersonalizationSettings,addPersonalizationDeactivationSetting,savePersonalizationSettings,notifyObserverOfPersonalizationDeactivation)()},activatePersonalization:function(){_.pipe(getPersonalizationSettings,removePersonalizationDeactivationSetting,savePersonalizationSettings,notifyObserverOfPersonalizationActivation)()},deactivateHeaderPersonalizationMessage:function(){_.pipe(getPersonalizationSettings,addPersonalizationMessageDeactivationSetting,savePersonalizationSettings)()}};function addPersonalizationDeactivationSetting(settings){return _.assoc(PERSONALIZATION_DEACTIVATION_KEY,!0,settings)}function removePersonalizationDeactivationSetting(settings){return _.dissoc(PERSONALIZATION_DEACTIVATION_KEY,settings)}function addPersonalizationMessageDeactivationSetting(settings){return _.assoc(HEADER_MESSAGE_ACTIVE_KEY,!1,settings)}function savePersonalizationSettings(settings){return personalizationStore.settings=settings,personalizationStore.settings}function getPersonalizationSettings(){return personalizationStore.settings=personalizationStore.settings||{},personalizationStore.settings}function notifyObserverOfPersonalizationActivation(){PersonalizationSettingsObserver.notifyPersonalizationActivation()}function notifyObserverOfPersonalizationDeactivation(){PersonalizationSettingsObserver.notifyPersonalizationDeactivation()}}angular.module("srg-play.features").factory("PersonalizationSettings",PersonalizationSettings),PersonalizationSettings.$inject=["localStoreFactory","_","PersonalizationSettingsObserver","personalizationSettingsTracking","SRGConfig"]}(),function(){function PersonalizationSettingsObserver(_){var personalizationActivationCallbacks=[],personalizationDeactivationCallbacks=[];return{onPersonalizationActivation:function(callback){personalizationActivationCallbacks=_.append(callback,personalizationActivationCallbacks)},onPersonalizationDeactivation:function(callback){personalizationDeactivationCallbacks=_.append(callback,personalizationDeactivationCallbacks)},notifyPersonalizationActivation:function(){_.forEach(_.call,personalizationActivationCallbacks)},notifyPersonalizationDeactivation:function(){_.forEach(_.call,personalizationDeactivationCallbacks)}}}angular.module("srg-play.features").factory("PersonalizationSettingsObserver",PersonalizationSettingsObserver),PersonalizationSettingsObserver.$inject=["_"]}(),function(){angular.module("srg-play.features").factory("programDayFactory",function(){return function(dateString){return{showCalendar:!1,dateString:dateString,calendarToggle:function(){return this.showCalendar=!this.showCalendar,this.showCalendar},calendarHide:function(){this.showCalendar=!1}}}})}(),function(){function pushAudioInformation(_,viewPorts,$compile){var $scope;return _.forEach(function(element){element.hide()},[showInformationPlaceHolderForSmall(),showInformationPlaceHolderForMediumUp()]),{restrict:"A",link:function(scope){$scope=scope,viewPorts.callbackForSmall(changeCurrentViewPortToSmall),viewPorts.callbackForMedium(changeCurrentViewPortToMediumUp),viewPorts.callbackForLarge(changeCurrentViewPortToMediumUp),viewPorts.callbackForXLarge(changeCurrentViewPortToMediumUp)}};function changeCurrentViewPortToSmall(){moveElementContent(showInformationPlaceHolderForMediumUp(),showInformationPlaceHolderForSmall())}function changeCurrentViewPortToMediumUp(){moveElementContent(showInformationPlaceHolderForSmall(),showInformationPlaceHolderForMediumUp())}function moveElementContent(source,destination){destination.is(":empty")&&function(destination,sourceContent){destination.append((html=sourceContent,$compile(html)($scope)));var html}(destination,source.html()),source.hide(),source.empty(),destination.show()}function showInformationPlaceHolderForSmall(){return $(".showInformationPlaceholderSmall")}function showInformationPlaceHolderForMediumUp(){return $(".showInformationPlaceholderMediumUp")}}angular.module("srg-play.features").directive("pushAudioInformation",pushAudioInformation),pushAudioInformation.$inject=["_","viewPorts","$compile"]}(),function(){function ChannelOnAirController($scope,$attrs,PlayJSONWebservice,$interval){var intervalRef,vm=this,NOW_AND_NEXT_UPDATE_MILLIS=6e4;function initializeNowAndNextInformationUpdateInterval(){intervalRef=$interval(function(){requestNowAndNextInformation().then(setNowAndNextInformationOnScope)},NOW_AND_NEXT_UPDATE_MILLIS)}function requestNowAndNextInformation(){return PlayJSONWebservice.getResource(vm.nowAndNextUrl,{},{cache:!1}).get().$promise}function setNowAndNextInformationOnScope(data){var programItems=data.programItems;vm.now=programItems.find(function(item){return item.isCurrent}),vm.next=programItems.find(function(item){return!item.isCurrent})}$scope.$on("$destroy",function(){$interval.cancel(intervalRef)}),vm.nowAndNextUrl=$attrs.nowAndNextUrl,vm.nowAndNextRequestInProcess=!1,vm.nowAndNext={},vm.nowAndNextRequestInProcess=!0,requestNowAndNextInformation().then(setNowAndNextInformationOnScope).then(initializeNowAndNextInformationUpdateInterval).finally(function(){vm.nowAndNextRequestInProcess=!1})}angular.module("srg-play.features").controller("ChannelOnAirController",ChannelOnAirController),ChannelOnAirController.$inject=["$scope","$attrs","PlayJSONWebservice","$interval"]}(),function(){function moduleChannelOnAir(radioStationChoiceService){return{restrict:"E",templateUrl:"/play/radio/channelOnAir/"+radioStationChoiceService.getCurrentStation()}}angular.module("srg-play.features").directive("moduleChannelOnAir",moduleChannelOnAir),moduleChannelOnAir.$inject=["radioStationChoiceService"]}(),angular.module("srg-play.features").controller("toggleStationController",["$scope","radioStationChoiceService","viewPorts",function($scope,radioStationChoiceService,viewPorts){function changeVisibilityOfRadioStationList(visibility){$scope.showRadioStationsList=visibility}$scope.showRadioStationsList=!0,$scope.currentViewPort="",viewPorts.callbackForSmall(function(){changeVisibilityOfRadioStationList(!1),$scope.$apply(),$scope.currentViewPort="small"},function(){changeVisibilityOfRadioStationList(!1),$scope.currentViewPort="small"}),viewPorts.callbackForMedium(function(){changeVisibilityOfRadioStationList(!0),$scope.$apply(),$scope.currentViewPort="medium"},function(){changeVisibilityOfRadioStationList(!0),$scope.currentViewPort="medium"}),viewPorts.callbackForLarge(function(){changeVisibilityOfRadioStationList(!0),$scope.$apply(),$scope.currentViewPort="large"},function(){changeVisibilityOfRadioStationList(!0),$scope.currentViewPort="large"}),viewPorts.callbackForXLarge(function(){changeVisibilityOfRadioStationList(!0),$scope.$apply(),$scope.currentViewPort="xlarge"},function(){changeVisibilityOfRadioStationList(!0),$scope.currentViewPort="xlarge"}),$scope.toggleRadioStations=function(){$scope.showRadioStationsList=!$scope.showRadioStationsList,$(".stationDropDown").toggleClass("open")},$scope.changeStation=function(id){"small"==$scope.currentViewPort&&($scope.showRadioStationsList=!1),$(".stationDropDown").removeClass("open"),radioStationChoiceService.changeRadioStation(id)},$scope.isActiveStation=function(id){return radioStationChoiceService.getCurrentStation()==id}}]),function(){function radioModulesController(_,$scope,$attrs,radioStationChoiceService,URI){var moduleUrls;function updateUrl(id){requestStarted(),setUrl(id)}function setUrl(channelId){function buildModuleUrl(baseUrl,key){if(baseUrl){var url=new URI(baseUrl).addQuery({channelId:channelId});$scope[key]=url.toString()}}_.forEachObjIndexed(function(moduleObject,key){moduleObject.enableForChannels||moduleObject.disableForChannels?(Array.isArray(moduleObject.enableForChannels)&&_.contains(channelId,moduleObject.enableForChannels)&&buildModuleUrl(moduleObject.url,key),Array.isArray(moduleObject.disableForChannels)&&!_.contains(channelId,moduleObject.disableForChannels)&&buildModuleUrl(moduleObject.url,key)):buildModuleUrl(moduleObject.url,key)},moduleUrls)}function requestStarted(){$scope.requestInProcess=!0}function requestFinished(){$scope.requestInProcess=!1}moduleUrls=$scope.$eval($attrs.moduleUrls),setUrl(radioStationChoiceService.getCurrentStation()),radioStationChoiceService.registerCallback(updateUrl),requestStarted(),$scope.requestFinished=requestFinished}angular.module("srg-play.features").controller("RadioModulesController",radioModulesController),radioModulesController.$inject=["_","$scope","$attrs","radioStationChoiceService","URI"]}(),function(){function AudioLivePopupController(_,$scope,radioStationsRequestService,technicalPlayerService,PlayJSONWebservice,$interval,$timeout,$window,$sce,$location,localStoreFactory,chartbeatService,$document,URI,$attrs,radioLivePopupTrackingService){var intervalFunction,livePopupUserOptions=localStoreFactory.getStoreEntry("livepopup");function setStationsRequestFinished(stations){return $scope.stationsRequestInProcess=!1,stations}function initializeViewWithStations(stations){if(list=stations,_.not(_.isEmpty(list))){$scope.stationsLoaded=!0,function(stations){$scope.stations=stations}(stations);var initialStation=function(stations){return function(stations){var locationPath=$location.path();return _.find(function(station){return _.equals(locationPath,station.channel.liveplayerUrl)})(stations)}(stations)||$scope.stations[0]}(stations);(streams=function(station){var primaryLivestream=station.livestream,regionalLivestreams=primaryLivestream.regionalLiveStreams||[];return[primaryLivestream].concat(regionalLivestreams)}(station=initialStation)).regionalStreamsAvailable=function(station){return station.livestream.regionalLiveStreams&&station.livestream.regionalLiveStreams.length>0}(station),station.availableStreams=streams,$scope.currentStation=station,function(station){trackActiveStationForChartbeat(station)}(initialStation),function(currentStation){technicalPlayerService.init($scope.technicalPlayer);var playerUrl=getPlayerUrl(currentStation.livestream.urn),selectedLivestream=currentStation.livestream,usersChannelOptions=livePopupUserOptions[currentStation.channel.id];if(usersChannelOptions){var selectedStreamUrn=usersChannelOptions.selectedLivestreamUrn,usersFavoriteLivestream=(urn=selectedStreamUrn,_.find(function(stream){return stream.urn===urn},$scope.currentStation.availableStreams));usersFavoriteLivestream&&(playerUrl=getPlayerUrl(selectedStreamUrn),selectedLivestream=usersFavoriteLivestream)}var urn;return currentStation.selectedLivestream=selectedLivestream,$scope.initialPlayerUrl=playerUrl,currentStation}(initialStation),getStationsNowAndNextInformation(initialStation)}var station,streams,list}function getStationsNowAndNextInformation(station){return $scope.nowAndNextRequestInProcess=!0,requestNowAndNextInformation(station).then(_.pipe(setNowAndNextInformationOnScope,resizePopupWindow)).then(function(){!function(station){intervalFunction=$interval(function(){requestNowAndNextInformation(station).then(setNowAndNextInformationOnScope)},6e4)}(station)}).finally(function(){$scope.nowAndNextRequestInProcess=!1})}function resizePopupWindow(){$timeout(function(){$window.resizeTo(480,$(".livePopupAudio").height()+85)},500)}function requestNowAndNextInformation(station){return PlayJSONWebservice.getResource(station.nowAndNextUrl,{livestreamId:$scope.currentStation.selectedLivestream&&$scope.currentStation.selectedLivestream.id},{cache:!1}).get().$promise}function setNowAndNextInformationOnScope(data){$scope.nowAndNext.programItems=data.programItems,$scope.nowAndNext.timetableOverviewUrl=data.timetableOverviewUrl,$scope.nowAndNext.presenter=data.presenter,data.programItems&&data.programItems.length&&($scope.nowAndNext.currentProgram=_.find(function(program){return program.isCurrent},data.programItems))}function getPlayerUrl(urn){var url=new URI($scope.playerBaseUrl).setQuery({urn:urn,autoplay:!0}).toString();return $sce.trustAsResourceUrl(url)}function trackActiveStationForChartbeat(station){chartbeatService.trackVirtualPageChange(station.channel.name+" - "+$document[0].title)}$scope.switchStation=function(selectedStation){(function(selectedStation){selectedChannel=selectedStation.channel.name,radioLivePopupTrackingService.trackChannelSwitch({selectedChannel:selectedChannel,currentChannel:$scope.currentStation.channel.name}),trackActiveStationForChartbeat(selectedStation),$scope.$root.$broadcast("netmetrixReferrerChange",$location.absUrl());var selectedChannel})(selectedStation),url=selectedStation.channel.liveplayerUrl,$location.path(url);var url},$scope.technicalPlayer={playerId:"srg_player_technical_player"},$scope.playerBaseUrl=$attrs.playerBaseUrl,$scope.initialPlayerUrl="",$scope.stationsUrl=$attrs.stationsUrl,$scope.stations=[],$scope.currentStation={},$scope.stationsLoaded=!1,$scope.stationsRequestInProcess=!1,$scope.nowAndNextRequestInProcess=!1,$scope.nowAndNext={},$scope.playLivestream=function(livestreamUrn){technicalPlayerService.loadUsingUrn(livestreamUrn),livePopupUserOptions[$scope.currentStation.channel.id]={selectedLivestreamUrn:livestreamUrn},$interval.cancel(intervalFunction),getStationsNowAndNextInformation($scope.currentStation)},$scope.stopPlayback=function(){technicalPlayerService.stop()},($scope.stationsRequestInProcess=!0,radioStationsRequestService.request($scope.stationsUrl)).then(setStationsRequestFinished).then(initializeViewWithStations),$scope.$on("$destroy",function(){intervalFunction&&$interval.cancel(intervalFunction)})}angular.module("srg-play.features").controller("AudioLivePopupController",AudioLivePopupController),AudioLivePopupController.$inject=["_","$scope","radioStationsRequestService","technicalPlayerService","PlayJSONWebservice","$interval","$timeout","$window","$sce","$location","localStoreFactory","chartbeatService","$document","URI","$attrs","radioLivePopupTrackingService"]}(),function(){function radioLivePopupTrackingService(tcEvents){return{trackChannelSwitch:function(data){tcEvents({id:"hidden_event",data:{event_type:"RadioLivePopup",event_name:"ChannelSwitch",event_value_1:data.selectedChannel,event_value_2:data.currentChannel}})},trackSongClick:function(data){tcEvents({id:"hidden_event",data:{event_type:"RadioLivePopup",event_name:"SongLog",event_value_1:data.channel,event_value_2:data.songPlaybackTime,event_value_3:data.timeDifference,event_value_4:data.songTitle}})}}}angular.module("srg-play.features").factory("radioLivePopupTrackingService",radioLivePopupTrackingService),radioLivePopupTrackingService.$inject=["tcEvents"]}(),function(){function radioStationsRequestService(_,PlayJSONWebservice){return{request:_.pipeP(function(url){return PlayJSONWebservice.getResource(url).get().$promise},_.path(["stations"]))}}angular.module("srg-play.features").factory("radioStationsRequestService",radioStationsRequestService),radioStationsRequestService.$inject=["_","PlayJSONWebservice"]}(),function(){function SonglogController($scope,$window,$attrs,PlayJSONWebservice,$interval,moment,SRGConfig,technicalPlayerService,radioLivePopupTrackingService){var intervalFunction,agent,win7,ie11;function selectSong(song){var offset=0;$scope.liveStreamOffset&&(offset=$scope.count>0?$scope.liveStreamOffset.concurrent:$scope.liveStreamOffset.initial),$scope.count++,technicalPlayerService.seekToAbsoluteTime(convertTimeStringToSeconds(song.timeOfPlayback),offset),function(song){radioLivePopupTrackingService.trackSongClick({channel:$scope.currentStation.channel.name,songPlaybackTime:song.displayTimeOfPlayback,timeDifference:function(song){var passedSecondsToday=(hours=moment().hours(),minutes=moment().minutes(),seconds=moment().seconds(),60*(60*hours+minutes)+seconds),songPlaybackTime=convertTimeStringToSeconds(song.timeOfPlayback);var hours,minutes,seconds;return(passedSecondsToday+(passedSecondsToday<songPlaybackTime?86400:0)-songPlaybackTime).toString()}(song),songTitle:"".concat(song.title,", ").concat(song.artist.name)})}(song)}function convertTimeStringToSeconds(timeString){var components=timeString.split(":");return 60*(60*parseInt(components[0])+parseInt(components[1]))+parseInt(components[2])}function requestSonglog(songLogUrl){return PlayJSONWebservice.getResource(songLogUrl,{},{cache:!1,isArrayResponse:!0}).get().$promise}function setSonglog(songs){$scope.songLog=songs}$scope.songlogRequestInProcess=!1,$scope.songLog=[],$scope.streamLength=0,$scope.selectSong=selectSong,$scope.liveStreamOffset=$scope.$eval($attrs.liveStreamOffset),$scope.disableLogNavigation=(agent=$window.navigator.userAgent,win7=agent.indexOf("Windows NT 6.1")>0,ie11=agent.indexOf("Trident/7.0")>0,win7&&ie11),$scope.convertTimeStringToSeconds=convertTimeStringToSeconds,$scope.$watch("currentStation",function(newStation){var songLogUrl;newStation.songLogUrl&&($scope.currentStation=newStation,requestSonglog(newStation.songLogUrl).then(setSonglog),songLogUrl=newStation.songLogUrl,intervalFunction&&$interval.cancel(intervalFunction),intervalFunction=$interval(function(){requestSonglog(songLogUrl).then(setSonglog)},15e3))}),$scope.$on("$destroy",function(){intervalFunction&&$interval.cancel(intervalFunction)})}angular.module("srg-play.features").controller("SonglogController",SonglogController),SonglogController.$inject=["$scope","$window","$attrs","PlayJSONWebservice","$interval","moment","SRGConfig","technicalPlayerService","radioLivePopupTrackingService"]}(),function(){function radioProgramDay($http,$compile){return{link:function(scope,element,attrs){scope.day&&scope.station&&(url="/play/radio/programDay/"+scope.day.dateString+"/"+scope.station.id,scope.$emit("showsByDateRequestStarted"),$http({method:"GET",url:url}).then(handleResponse).catch(handleError).finally(requestFinished));var url;function handleResponse(response){renderResponse(response)}function handleError(response){!function(response){return 404===response.status}(response)?element.replaceWith($compile('<div class="programDay__noContentMessage">'+attrs.errorMessage+"</div>")(scope)):renderResponse(response)}function renderResponse(response){element.replaceWith($compile(response.data)(scope))}function requestFinished(){scope.$emit("showsByDateRequestFinished")}scope.changeDay=function(dateString){scope.onDayChange({dateString:dateString})}},template:'<div class="loadingContainer loadingContainer--big" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div>',scope:{day:"=",station:"=",onDayChange:"&",requestToday:"&",requestYesterday:"&"}}}angular.module("srg-play.features").directive("radioProgramDay",radioProgramDay),radioProgramDay.$inject=["$http","$compile"]}(),function(){function aToZStationController($scope,radioStationChoiceService,$location,URI,$attrs){var baseUrl=$attrs.showsAToZSectionListUrl||"";function updateUrl(id){requestInProcess(),$location.search("index",null),setUrl(id)}function setUrl(id){var url=new URI(baseUrl).addQuery({channelId:id});$scope.aToZUrl=url.toString()}function markRequestSuccessful(){requestFinished(),$scope.wasRequestSuccessful=!0}function markRequestFailed(){requestFinished(),$scope.wasRequestSuccessful=!1}function requestFinished(){$scope.requestInProcess=!1}function requestInProcess(){$scope.requestInProcess=!0}setUrl(radioStationChoiceService.getCurrentStation()),radioStationChoiceService.registerCallback(updateUrl),requestInProcess(),$scope.markRequestFailed=markRequestFailed,$scope.markRequestSuccessful=markRequestSuccessful}angular.module("srg-play.features").controller("aToZStationController",aToZStationController),aToZStationController.$inject=["$scope","radioStationChoiceService","$location","URI","$attrs"]}(),function(){function showsByDateStationController($scope,radioStationChoiceService){var updateCurrentStation=function(id){$scope.station={id:id},$scope.$broadcast("resetShowsByDateView")};updateCurrentStation(radioStationChoiceService.getCurrentStation()),radioStationChoiceService.registerCallback(updateCurrentStation)}angular.module("srg-play.features").controller("showsByDateStationController",showsByDateStationController),showsByDateStationController.$inject=["$scope","radioStationChoiceService"]}(),function(){angular.module("srg-play.features").directive("regioDetailpage",function(){return{templateUrl:function(elem,attr){return"/play/tv/regiotv/channel/"+attr.channelSeoName+"/video/"+attr.videoId}}})}(),function(){angular.module("srg-play.features").directive("regioOverview",function(){return{templateUrl:function(elem,attr){return"/play/tv/regiotv/channel/"+attr.channelSeoName}}})}(),function(){function searchChipsFactory(searchState,dateFilterService,_,moment){return{createChips:function(aggregations){var chips=[];return function(aggregations,chips){searchState.getFilters().forEach(function(filter){filter.ids.forEach(function(id){var chip=function(aggregations,filterName,id){var idEquals=_.propEq("id",id),aggregation=_.find(idEquals)(aggregations[filterName]||{});if(aggregation)return{id:aggregation.id,title:aggregation.title,aggregation:filterName}}(aggregations,filter.name,id);chip&&chips.push(chip)})})}(aggregations,chips),function(chips){var querySettings=searchState.getQuerySettings(),fromDate=querySettings.dateFilter.fromDate,toDate=querySettings.dateFilter.toDate,quickFilters=dateFilterService.getQuickFilters(),fromAndToDateMatch=_.whereEq({fromDate:fromDate,toDate:toDate}),quickFilter=_.find(fromAndToDateMatch,quickFilters);quickFilter?addDateChip(chips,quickFilter.title):fromDate&&toDate&&function(fromDate,toDate,chips){var formattedFromDate=moment(fromDate,"YYYY-MM-DD").format("DD.MM.YYYY"),formattedToDate=moment(toDate,"YYYY-MM-DD").format("DD.MM.YYYY");addDateChip(chips,fromDate===toDate?formattedFromDate:"".concat(formattedFromDate,"  ").concat(formattedToDate))}(fromDate,toDate,chips)}(chips),chips}};function addDateChip(chips,title){chips.push({title:title,id:"date-filter-chip",aggregation:"publishedDate"})}}angular.module("srg-play.features").factory("searchChipsFactory",searchChipsFactory),searchChipsFactory.$inject=["searchState","dateFilterService","_","moment"]}(),function(){function searchController($scope,$attrs,searchState,searchTrackingService,$location,angularElement,$timeout,debounce,viewPorts,SRGConfig){var vm=this;vm.searchQuery="",vm.isSubmitted=!1,vm.show=function(){searchState.showSearchBox(),firstSearchSubmitted=!1,searchState.setPreSearchLocation($location.url()),focus(200)},vm.updateQuery=function(){isSearchTermSupported()&&(firstSearchSubmitted||vm.searchQuery&&vm.searchQuery.length>=3)&&runQueryDebounced(!1)},vm.onSubmit=function($event){if($event.preventDefault(),!isSearchTermSupported())return;vm.isSubmitted=!0,runQueryDebounced(!0),blur()},vm.resetAndFocus=function(){clear(),focus(0)},vm.close=function(event){event&&event.preventDefault();searchState.closeSearchBox(),clear(),blur();var location=searchState.getPreSearchLocation()||"/play/tv";$location.url(location)},vm.isSearchPageOpen=function(){return searchState.isSearchPageOpen()},vm.isOpen=function(){return searchState.isSearchBoxOpen()},vm.areRecommendationsVisible=function(){return searchState.areRecommendationsVisible()},vm.hasText=function(){return void 0!==vm.searchQuery&&""!==vm.searchQuery},vm.isSmall=function(){return viewPorts.getCurrent()===viewPorts.SMALL_TYPE},searchState.setSearchPageUrl($attrs.searchPageUrl);var firstSearchSubmitted=!1,runQueryDebounced=debounce(function(includeAggregations){firstSearchSubmitted||searchTrackingService.trackOpenSearch(vm.searchQuery),firstSearchSubmitted=!0;var resetMediaType=vm.isSmall();searchState.setQuery(vm.searchQuery||"",includeAggregations,resetMediaType)},250);function clear(){vm.searchQuery="",vm.isSubmitted=!1,firstSearchSubmitted=!1,searchState.reset()}function focus(delay){$timeout(function(){angularElement("#search-input").focus()},delay)}function blur(){vm.isSmall()&&angularElement("#search-input").blur()}function isSearchTermSupported(){return SRGConfig.features.isAdvancedSearchSupported||!(""===vm.searchQuery)}$scope.$watch(searchState.watchQuerySettings,function(querySettings){vm.searchQuery=querySettings.query||""})}angular.module("srg-play.features").controller("searchController",searchController),searchController.$inject=["$scope","$attrs","searchState","searchTrackingService","$location","angularElement","$timeout","debounce","viewPorts","SRGConfig"]}(),function(){angular.module("srg-play.features").component("srgSearchRecommendations",{template:'\n      <div class="search-recommendations" ng-class="{ \'search-recommendations--visible\': $ctrl.visible() }">\n        <div class="search-recommendations__container">\n          <div class="search-recommendations__content">\n\n            <section class="search-history" ng-if="$ctrl.showHistory()">\n              <ul>\n                  <li class="search-history__entry" ng-repeat="searchTerm in $ctrl.searchHistory">\n                    <a class="search-history__link"\n                      ng-href="{{ $ctrl.searchUrlFor(searchTerm) }}">{{ searchTerm }}</a>\n                  </li>\n              </ul>\n\n              <div class="search-history__delete">\n                <button ng-if="!$ctrl.isSearchHistoryEmpty()"\n                   ng-click="$ctrl.deleteSearchHistory()">{{ $ctrl.deleteHistoryTitle }}</button>\n              </div>\n            </section>\n            <section ng-if="$ctrl.isAdvancedSearchSupported" class="most-searched-shows">\n              <h1 class="search-recommendations__title">\n                {{ $ctrl.mostSearchedTitle }}\n              </h1>\n\n              <div class="loadingContainer paddingS"\n                ng-show="$ctrl.loading"\n                ng-activity-indicator="CircledGrey"\n                skip-ng-show="yes">\n              </div>\n\n              <ul ng-repeat="show in $ctrl.shows">\n                  <li>\n                    <a class="search-recommendations__entry"\n                      ng-href="{{ show.overviewUrl }}">{{ show.title }}</a>\n                  </li>\n              </ul>\n            </section>\n\n          </div>\n        </div>\n      </div>',bindings:{mostSearchedTitle:"@",deleteHistoryTitle:"@"},controller:["$scope","searchState","searchRecommendationService","PersonalizationSettings","SRGConfig",function($scope,searchState,searchRecommendationService,PersonalizationSettings,SRGConfig){var vm=this;vm.visible=function(){return searchState.areRecommendationsVisible()},vm.loading=!1,vm.shows=[],vm.searchHistory=[],vm.isAdvancedSearchSupported=SRGConfig.features.isAdvancedSearchSupported,vm.isSearchHistoryEmpty=function(){return 0===vm.searchHistory.length},vm.isPersonalizationActive=function(){return PersonalizationSettings.isPersonalizationActive()},vm.showHistory=function(){return vm.isPersonalizationActive()&&!vm.isSearchHistoryEmpty()},vm.searchUrlFor=function(searchTerm){return searchState.getSearchUrlFor(searchTerm).toString()},$scope.$watch(searchState.areRecommendationsVisible,function(visible){visible&&0===vm.shows.length&&vm.isAdvancedSearchSupported&&(vm.loading=!0,searchRecommendationService.getMostSearchedShows().then(function(response){vm.shows=response.shows,vm.loading=!1})),vm.searchHistory=searchRecommendationService.getSearchHistory()}),vm.deleteSearchHistory=function(){searchRecommendationService.clearSearchHistory(),vm.searchHistory=[]}}]})}(),function(){function searchRecommendationService(PlayJSONWebservice,localStoreFactory,localStoreKeys,PersonalizationSettings,moment){var searchStore=localStoreFactory.getStoreEntry(localStoreKeys.search);return searchStore.localHistory=searchStore.localHistory||[],{getMostSearchedShows:function(){return PlayJSONWebservice.getResource("/play/search/most-searched-shows").get().$promise},addToSearchHistory:function(searchTerm){if(PersonalizationSettings.isPersonalizationActive()&&searchTerm){var updatedSearchHistory=searchStore.localHistory.filter(function(entry){return entry.searchTerm!==searchTerm});updatedSearchHistory.push({searchTerm:searchTerm,date:new Date}),updatedSearchHistory.length>10&&updatedSearchHistory.splice(0,1),searchStore.localHistory=updatedSearchHistory}},getSearchHistory:function(){return PersonalizationSettings.isPersonalizationActive()?(searchStore.localHistory=searchStore.localHistory.filter(function(entry){try{var searchDate=moment(entry.date),now=moment(),durationBetween=moment.duration(now.diff(searchDate));return durationBetween.asDays()<=28}catch(e){return!1}}),searchStore.localHistory.map(function(entry){return entry.searchTerm}).reverse()):[]},clearSearchHistory:function(){searchStore.localHistory=[]}}}angular.module("srg-play.features").factory("searchRecommendationService",searchRecommendationService),searchRecommendationService.$inject=["PlayJSONWebservice","localStoreFactory","localStoreKeys","PersonalizationSettings","moment"]}(),function(){function searchRequestService($q,_,viewPorts,UrlPatternResolver,PlayJSONWebservice,GetRequestService){return{searchMedia:function(querySettings,nextPageHash){var params={searchQuery:encodeURIComponent(querySettings.query),numberOfMedias:8};return request(function(querySettings,query,nextPageHash){var params={mediaType:querySettings.mediaType,includeAggregations:querySettings.includeAggregations,topics:querySettings.topics,shows:querySettings.shows,features:querySettings.features,fromDate:querySettings.dateFilter.fromDate,toDate:querySettings.dateFilter.toDate,nextPageHash:nextPageHash};return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SEARCH_MEDIA,query,params)}(querySettings,params,nextPageHash))},searchShows:function(querySettings,nextPageHash){if(!querySettings.query)return $q.when([]);var params={searchQuery:encodeURIComponent(querySettings.query),numberOfMedias:function(){if(viewPorts.getCurrent()===viewPorts.SMALL_TYPE)return 2;if(viewPorts.getCurrent()===viewPorts.MEDIUM_TYPE)return 3;return 6}()};return request(UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SEARCH_SHOWS,params,{nextPageHash:nextPageHash}))},trackShowClick:function(urn){var url=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SEARCH_TRACK_SHOW_CLICK,{urn:urn});GetRequestService("".concat(url,"?cb=").concat((new Date).getTime()))}};function request(url){return PlayJSONWebservice.getResource(url).get().$promise}}angular.module("srg-play.features").factory("searchRequestService",searchRequestService),searchRequestService.$inject=["$q","_","viewPorts","UrlPatternResolver","PlayJSONWebservice","GetRequestService"]}(),function(){function searchState($rootScope,$location,URI,_,moment){var searchPageUrl,preSearchLocation,querySettings,filterKeys=["topics","shows","features"],searchBoxOpen=!1,defaultQuerySettings={query:void 0,includeAggregations:!1,mediaType:void 0,topics:[],shows:[],features:[],dateFilter:{fromDate:void 0,toDate:void 0}};return reset(),$rootScope.$on("$locationChangeSuccess",function(){isSearchPageOpen()?(searchBoxOpen=!0,function(){var searchParams=$location.search(),newQuerySettings={query:searchParams.query};filterKeys.forEach(function(filterKey){var ids=searchParams[filterKey];angular.isDefined(ids)&&(newQuerySettings.includeAggregations=!0,newQuerySettings[filterKey]=ids.split(","))}),("video"==searchParams.mediaType||"audio"==searchParams.mediaType)&&(querySettings.mediaType=searchParams.mediaType);isValidDate(searchParams.from)&&(querySettings.dateFilter.fromDate=searchParams.from);isValidDate(searchParams.to)&&(querySettings.dateFilter.toDate=searchParams.to);updateQuerySettings(newQuerySettings)}()):closeSearchBox()}),{setQuery:function(query,includeAggregation,resetMediaType){var mediaType=resetMediaType?void 0:querySettings.mediaType;updateQuerySettings({query:query,includeAggregations:(hasFilter=querySettings.dateFilter.fromDate||querySettings.dateFilter.toDate||querySettings.mediaType,filters=getFilters()||[],!(!hasFilter&&!filters.some(function(filter){return!!filter.ids.length}))||includeAggregation),mediaType:mediaType});var hasFilter,filters},setFilter:function(filterName,ids){updateQuerySettings(_defineProperty({},filterName,ids))},getFilters:getFilters,removeFilter:function(filterName,id){if(angular.isUndefined(filterName)||angular.isUndefined(id))return;if("publishedDate"===filterName)return void removeDateFilter();var updatedIds=_.clone(querySettings[filterName]),index=updatedIds.indexOf(id);updatedIds.splice(index,1),updateQuerySettings(_defineProperty({},filterName,updatedIds))},removeDateFilter:removeDateFilter,setDateFilter:function(fromDate,toDate){updateQuerySettings({dateFilter:{fromDate:fromDate,toDate:toDate}})},removeAllFilters:function(){removeDateFilter();var newQuerySettings={};filterKeys.forEach(function(filter){return newQuerySettings[filter]=[]}),updateQuerySettings(newQuerySettings)},setMediaType:function(mediaType){updateQuerySettings({mediaType:mediaType})},includeAggregations:function(include){updateQuerySettings({includeAggregations:include})},getQuerySettings:function(){return _.clone(querySettings)},watchQuerySettings:function(){return querySettings},setSearchPageUrl:function(url){searchPageUrl=url},getSearchUrlFor:getSearchUrlFor,isSearchPageOpen:isSearchPageOpen,areRecommendationsVisible:function(){return searchBoxOpen&&angular.isUndefined(querySettings.query)},isSearchBoxOpen:function(){return searchBoxOpen},closeSearchBox:closeSearchBox,showSearchBox:function(){searchBoxOpen=!0},setPreSearchLocation:function(location){preSearchLocation=location},getPreSearchLocation:function(){return preSearchLocation},reset:reset};function reset(){updateQuerySettings(_.clone(defaultQuerySettings))}function getFilters(){var filters=[];return filterKeys.forEach(function(filterKey){filters.push({name:filterKey,ids:_.clone(querySettings[filterKey])||[]})}),filters}function removeDateFilter(){updateQuerySettings({dateFilter:{fromDate:void 0,toDate:void 0}})}function updateQuerySettings(newQuerySettings){var mergedSettings=_.merge(querySettings,newQuerySettings);angular.equals(querySettings,mergedSettings)||(querySettings=mergedSettings,function(){if(angular.isUndefined(searchPageUrl))return;if(angular.isUndefined(querySettings.query)&&($location.search("query",null),!isSearchPageOpen()))return;var newLocation=getSearchUrlFor(querySettings.query);filterKeys.forEach(function(filterKey){var ids=querySettings[filterKey];ids.length&&newLocation.addQuery(_defineProperty({},filterKey,ids.join()))}),querySettings.dateFilter.fromDate&&newLocation.addQuery({from:querySettings.dateFilter.fromDate});querySettings.dateFilter.toDate&&newLocation.addQuery({to:querySettings.dateFilter.toDate});querySettings.mediaType&&newLocation.addQuery({mediaType:querySettings.mediaType});$location.url(newLocation.toString()),$location.replace()}())}function getSearchUrlFor(searchTerm){return new URI(searchPageUrl).addQuery({query:searchTerm})}function isSearchPageOpen(){return $location.path()===searchPageUrl}function closeSearchBox(){searchBoxOpen=!1,reset()}function isValidDate(dateString){return moment(dateString,"YYYY-MM-DD").isValid()}}angular.module("srg-play.features").factory("searchState",searchState),searchState.$inject=["$rootScope","$location","URI","_","moment"]}(),function(){angular.module("srg-play.features").component("srgDateFilterDropdown",{template:'\n        <div class="date-filter-dropdown"\n          ng-class="{\n            \'date-filter-dropdown--open\': $ctrl.isOpen,\n            \'date-filter-dropdown--active\': $ctrl.isActive(),\n          }"\n          click-outside="$ctrl.saveAndClose()">\n\n          <button class="date-filter-dropdown__button"\n            ng-click="$ctrl.toggle()">{{ $ctrl.name }}</button>\n\n          <div class="date-filter-dropdown__container" ng-if="$ctrl.showContainer()">\n\n            <srg-media-histogram\n              data="$ctrl.histogramData"\n              aria-hidden="true"\n              on-date-range-selected="$ctrl.onHistogramClicked(fromDate, toDate)"/>\n\n            <ul>\n              <li ng-repeat="filter in $ctrl.quickFilters track by $index">\n                <button class="date-filter-dropdown__quick-filter"\n                  ng-class="{ \'date-filter-dropdown__quick-filter--active\': $ctrl.isQuickFilterActive(filter) }"\n                  ng-click="$ctrl.setQuickFilter(filter)">{{ filter.label }}</button>\n              </li>\n            </ul>\n\n            <div class="date-filter-dropdown__divider" ng-if="$ctrl.hasQuickFilters()"></div>\n\n            <div class="date-filter-dropdown__free-range-header">\n              <span class="date-filter-dropdown__calendar-icon"></span>\n              <h2>{{ $ctrl.translate(\'srg.search.filter.date.datePicker\') }}</h2>\n            </div>\n\n            <srg-date-range-picker\n              ng-if="$ctrl.isOpen"\n              from-date="$ctrl.fromDate"\n              to-date="$ctrl.toDate"\n              min-date="$ctrl.minDate"\n              max-date="$ctrl.maxDate"\n              on-save="$ctrl.onDateRangeChanged(fromDate, toDate)"\n              date-picker-config="$ctrl.datePickerConfig" />\n\n            <div class="date-filter-dropdown__divider"></div>\n\n            <button ng-click="$ctrl.saveAndClose()"class="dropdown__save-button">\n              {{ $ctrl.saveButtonText() }}\n            </button>\n          </div>\n        </div>',bindings:{name:"@",values:"<",dateFilter:"<",isLoading:"<",datePickerConfig:"=",onSave:"&"},controller:["dateFilterService","moment","translator",function(dateFilterService,moment,translator){var vm=this;function saveAndClose(){vm.isOpen&&(hasValidDates()?vm.onSave({fromDate:dateFilterService.toDateString(vm.fromDate),toDate:dateFilterService.toDateString(vm.toDate)}):vm.onSave({fromDate:void 0,toDate:void 0}),reset())}function reset(){vm.isOpen=!1}function onDateRangeChanged(fromDate,toDate){vm.fromDate=fromDate,vm.toDate=toDate,updateResultCount()}function updateResultCount(){var fromDate=moment(vm.fromDate),toDate=moment(vm.toDate);vm.resultCount,fromDate&&toDate&&(vm.resultCount=dateFilterService.getNumberOfResultsBetween(fromDate,toDate))}function hasValidDates(){return angular.isDefined(vm.fromDate)&&angular.isDefined(vm.toDate)}vm.isOpen=!1,vm.quickFilters=[],vm.resultCount=void 0,vm.translate=translator.translate,vm.saveAndClose=saveAndClose,vm.toggle=function(){vm.isOpen?vm.saveAndClose():vm.isOpen=!0},vm.isActive=function(){return vm.dateFilter&&vm.dateFilter.fromDate&&vm.dateFilter.toDate},vm.onDateRangeChanged=onDateRangeChanged,vm.onHistogramClicked=function(fromDate,toDate){onDateRangeChanged(fromDate,toDate),saveAndClose()},vm.saveButtonText=function(){if(hasValidDates()){var resultText=1===vm.resultCount?translator.translate("srg.search.filter.date.singleResult"):translator.translate("srg.search.filter.date.multipleResults");return"".concat(vm.resultCount," ").concat(resultText)}return translator.translate("srg.search.dropdown.close")},vm.setQuickFilter=function(quickFilter){vm.fromDate=dateFilterService.toDate(quickFilter.fromDate),vm.toDate=dateFilterService.toDate(quickFilter.toDate),updateResultCount(),saveAndClose()},vm.isQuickFilterActive=function(quickFilter){return quickFilter.fromDate===dateFilterService.toDateString(vm.fromDate)&&quickFilter.toDate===dateFilterService.toDateString(vm.toDate)},vm.showContainer=function(){return vm.isOpen&&!vm.isLoading},vm.hasQuickFilters=function(){return vm.quickFilters.length>0},vm.$onInit=function(){var locale=moment.locale();moment.updateLocale(locale,{months:vm.datePickerConfig.months,monthsShort:vm.datePickerConfig.months.map(function(s){return s.substring(0,3)})})},vm.$onChanges=function(changes){if(changes.values&&(vm.quickFilters=dateFilterService.getQuickFilters()||[],vm.histogramData=dateFilterService.getHistogramData(),angular.isUndefined(changes.values.currentValue)&&reset()),changes.dateFilter){var dateFilter=changes.dateFilter.currentValue||{};vm.fromDate=dateFilterService.toDate(dateFilter.fromDate),vm.toDate=dateFilterService.toDate(dateFilter.toDate)}var firstResultDate;firstResultDate=dateFilterService.getFirstResultDate(),vm.minDate=moment(firstResultDate,dateFilterService.dateFormat).startOf("day").toDate(),vm.maxDate=moment().endOf("day").toDate(),updateResultCount()}}]})}(),function(){function dateFilterService(translator,moment){var results,quickFilters,histogramData,firstResultDate,lastResultDate,dateFormat="YYYY-MM-DD",resultsPerDay={},resultsPerMonth={},resultsPerYear={};return{setResultDates:function(newResults){results=newResults||[],resultsPerDay={},resultsPerMonth={},resultsPerYear={},lastResultDate=void 0,results.forEach(function(day){resultsPerDay[day.date]=day.count;var date=moment(day.date,dateFormat),month=date.format("YYYY-MM"),monthCount=resultsPerMonth[month]||0;resultsPerMonth[month]=monthCount+day.count;var year=date.year(),yearCount=resultsPerYear[year]||0;resultsPerYear[year]=yearCount+day.count,firstResultDate=day.date,lastResultDate=lastResultDate||day.date}),addQuickFilter(quickFilters=[],translator.translate("srg.search.filter.today"),1),addQuickFilter(quickFilters,translator.translate("srg.search.filter.yesterday"),1,-1),addQuickFilter(quickFilters,translator.translate("srg.search.filter.last7Days"),7),addQuickFilter(quickFilters,translator.translate("srg.search.filter.last31Days"),31),addQuickFilter(quickFilters,translator.translate("srg.search.filter.last365Days"),365),sixtyMonthsAgo=moment().startOf("month").subtract(60,"months"),moment(firstResultDate).isBefore(sixtyMonthsAgo)?function(numberOfYears){var currentYear=moment().year();histogramData={startLabel:currentYear-numberOfYears+1,endLabel:currentYear,bars:[],maxResults:0};for(var i=numberOfYears;i>0;i--){var year=currentYear-i+1,resultCount=resultsPerYear[year]||0;histogramData.maxResults=Math.max(resultCount,histogramData.maxResults),histogramData.bars.push({label:"".concat(translator.translate("srg.search.histogram.year")," ").concat(year),dateRange:{fromDate:"".concat(year,"-01-01"),toDate:"".concat(year,"-12-31")},resultCount:resultCount})}}(60):function(numberOfMonths){var maxMonthsAgo=numberOfMonths-1,startDate=moment().startOf("month").subtract(maxMonthsAgo,"months");histogramData={startLabel:startDate.format("MMM. YYYY"),endLabel:moment().format("MMM. YYYY"),bars:[],maxResults:0};for(var i=maxMonthsAgo;i>=0;i--){var date=moment().startOf("month").subtract(i,"months"),resultCount=resultsPerMonth[date.format("YYYY-MM")]||0;histogramData.maxResults=Math.max(resultCount,histogramData.maxResults),histogramData.bars.push({label:"".concat(date.format("MMM. YYYY")),dateRange:{fromDate:date.format(dateFormat),toDate:date.endOf("month").format(dateFormat)},resultCount:resultCount})}}(60);var sixtyMonthsAgo},getNumberOfResultsForDate:getNumberOfResultsForDate,getNumberOfResultsBetween:getNumberOfResultsBetween,getNextResult:function(date){return getClosestResult(date,lastResultDate,!0)},getPreviousResult:function(date){return getClosestResult(date,firstResultDate,!1)},getFirstResultDate:function(){return firstResultDate},getQuickFilters:function(){return quickFilters},getHistogramData:function(){return histogramData},dateFormat:dateFormat,toDate:function(dateString){if(dateString)return moment(dateString,dateFormat).toDate();return},toDateString:function(date){if(date)return moment(date).format(dateFormat);return}};function getNumberOfResultsForDate(date){var formattedDate=date.format(dateFormat);return resultsPerDay[formattedDate]||0}function getNumberOfResultsBetween(fromDate,toDate){if(angular.isUndefined(fromDate)||angular.isUndefined(toDate))return 0;for(var loopDate=createLoopDate(fromDate),maxDate=toDate.isAfter(moment())?moment():toDate,resultCount=0;loopDate.diff(maxDate)<=0;)resultCount+=getNumberOfResultsForDate(loopDate),loopDate.add(1,"days");return resultCount}function getClosestResult(startDate,maxDateString,searchForward){if(!angular.isUndefined(startDate))for(var current,max,loopDate=createLoopDate(startDate),maxDate=moment(maxDateString,dateFormat).startOf("day");current=loopDate,max=maxDate,(searchForward?current.diff(max):max.diff(current))<=0;){if(getNumberOfResultsForDate(loopDate)>0)return loopDate.clone();searchForward?loopDate.add(1,"days"):loopDate.subtract(1,"days")}}function createLoopDate(fromDate){var minDate=moment("1950-01-01");return fromDate.isBefore(minDate)?minDate:fromDate.clone()}function addQuickFilter(quickFilters,title,numberOfDays,endDayOffset){var toDate=moment().startOf("day").add(endDayOffset||0,"days"),fromDate=toDate.clone().subtract(numberOfDays-1,"days"),resultCount=getNumberOfResultsBetween(fromDate,toDate);if(resultCount>0){var filter={title:title,label:"".concat(title," (").concat(resultCount,")"),fromDate:fromDate.format(dateFormat),toDate:toDate.format(dateFormat)};quickFilters.push(filter)}}}angular.module("srg-play.features").factory("dateFilterService",dateFilterService),dateFilterService.$inject=["translator","moment"]}(),function(){angular.module("srg-play.features").component("srgDateRangePicker",{template:'\n        <div>\n          <form class="date-range-picker__form" name="from-to-form" autocomplete="off"\n            ng-class="{ \'date-range-picker__form--invalid\': $ctrl.isInvalid() }">\n\n            <div class="date-input__wrapper">\n              <input id="from-date" name="from-date" novalidate spellcheck="false" class="date-input"\n                srg-date-model-enhancer\n                ng-model="$ctrl.fromDate"\n                ng-focus="$ctrl.onFocusFrom()"\n                ng-change="$ctrl.onFromDateChanged()"\n                ng-model-options="{ updateOn: \'default blur\', debounce: { default: 250, blur: 0 } }"\n                placeholder="{{ $ctrl.placeholderFrom }}"\n                ng-class="{ \'date-input--active\': $ctrl.isEditingFrom() }" />\n\n              <button type="button" tabindex="-1"\n                class="date-input__reset iconImg iconImgClose"\n                ng-show="$ctrl.showFromDateReset()"\n                ng-click="$ctrl.resetFromDate()" />\n            </div>\n\n            <span class="date-range-picker__message"\n              ng-class="{ \'date-range-picker__message--clickable\': $ctrl.errorMessageClickable() }"\n              ng-click="$ctrl.onErrorClicked()">\n                {{ $ctrl.errorMessage }}\n            </span>\n\n            <p></p>\n\n            <div class="date-input__wrapper">\n              <input id="to-date" name="to-date" novalidate spellcheck="false" class="date-input"\n                srg-date-model-enhancer\n                ng-model="$ctrl.toDate"\n                ng-focus="$ctrl.onFocusTo()"\n                ng-change="$ctrl.onToDateChanged()"\n                ng-model-options="{ updateOn: \'default blur\', debounce: { default: 250, blur: 0 } }"\n                placeholder="{{ $ctrl.placeholderTo }}"\n                ng-class="{ \'date-input--active\': $ctrl.isEditingTo() }" />\n\n              <button type="button" tabindex="-1"\n                class="date-input__reset iconImg iconImgClose"\n                ng-show="$ctrl.showToDateReset()"\n                ng-click="$ctrl.resetToDate()" />\n            </div>\n          </form>\n\n          <button class="date-range-picker__oldest-button"\n            ng-show="$ctrl.isCalendarOpen"\n            ng-click="$ctrl.setToOldest()">\n            {{ ::$ctrl.translate(\'srg.search.filter.date.oldestResult\') }}\n          </button>\n\n          <div class="date-range-picker__calendar" aria-hidden="true">\n            <date-picker-with-model\n              ng-if="$ctrl.isCalendarOpen"\n              config="$ctrl.datePickerConfig"\n              date-model="$ctrl.calendarDate"\n              on-select="$ctrl.onDateSelected(dateString)"\n              before-show-day="$ctrl.formatDatePickerCell(date)">\n            </date-picker-with-model>\n          </div>\n        </div>\n        ',bindings:{fromDate:"<",toDate:"<",minDate:"<",maxDate:"<",openCalendar:"<",onSave:"&",datePickerConfig:"="},controller:["$scope","dateFilterService","moment","angularElement","translator",function($scope,dateFilterService,moment,angularElement,translator){var vm=this;function save(){vm.onSave({fromDate:vm.fromDate,toDate:vm.toDate})}function onDateSelected(dateString){var selectedDate=moment(dateString,"DD-MM-YYYY").startOf("day");vm.isEditingFrom()&&vm.toDate&&selectedDate.isAfter(vm.toDate)?(vm.toDate=selectedDate.toDate(),onFocusTo()):vm.isEditingFrom()||vm.fromDate&&selectedDate.isBefore(vm.fromDate)?(vm.fromDate=selectedDate.toDate(),onFocusFrom(),angular.isUndefined(vm.toDate)?(vm.toDate=vm.fromDate,vm.toDateAutoFilled=!0,onFocusTo()):moment(vm.toDate).startOf("day").isBefore(vm.fromDate)&&(vm.toDate=vm.fromDate,vm.toDateAutoFilled=!0)):(vm.toDate=selectedDate.toDate(),vm.toDateAutoFilled=!1),save()}function onFocusFrom(){vm.isCalendarOpen=!0,vm.calendarDate=vm.fromDate,vm.editingDate="from",vm.placeholderFrom="DD.MM.JJJJ",vm.placeholderTo=translator.translate("srg.search.filter.date.to")}function onFocusTo(){vm.isCalendarOpen=!0,vm.calendarDate=vm.toDate,vm.editingDate="to",vm.placeholderFrom=translator.translate("srg.search.filter.date.from"),vm.placeholderTo="DD.MM.JJJJ"}function resetDates(){vm.fromDate=void 0,vm.toDate=void 0,save()}function resetFromDate(){resetDates(),angularElement("#from-date").focus()}vm.onDateSelected=onDateSelected,vm.formatDatePickerCell=function(date){var theDate=moment(date).startOf("day"),from=moment(vm.fromDate).startOf("day"),to=moment(vm.toDate).startOf("day"),min=moment(vm.minDate).startOf("day"),max=moment(vm.maxDate).startOf("day"),classes=[],isSelectable=!0;(vm.fromDate&&theDate.isSame(from)||vm.toDate&&theDate.isSame(to))&&classes.push("is-selected");vm.fromDate&&vm.toDate&&theDate.isBetween(from,to,null,"()")&&classes.push("is-highlighted");isSelectable=theDate.isBetween(min,max,null,"[]");var resultCount=dateFilterService.getNumberOfResultsForDate(theDate);resultCount>0&&classes.push("is-marked");var resultText=1===resultCount?translator.translate("srg.search.filter.date.singleResult"):translator.translate("srg.search.filter.date.multipleResults");return[isSelectable,classes.join(" "),"".concat(resultCount," ").concat(resultText)]},vm.isInvalid=function(){if(vm.closestResultDate=void 0,angular.isUndefined(vm.fromDate)||angular.isUndefined(vm.toDate))return vm.errorMessage="",!1;var from=moment(vm.fromDate).startOf("day"),to=moment(vm.toDate).startOf("day");if(to.isBefore(from))return vm.errorMessage=translator.translate("srg.search.filter.date.rangeError"),!0;if(0===dateFilterService.getNumberOfResultsBetween(from,to)&&!vm.toDateAutoFilled&&(vm.closestResultDate=function(from,to){var previousResultDate=dateFilterService.getPreviousResult(from),nextResultDate=dateFilterService.getNextResult(to);if(nextResultDate&&previousResultDate){var nextDistance=Math.abs(to.diff(nextResultDate)),previousDistance=Math.abs(from.diff(previousResultDate));return nextDistance<previousDistance?nextResultDate:previousResultDate}return nextResultDate||previousResultDate}(from,to),vm.closestResultDate)){var message=translator.translate("srg.search.filter.date.nextResult");return vm.errorMessage="".concat(message," ").concat(vm.closestResultDate.format("DD.MM.YYYY")),!0}return!1},vm.onFocusFrom=onFocusFrom,vm.onFocusTo=onFocusTo,vm.resetFromDate=resetFromDate,vm.resetToDate=function(){resetDates(),angularElement("#to-date").focus()},vm.onFromDateChanged=function(){vm.calendarDate=vm.fromDate,save()},vm.onToDateChanged=function(){vm.calendarDate=vm.toDate,save()},vm.setToOldest=function(){var firstResult=dateFilterService.getFirstResultDate();if(firstResult){vm.editingDate="from";var oldestAsString=moment(firstResult).format("DD-MM-YYYY");onDateSelected(oldestAsString)}},vm.onErrorClicked=function(){vm.closestResultDate&&(vm.closestResultDate.isAfter(vm.toDate)?(vm.toDate=vm.closestResultDate.toDate(),onFocusTo()):(vm.fromDate=vm.closestResultDate.toDate(),onFocusFrom()),save())},vm.errorMessageClickable=function(){return angular.isDefined(vm.closestResultDate)},vm.isEditingFrom=function(){return"from"===vm.editingDate},vm.isEditingTo=function(){return"to"===vm.editingDate},vm.showFromDateReset=function(){return vm.fromDate&&vm.isEditingFrom()},vm.showToDateReset=function(){return vm.toDate&&vm.isEditingTo()},vm.translate=translator.translate,vm.$onInit=function(){vm.editingDate=void 0,vm.calendarDate=void 0,vm.placeholderTo=translator.translate("srg.search.filter.date.to"),vm.placeholderFrom=translator.translate("srg.search.filter.date.from"),vm.isCalendarOpen=!0===vm.openCalendar,vm.isCalendarOpen&&onFocusFrom()},vm.$onChanges=function(changes){changes.minDate&&vm.datePickerConfig&&(vm.datePickerConfig.minDate=changes.minDate.currentValue)},$scope.$on("reset-dates",function(){return resetFromDate()})}]})}(),function(){angular.module("srg-play.features").component("srgMediaHistogram",{template:'\n        <div class="media-histogram">\n          <ul class="media-histogram__container" aria-hidden="true">\n            <li class="media-histogram__bar"\n              ng-repeat="bar in $ctrl.data.bars track by $index"\n              ng-class="{ \'media-histogram__bar--empty\': bar.resultCount === 0 }"\n              ng-style="{ \'height\': $ctrl.calculateBarHeight(bar) }"\n              ng-click="$ctrl.onBarClicked(bar)">\n\n              <div class="histogram-tooltip" ng-if="$ctrl.isEnabled() && bar.resultCount !== 0">\n                <p class="histogram-tooltip__title">{{ bar.resultCount }}</p>\n                <p class="histogram-tooltip__label">{{ bar.label }}</p>\n                <div class="histogram-tooltip__arrow"></div>\n              </div>\n\n            </li>\n          </ul>\n\n          <div class="media-histogram__labels" aria-hidden="true">\n            <span>{{ $ctrl.data.startLabel}}</span>\n            <span>{{ $ctrl.data.endLabel}}</span>\n          </div>\n        </div>\n        ',bindings:{data:"<",isDisabled:"<",onDateRangeSelected:"&"},controller:[function(){var histogramHeight=70,vm=this;vm.onBarClicked=function(bar){vm.isEnabled()&&vm.onDateRangeSelected({fromDate:bar.dateRange.fromDate,toDate:bar.dateRange.toDate})},vm.calculateBarHeight=function(bar){var resultCount=bar.resultCount,maxResults=vm.data.maxResults;if(angular.isUndefined(resultCount)||0===resultCount)return;var percent=100/maxResults*resultCount,roundedTo5Percent=Math.max(5*Math.round(percent/5),10),height=Math.round(histogramHeight*roundedTo5Percent/100);return"".concat(height,"px")},vm.isEnabled=function(){return!0!==vm.isDisabled},vm.data={}}]})}(),function(){angular.module("srg-play.features").component("srgMobileDateFilter",{template:'\n      <section class="mobile-filter-view">\n        <header class="mobile-filter-header">\n          <button class="mobile-filter-header__back"\n            aria-label="{{ ::$ctrl.translate(\'srg.search.close\') }}"\n            ng-click="$ctrl.back()"></button>\n\n          <h1 class="mobile-filter-header__title" ng-click="$ctrl.back()">\n            {{ ::$ctrl.translate(\'srg.search.filter.mobile.chooseDateRange\') }}\n          </h1>\n\n          <button class="mobile-filter-header__reset"\n            ng-if="$ctrl.canReset()"\n            ng-click="$ctrl.reset()">\n            {{ ::$ctrl.translate(\'srg.search.filter.mobile.reset\') }}\n          </button>\n        </header>\n\n        <section class="mobile-filter-content">\n\n          <srg-media-histogram\n              is-disabled="true"\n              aria-hidden="true"\n              data="$ctrl.histogramData"/>\n\n          <ul>\n            <li class="filter-list-item"\n              ng-repeat="filter in $ctrl.quickFilters track by $index"\n              ng-class="{ \'filter-list-item--selected\': $ctrl.isQuickFilterActive(filter) }">\n              <input class="filter-list-item__input" type="checkbox"\n                id="filter-{{ $index }}"\n                ng-click="$ctrl.setQuickFilter(filter)"\n                ng-checked="$ctrl.isQuickFilterActive(filter)">\n\n              <label class="filter-list-item__label" for="filter-{{ $index }}" tabindex="0">\n                {{ filter.label }}\n              </label>\n\n              <div class="filter-list-item__checkmark" ng-if="$ctrl.isQuickFilterActive(filter) "></div>\n            </li>\n          </ul>\n\n          <button class="mobile-date-filter" ng-click="$ctrl.openDateRangePicker()">\n              {{ ::$ctrl.translate(\'srg.search.filter.mobile.chooseDateRange\') }}\n          </button>\n        </section>\n      </section>',bindings:{dateFilter:"<",histogramData:"<",datePickerConfig:"=",onSave:"&"},controller:["$scope","viewStack","dateFilterService","translator",function($scope,viewStack,dateFilterService,translator){var vm=this;vm.translate=translator.translate,vm.$onChanges=function(changes){if(changes.dateFilter){var dateFilter=changes.dateFilter.currentValue||{};vm.fromDate=dateFilterService.toDate(dateFilter.fromDate),vm.toDate=dateFilterService.toDate(dateFilter.toDate),vm.quickFilters=dateFilterService.getQuickFilters()||[]}},vm.back=function(){vm.save(),viewStack.pop()},vm.canReset=function(){return vm.fromDate&&vm.toDate},vm.reset=function(){vm.fromDate=void 0,vm.toDate=void 0,vm.save()},vm.close=function(){vm.save(),viewStack.clear()},vm.hasQuickFilters=function(){return vm.quickFilters.length>0},vm.isQuickFilterActive=function(quickFilter){return quickFilter.fromDate===dateFilterService.toDateString(vm.fromDate)&&quickFilter.toDate===dateFilterService.toDateString(vm.toDate)},vm.setQuickFilter=function(quickFilter){vm.fromDate=dateFilterService.toDate(quickFilter.fromDate),vm.toDate=dateFilterService.toDate(quickFilter.toDate),vm.close()},vm.save=function(){return vm.onSave({fromDate:dateFilterService.toDateString(vm.fromDate),toDate:dateFilterService.toDateString(vm.toDate)})},vm.onDateRangeSelected=function(fromDate,toDate){return vm.onSave({fromDate:fromDate,toDate:toDate})},vm.openDateRangePicker=function(){viewStack.push({template:'<srg-mobile-date-range-picker\n                         date-picker-config="$ctrl.datePickerConfig"\n                         date-filter="$ctrl.dateFilter"\n                         on-save="$ctrl.onDateRangeSelected(fromDate, toDate)">',scope:$scope})}}]})}(),function(){angular.module("srg-play.features").component("srgMobileDateRangePicker",{template:'\n      <section class="mobile-filter-view">\n        <header class="mobile-filter-header">\n          <button class="mobile-filter-header__back"\n            aria-label="{{ ::$ctrl.translate(\'srg.search.close\') }}"\n            ng-click="$ctrl.back()"></button>\n\n          <h1 class="mobile-filter-header__title" ng-click="$ctrl.back()">\n            {{ ::$ctrl.translate(\'srg.search.filter.mobile.chooseDateRange\') }}\n          </h1>\n\n          <button class="mobile-filter-header__reset"\n            ng-if="$ctrl.canReset()"\n            ng-click="$ctrl.reset()">\n              {{ ::$ctrl.translate(\'srg.search.filter.mobile.reset\') }}\n          </button>\n        </header>\n\n        <section class="mobile-filter-content mobile-filter-content--full-width mobile-date-range-picker">\n          <srg-date-range-picker\n            from-date="$ctrl.fromDate"\n            to-date="$ctrl.toDate"\n            min-date="$ctrl.minDate"\n            max-date="$ctrl.maxDate"\n            open-calendar="true"\n            on-save="$ctrl.onDateRangeChanged(fromDate, toDate)"\n            date-picker-config="$ctrl.datePickerConfig" />\n\n          <div class="mobile-date-range-picker__filler"></div>\n        </section>\n\n        <footer class="mobile-filter-footer">\n          <button class="mobile-filter-footer__button" ng-click="$ctrl.close()">\n            {{ $ctrl.resultText }}\n          </button>\n        </footer>\n      </section>',bindings:{datePickerConfig:"=",dateFilter:"<",onSave:"&"},controller:["$scope","viewStack","dateFilterService","translator","moment",function($scope,viewStack,dateFilterService,translator,moment){var vm=this;function updateResultCount(){var resultCount,fromDate=moment(vm.fromDate),toDate=moment(vm.toDate);fromDate&&toDate&&(resultCount=dateFilterService.getNumberOfResultsBetween(fromDate,toDate));var text=1===resultCount?translator.translate("srg.search.filter.date.singleResult"):translator.translate("srg.search.filter.date.multipleResults");vm.resultText="".concat(resultCount," ").concat(text)}function setupMoment(){var locale=moment.locale();moment.updateLocale(locale,{months:vm.datePickerConfig.months,monthsShort:vm.datePickerConfig.months.map(function(s){return s.substring(0,3)})})}vm.$onInit=function(){return setupMoment},vm.$onChanges=function(changes){if(changes.dateFilter){var dateFilter=changes.dateFilter.currentValue||{};vm.fromDate=dateFilterService.toDate(dateFilter.fromDate),vm.toDate=dateFilterService.toDate(dateFilter.toDate)}var firstResultDate;firstResultDate=dateFilterService.getFirstResultDate(),vm.minDate=moment(firstResultDate,dateFilterService.dateFormat).startOf("day").toDate(),vm.maxDate=moment().endOf("day").toDate(),updateResultCount()},vm.translate=translator.translate,vm.canReset=function(){return vm.fromDate||vm.toDate},vm.back=function(){vm.save(),viewStack.pop()},vm.close=function(){vm.save(),viewStack.clear()},vm.save=function(){return vm.onSave({fromDate:dateFilterService.toDateString(vm.fromDate),toDate:dateFilterService.toDateString(vm.toDate)})},vm.reset=function(){return $scope.$broadcast("reset-dates")},vm.onDateRangeChanged=function(fromDate,toDate){vm.fromDate=fromDate,vm.toDate=toDate,updateResultCount()}}]})}(),function(){angular.module("srg-play.features").component("srgMobileFilterList",{template:'\n      <section class="mobile-filter-view">\n        <header class="mobile-filter-header">\n          <button class="mobile-filter-header__back"\n            aria-label="{{ ::$ctrl.translate(\'srg.search.close\') }}"\n            ng-click="$ctrl.back()"></button>\n\n          <h1 class="mobile-filter-header__title" ng-click="$ctrl.back()">\n            {{ ::$ctrl.translate($ctrl.titleLabel) }}\n          </h1>\n\n          <button class="mobile-filter-header__reset"\n            ng-if="$ctrl.hasSelectedItems()"\n            ng-click="$ctrl.reset()">\n            {{ ::$ctrl.translate(\'srg.search.filter.mobile.reset\') }}\n          </button>\n        </header>\n\n        <section class="mobile-filter-content">\n\n          <div class="mobile-filter-search__wrapper" ng-if="$ctrl.showFilter()">\n            <input class="mobile-filter-search__input" type="search"\n              novalidate spellcheck="false" autocomplete="off"\n              ng-model="$ctrl.filter"\n              placeholder="{{ ::$ctrl.translate(\'srg.search.dropdown.search\') }}" />\n\n            <button class="mobile-filter-search__reset iconImg"\n              type="button" tabindex="-1"\n              ng-class="$ctrl.getFilterIcon()"\n              aria-label="{{ ::$ctrl.translate(\'srg.search.reset\') }}"\n              ng-click="$ctrl.resetFilter()"></button>\n          </div>\n\n          <ul>\n            <li class="filter-list-item"\n              ng-class="{ \'filter-list-item--selected\': $ctrl.isSelected(value.id) }"\n              ng-repeat="value in $ctrl.values | filter:{ title: $ctrl.filter }:false""\n              ng-click="$ctrl.toggleValue(value.id)">\n\n                <input class="filter-list-item__input"\n                  ng-if="!$ctrl.isDivider(value)"\n                  type="checkbox"\n                  id="dropdown-{{ value.id }}"\n                  ng-click="$ctrl.toggleValue(value.id)"\n                  ng-checked="$ctrl.isSelected(value.id)">\n\n                <label class="filter-list-item__label"\n                  for="dropdown-{{ value.id }}"\n                  ng-if="!$ctrl.isDivider(value)"\n                  aria-label="{{ $ctrl.ariaLabelFor(value) }}"\n                  tabindex="0">\n                  <span ng-bind-html="$ctrl.highlight(value.title)"></span>\n                  <span aria-hidden="true">({{ value.count }})</span>\n                </label>\n\n                <div class="filter-list-item__checkmark" ng-if="$ctrl.isSelected(value.id)"></div>\n\n                <hr class="filter-list-item__divider" ng-if="$ctrl.isDivider(value)" aria-hidden="true">\n            </li>\n          </ul>\n        </section>\n\n        <footer class="mobile-filter-footer">\n          <button class="mobile-filter-footer__button" ng-click="$ctrl.close()">\n            {{ $ctrl.closeButtonText() }}\n          </button>\n        </footer>\n      </section>',bindings:{values:"<",selectedValues:"<",totalResults:"<",sumResults:"<",onSave:"&",titleLabel:"@"},controller:["viewStack","translator",function(viewStack,translator){var vm=this;vm.translate=translator.translate,vm.$onInit=function(){vm.selectedValues=vm.selectedValues||[],vm.values=vm.values||[]},vm.hasSelectedItems=function(){return vm.selectedValues.length>0},vm.isDivider=function(value){return"divider"===value.id},vm.isSelected=function(id){return vm.selectedValues.indexOf(id)>=0},vm.isSingleSelectionButton=function(id){return["shorterThan5","longerThan30"].indexOf(id)>=0},vm.back=function(){vm.save(),viewStack.pop()},vm.close=function(){vm.save(),viewStack.clear()},vm.reset=function(){vm.selectedValues=[],vm.resetFilter(),vm.save()},vm.save=function(){return vm.onSave({selectedValues:vm.selectedValues})},vm.toggleValue=function(id){vm.isDivider({id:id})||(vm.isSelected(id)?vm.selectedValues=vm.selectedValues.filter(function(selectedId){return selectedId!==id}):(vm.isSingleSelectionButton(id)&&(vm.selectedValues=vm.selectedValues.filter(function(selectedId){return!vm.isSingleSelectionButton(selectedId)})),vm.selectedValues=vm.selectedValues.concat(id)))},vm.showFilter=function(){return vm.values.filter(function(v){return!vm.isDivider(v)}).length>12},vm.getFilterIcon=function(){return vm.filter&&vm.filter.length>0?"iconImgClose":"iconImgSearch"},vm.resetFilter=function(){return vm.filter=void 0},vm.highlight=function(title){return angular.isUndefined(vm.filter)||angular.isUndefined(title)?title:title.replace(new RegExp(vm.filter,"gi"),function(match){return'<span class="dropdown__item--highlighted">'.concat(match,"</span>")})},vm.closeButtonText=function(){return vm.sumResults?vm.sumResultsLabel():translator.translate("srg.search.filter.showResults")},vm.sumResultsLabel=function(){var selectedCount=vm.values.filter(function(item){return vm.isSelected(item.id)}).reduce(function(totalCount,item){return totalCount+item.count},0);if(0===selectedCount)return translator.translate("srg.search.close");var resultText=1===selectedCount?translator.translate("srg.search.filter.date.singleResult"):translator.translate("srg.search.filter.date.multipleResults"),count=0===selectedCount?vm.totalResults:selectedCount;return"".concat(count," ").concat(resultText)},vm.ariaLabelFor=function(value){return vm.isSelected(value.id)?"".concat(translator.translate("srg.search.selected")," ").concat(value.title):"".concat(value.title," ").concat(translator.translate("srg.search.select"))}}]})}(),function(){angular.module("srg-play.features").component("srgMobileFilterOverview",{template:'\n      <section class="mobile-filter-view">\n        <header class="mobile-filter-header">\n          <button class="mobile-filter-header__back"\n            aria-label="{{ ::$ctrl.translate(\'srg.search.close\') }}"\n            ng-click="$ctrl.back()"></button>\n\n          <h1 class="mobile-filter-header__title" ng-click="$ctrl.back()">\n            {{ ::$ctrl.translate(\'srg.search.filter.mobile.filter\') }} {{ $ctrl.getSearchTerm() }}\n          </h1>\n\n          <button class="mobile-filter-header__reset"\n            ng-if="$ctrl.canReset()"\n            ng-click="$ctrl.reset()">\n              {{ ::$ctrl.translate(\'srg.search.filter.mobile.reset\') }}\n          </button>\n        </header>\n\n        <section class="mobile-filter-content">\n\n          <div class="media-type-selection">\n            <button class="media-type-selection__button"\n              ng-class="{ \'media-type-selection__button--active\': $ctrl.showingAll() }"\n              ng-click="$ctrl.showAll()">\n              {{ ::$ctrl.translate(\'srg.search.filterby.all\') }}\n            </button>\n\n            <button class="media-type-selection__button"\n              ng-class="{ \'media-type-selection__button--active\': $ctrl.showingVideos() }"\n              ng-click="$ctrl.showVideos()">\n              {{ ::$ctrl.translate(\'srg.search.filterby.video\') }}\n            </button>\n\n            <button class="media-type-selection__button"\n              ng-class="{ \'media-type-selection__button--active\': $ctrl.showingAudios() }"\n              ng-click="$ctrl.showAudios()">\n              {{ ::$ctrl.translate(\'srg.search.filterby.audio\') }}\n            </button>\n          </div>\n\n          <div class="loadingContainer loadingContainer--big"\n              ng-if="$ctrl.isLoading" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div>\n\n          <button class="filter-selection-button"ng-click="$ctrl.showTopics()"\n            ng-class="{ \'filter-selection-button--disabled\': $ctrl.noFiltersFor(\'topics\') }">\n              <span class="filter-selection-button__title">{{ ::$ctrl.translate(\'srg.search.filter.topics\') }}</span>\n              <span class="filter-selection-button__text" ng-if="$ctrl.hasSelected(\'topics\')">{{ $ctrl.getSelected(\'topics\') }}</span>\n              <span class="filter-selection-button__text" ng-if="$ctrl.noFiltersFor(\'topics\')">{{ $ctrl.translate(\'srg.search.filter.noResults\') }}</span>\n          </button>\n          <hr class="mobile-filter-content__divider" aria-hidden="true">\n\n          <button class="filter-selection-button" ng-click="$ctrl.showShows()"\n            ng-class="{ \'filter-selection-button--disabled\': $ctrl.noFiltersFor(\'shows\') }">\n            <span class="filter-selection-button__title">{{ ::$ctrl.translate(\'srg.search.filter.shows\') }}</span>\n            <span class="filter-selection-button__text" ng-if="$ctrl.hasSelected(\'shows\')">{{ $ctrl.getSelected(\'shows\') }}</span>\n            <span class="filter-selection-button__text" ng-if="$ctrl.noFiltersFor(\'shows\')">{{ $ctrl.translate(\'srg.search.filter.noResults\') }}</span>\n          </button>\n          <hr class="mobile-filter-content__divider" aria-hidden="true">\n\n          <button class="filter-selection-button" ng-click="$ctrl.openDateFilter()">\n            <span class="filter-selection-button__title">{{ ::$ctrl.translate(\'srg.search.filter.date\') }}</span>\n            <span class="filter-selection-button__text" ng-if="$ctrl.hasSelected(\'publishedDate\')">{{ $ctrl.getSelected(\'publishedDate\') }}</span>\n          </button>\n          <srg-media-histogram\n            is-disabled="true"\n            ng-click="$ctrl.openDateFilter()"\n            aria-hidden="true"\n            data="$ctrl.histogramData"/>\n          <hr class="mobile-filter-content__divider" aria-hidden="true">\n\n          <button class="filter-selection-button" ng-click="$ctrl.showFeatures()"\n            ng-class="{ \'filter-selection-button--disabled\': $ctrl.noFiltersFor(\'features\') }">\n            <span class="filter-selection-button__title">{{ ::$ctrl.translate(\'srg.search.filter.features\') }}</span>\n            <span class="filter-selection-button__text" ng-if="$ctrl.hasSelected(\'features\')">{{ $ctrl.getSelected(\'features\') }}</span>\n            <span class="filter-selection-button__text" ng-if="$ctrl.noFiltersFor(\'features\')">{{ $ctrl.translate(\'srg.search.filter.noResults\') }}</span>\n          </button>\n        </section>\n\n        <footer class="mobile-filter-footer">\n          <button class="mobile-filter-footer__button" ng-click="$ctrl.back()">\n            {{ $ctrl.closeButtonText() }}\n          </button>\n        </footer>\n      </section>',bindings:{topics:"<",shows:"<",features:"<",querySettings:"<",chips:"<",totalResults:"<",isLoading:"<",datePickerConfig:"="},controller:["$scope","viewStack","searchState","dateFilterService","translator","searchTrackingService",function($scope,viewStack,searchState,dateFilterService,translator,searchTrackingService){var vm=this;vm.$onInit=function(){vm.querySettings=vm.querySettings||{},vm.chips=vm.chips||[]},vm.$onChanges=function(changes){changes.isLoading&&updateHistogram()},vm.translate=translator.translate,vm.showAll=function(){return vm.setMediaType()},vm.showingAll=function(){return!vm.querySettings.mediaType},vm.showVideos=function(){return vm.setMediaType("video")},vm.showingVideos=function(){return"video"===vm.querySettings.mediaType},vm.showAudios=function(){return vm.setMediaType("audio")},vm.showingAudios=function(){return"audio"===vm.querySettings.mediaType},vm.canReset=function(){return vm.querySettings.mediaType||vm.querySettings.shows.length>0||vm.querySettings.topics.length>0||vm.querySettings.features.length>0||vm.querySettings.dateFilter.fromDate},vm.setMediaType=function(type){vm.querySettings.mediaType!==type&&searchState.setMediaType(type)},vm.back=function(){return viewStack.pop()},vm.reset=function(){searchState.removeAllFilters(),searchState.setMediaType()},vm.showTopics=function(){return pushViewFor("topics")},vm.showShows=function(){return pushViewFor("shows")},vm.showFeatures=function(){return pushViewFor("features")},vm.setFilter=function(filterName,selectedValues){searchState.setFilter(filterName,selectedValues),searchTrackingService.trackFilter(filterName)},vm.getSelected=function(type){return vm.chips.filter(function(chip){return chip.aggregation===type}).map(function(chip){return chip.title}).join(", ")},vm.hasSelected=function(type){return vm.chips.filter(function(chip){return chip.aggregation===type}).length>0},vm.noFiltersFor=function(type){return!vm[type]||0===vm[type].length},vm.closeButtonText=function(){var resultText=1===vm.totalResults?translator.translate("srg.search.filter.date.singleResult"):translator.translate("srg.search.filter.date.multipleResults");return"".concat(vm.totalResults," ").concat(resultText)};var pushViewFor=function(type){vm.noFiltersFor(type)||viewStack.push({template:'<srg-mobile-filter-list\n                        values="$ctrl.'.concat(type,'"\n                        selected-values="$ctrl.querySettings.').concat(type,'"\n                        on-save="$ctrl.setFilter(\'').concat(type,'\', selectedValues)"\n                        total-results="$ctrl.totalResults"\n                        sum-results="').concat("features"===type?"false":"true",'"\n                        title-label="srg.search.filter.').concat(type,'">'),scope:$scope})};vm.setDateFilter=function(fromDate,toDate){searchState.setDateFilter(fromDate,toDate),searchTrackingService.trackDateFilter()},vm.openDateFilter=function(){viewStack.push({template:'<srg-mobile-date-filter\n                         date-filter="$ctrl.querySettings.dateFilter"\n                         histogram-data="$ctrl.histogramData"\n                         date-picker-config="$ctrl.datePickerConfig"\n                         on-save="$ctrl.setDateFilter(fromDate, toDate)">',scope:$scope})},vm.getSearchTerm=function(){return vm.querySettings.query?"'".concat(vm.querySettings.query,"'"):""};var updateHistogram=function(){return vm.histogramData=dateFilterService.getHistogramData()}}]})}(),function(){function searchPageController($scope,$q,$window,$document,searchRequestService,searchState,searchChipsFactory,searchTrackingService,escapeHtml,searchRecommendationService,dateFilterService,viewPorts,viewStack,translator,SRGConfig){var vm=this;function addToSearchHistory(){searchRecommendationService.addToSearchHistory(vm.querySettings.query)}function handleShowsResults(showsResult){vm.shows=showsResult.shows,vm.showsTotal=showsResult.total,vm.showsNextPageHash=showsResult.nextPageHash}function handleMediaResults(mediaResult){vm.media=mediaResult.media,vm.mediaTotal=mediaResult.total,vm.aggregations=mediaResult.aggregations||{},vm.mediaNextPageHash=mediaResult.nextPageHash,vm.suggestion=mediaResult.suggestion,vm.showSuggestion=0===mediaResult.exactMatchTotal&&vm.suggestion,vm.suggestionUrl=searchState.getSearchUrlFor(vm.suggestion).toString(),vm.isDownloadFilterSelected=vm.querySettings.features.some(function(feature){return"downloadAvailable"===feature}),function(){if(vm.autoSuggestion.loading)return void(vm.autoSuggestion.loading=!1);vm.querySettings.includeAggregations&&vm.suggestion&&0===vm.mediaTotal?(searchState.setQuery(vm.suggestion,!0),vm.autoSuggestion={loading:!0,originalQuery:vm.querySettings.query}):vm.autoSuggestion={}}(),vm.querySettings.includeAggregations&&addToSearchHistory(),dateFilterService.setResultDates(vm.aggregations.publishedDate),vm.chips=searchChipsFactory.createChips(vm.aggregations)}function handleMoreMedia(mediaResult){vm.mediaLoading=!1,vm.media=vm.media.concat(mediaResult.media),vm.mediaNextPageHash=mediaResult.nextPageHash}function handleMoreShows(showsResult){vm.showsLoading=!1,vm.shows=vm.shows.concat(showsResult.shows),vm.showsNextPageHash=showsResult.nextPageHash}function hasToBeTruncated(description){return description&&description.length>getUpperCharacterLimit()}function getUpperCharacterLimit(){return{xlarge:220,large:80,medium:70,small:40}[viewPorts.getCurrent()]}vm.translate=translator.translate,vm.showVideos=function(){searchTrackingService.trackFilter("video"),searchState.setMediaType("video")},vm.showAudios=function(){searchTrackingService.trackFilter("audio"),searchState.setMediaType("audio")},vm.showAll=function(){searchState.setMediaType()},vm.loadMoreMedia=function(){vm.mediaLoading=!0,vm.lastLoadedMediaHash=vm.mediaNextPageHash,searchRequestService.searchMedia(vm.querySettings,vm.mediaNextPageHash).then(handleMoreMedia)},vm.loadMoreShows=function(){vm.showsLoading=!0,searchRequestService.searchShows(vm.querySettings,vm.showsNextPageHash).then(handleMoreShows)},vm.loadAggregations=function(){vm.querySettings.includeAggregations||searchState.includeAggregations(!0)},vm.onOpenShow=function(show,position){addToSearchHistory(),searchRequestService.trackShowClick(show.urn),searchTrackingService.trackOpenShow(position)},vm.onOpenMedia=function(position){addToSearchHistory(),searchTrackingService.trackOpenMedia(position)},vm.setFilter=function(filterName,selectedIds){searchState.setFilter(filterName,selectedIds),searchTrackingService.trackFilter(filterName)},vm.setDateFilter=function(fromDate,toDate){searchState.setDateFilter(fromDate,toDate),searchTrackingService.trackDateFilter()},vm.removeFilter=function(chip){searchState.removeFilter(chip.aggregation,chip.id)},vm.removeAllFilters=function(){searchState.removeAllFilters()},vm.setMediaResultsHeading=function(data){var wording;wording="video"!==vm.querySettings.mediaType&&SRGConfig.features.isAdvancedSearchSupported?"audio"===vm.querySettings.mediaType?data.audio:"".concat(data.video," ").concat(data.and," ").concat(data.audio):data.video;return"".concat(function(data){return vm.querySettings.query?"'".concat(escapeHtml(vm.querySettings.query),"'"):"".concat(data.all)}(data),'&nbsp;\n              <span class="search-header__count">').concat(data.in," ").concat(wording," (").concat(vm.mediaTotal||0,")</span>")},vm.autoSuggestion={},vm.showAutoSuggestion=function(){return vm.autoSuggestion&&!1===vm.autoSuggestion.loading},vm.noResults=function(){return vm.media&&0===vm.media.length&&!vm.loading},vm.truncate=function(description){if(!hasToBeTruncated(description))return description;var lastSpaceInDescription=description.lastIndexOf(" ",getUpperCharacterLimit());return"".concat(description.slice(0,lastSpaceInDescription)," ...")},vm.hasToBeTruncated=hasToBeTruncated,vm.hasDownloadChoice=function(media){return!(!media.downloadHdUrl||!media.downloadSdUrl)},vm.showDialog=function(media){viewStack.pushDialog({template:'<div class="dialog">\n                     <header class="dialog__title">[{[ ::search.translate(\'srg.search.download.selectResolution\') ]}]</header>\n                     <hr class="dialog__divider">\n                     <main class="dialog__content">\n                       <a class="dialog__links" ng-href="'.concat(media.downloadSdUrl,'" ng-click="search.closeDialog()" target="_blank" aria-label="[{[ ::search.translate(\'srg.search.download.sd\') ]}]" download>\n                         <span>[{[ ::search.translate(\'srg.search.download.sd\') ]}]</span>\n                         <span>(SD)</span>\n                       </a>\n                       <a class="dialog__links" ng-href="').concat(media.downloadHdUrl,'" ng-click="search.closeDialog()" target="_blank" aria-label="[{[ ::search.translate(\'srg.search.download.hd\') ]}]" download>\n                         <span>[{[ ::search.translate(\'srg.search.download.hd\') ]}]</span>\n                         <span>(HD)</span>\n                       </a>\n                     </main>\n                     <div class="dialog__buttons">\n                       <button ng-click="search.closeDialog()">[{[ ::search.translate(\'srg.search.download.cancel\') ]}]</button>\n                     </div>\n                   </div>'),scope:$scope})},vm.openMobileFilters=function(datePickerConfig){vm.datePickerConfig=datePickerConfig,vm.loadAggregations(),viewStack.push({template:'<srg-mobile-filter-overview\n                    topics="search.aggregations.topics"\n                    shows="search.aggregations.shows"\n                    features="search.aggregations.features"\n                    query-settings="search.querySettings"\n                    chips="search.chips"\n                    is-loading="search.loading"\n                    date-picker-config="search.datePickerConfig"\n                    total-results="search.mediaTotal">',scope:$scope})},vm.querySettings={},vm.loading=!1,vm.isDownloadFilterSelected=!1,vm.media=[],vm.aggregations=[],vm.chips=[],vm.mediaLoading=!1,vm.mediaTotal=void 0,vm.mediaNextPageHash,vm.lastLoadedMediaHash="",vm.showSuggestion=!1,vm.suggestionUrl="",vm.suggestion="",vm.shows=[],vm.showsLoading=!1,vm.showsTotal=void 0,vm.showsNextPageHash,$scope.$watch(searchState.watchQuerySettings,function(){if(vm.querySettings=searchState.getQuerySettings(),angular.isUndefined(vm.querySettings.query))return;$document[0].documentElement.scrollTop=0;var mediaSearchPromise=searchRequestService.searchMedia(vm.querySettings).then(handleMediaResults),showSearchPromise=$q.when();SRGConfig.features.isAdvancedSearchSupported&&(showSearchPromise=searchRequestService.searchShows(vm.querySettings).then(handleShowsResults));vm.loading=!0,$q.all([showSearchPromise,mediaSearchPromise]).finally(function(){vm.loading=!1})},!0),$scope.$on("$locationChangeSuccess",function(){searchState.isSearchPageOpen()||viewStack.clear()}),viewPorts.callbackForAny(function(){viewStack.clear()}),angular.element($window).scroll(function(){if(vm.loading||vm.mediaLoading||angular.isUndefined(vm.mediaNextPageHash)||null===vm.mediaNextPageHash||vm.mediaNextPageHash===vm.lastLoadedMediaHash)return;docEl=$document[0].documentElement,scrollTop=docEl.scrollTop||$document[0].body.scrollTop,(docEl.scrollHeight||$document[0].body.scrollHeight)-(scrollTop+docEl.clientHeight)<150&&vm.loadMoreMedia();var docEl,scrollTop}),vm.closeDialog=function(){viewStack.pop()}}angular.module("srg-play.features").controller("searchPageController",searchPageController),searchPageController.$inject=["$scope","$q","$window","$document","searchRequestService","searchState","searchChipsFactory","searchTrackingService","escapeHtml","searchRecommendationService","dateFilterService","viewPorts","viewStack","translator","SRGConfig"]}(),function(){function searchTrackingService(tcEvents,$state,searchState){var filterMappings={topics:"SetTopicFilter",shows:"SetShowFilter",features:"SetPropertyFilter",audio:"SetAudioFilter",video:"SetVideoFilter"};return{trackOpenSearch:function(query){trackEvent({name:"OpenSearchPage",query:query})},trackOpenMedia:function(position){trackEvent({name:"OpenMedia",position:position})},trackOpenShow:function(position){trackEvent({name:"OpenShow",position:position})},trackFilter:function(filterName){trackEvent({name:filterMappings[filterName]})},trackDateFilter:function(){trackEvent({name:"SetDateFilter"})}};function trackEvent(event){if(event){var querySettings=searchState.getQuerySettings(),tcEvent={id:"hidden_event",data:{event_type:"SearchFlyout",event_name:event.name,event_value_1:$state.current.name,event_value_2:event.query||querySettings.query,event_value_3:querySettings.mediaType||"all",event_value_4:event.position&&"".concat(event.position)}};tcEvents(tcEvent)}}}angular.module("srg-play.features").factory("searchTrackingService",searchTrackingService),searchTrackingService.$inject=["tcEvents","$state","searchState"]}(),function(){angular.module("srg-play.features").component("srgHeaderDescription",{template:'<div class="header-description">\n              <pre class="header-description__description"\n                  aria-label="{{ ::$ctrl.description }}"\n                  tabindex="0">{{ $ctrl.getDescription() }}</pre>\n              <button ng-if="$ctrl.canExpand()"\n                  ng-click="$ctrl.expandDescription()"\n                  class="header-description__show-more"\n                  aria-hidden="true">{{ ::$ctrl.showMoreTranslation }}\n               </button>\n            </div>',bindings:{description:"@",showMoreTranslation:"@"},controller:["viewPorts",function(viewPorts){var viewPort,vm=this,isDescriptionExpanded=!1;vm.$onInit=function(){viewPort=viewPorts.getCurrent()},vm.canExpand=function(){return!isDescriptionExpanded&&getLines().length>getMaxLines()},vm.expandDescription=function(){return isDescriptionExpanded=!0},vm.getDescription=function(){if(!vm.canExpand())return vm.description;return getLines().slice(0,getMaxLines()).join("").trim().replace(/.{3}$/i,"...")};var widthToCharCount=function(width){return Math.floor(width/7.5)},getMaxLines=function(){return{xlarge:5,large:4,medium:3}[viewPort]},getLines=function(){var charsPerLine={xlarge:widthToCharCount(700),large:widthToCharCount(624),medium:widthToCharCount(399)}[viewPort];if(!charsPerLine)return[];var lineRegex=new RegExp("(\\n?.{0,".concat(charsPerLine,"})"));return vm.description.split(lineRegex).filter(function(s){return!!s})}}]})}(),function(){function ShowOverviewController(_,$scope,$attrs,$location,SRGConfig,moment,PlayJSONWebservice,viewPorts,showHistory,mediaStageGeoblockFilter,URI){var currentViewPort,isFirstRequestDone,historyEntry,TV_SUB_PORTAL="tv";function showMostClickedVideosModule(){$scope.shouldShowMostClickedVideosByTopicModule=!0}function toggleShowInformation(){$scope.showInformationVisible=!$scope.showInformationVisible}function getEpisodeSubtitle(teaserId){var episode=_.find(_.propEq("id",teaserId),$scope.episodes);return currentViewPort===viewPorts.SMALL_TYPE?episode.publishDatePhrase:episode.subtitle}function showCompleteDescription(){$scope.shouldShowCompleteDescription=!0}function updateFormattedMaxDate(date){$scope.formattedMaxDate=moment(date).format($attrs.displayDateFormat)}function requestEpisodes(dateString){var maxDate=moment(dateString,"DD-MM-YYYY").toDate();updateFormattedMaxDate(maxDate),requestNewEpisodes(buildLatestEpisodesUrlForDate(maxDate))}function buildLatestEpisodesUrlForDate(date){var defaultMaxDate=$attrs.latestEpisodesResourceUrl.indexOf("maxDate=ALL")>-1?"ALL":moment().format("YYYY-MM-DD"),maxDate=date?moment(date).format("YYYY-MM-DD"):defaultMaxDate,baseRequestUrl=$attrs.latestEpisodesResourceUrl.split("?")[0];return URI(baseRequestUrl).addSearch({maxDate:maxDate}).toString()}function requestNewEpisodes(url){$scope.episodes=[],$scope.datePickerVisible=!1,doRequest(url,handleReplacementEpisodeResponse)}function requestNextEpisodes(){doRequest($scope.nextPageUrl,handleEpisodeResponse)}function doRequest(url,responseHandler){$scope.requestInProcess=!0,$scope.dateSelectionVisible=!1,PlayJSONWebservice.getResource(url).get(responseHandler,handleErrorResponse)}function handleReplacementEpisodeResponse(response){$scope.showNoContentForSelectedDateMessage=!response.episodesAvailableForSelectedDate&&isFirstRequestDone,handleEpisodeResponse(response),isFirstRequestDone=!0}function handleEpisodeResponse(response){if($scope.requestInProcess=!1,$scope.dateSelectionVisible=!0,response.episodes.length){$scope.showNoMoreContentMessage=!1,$scope.nextPageUrl=response.nextPageUrl;var episodes=mediaStageGeoblockFilter.filter(response.episodes);$scope.episodes=$scope.episodes.concat(episodes)}else $scope.showNoMoreContentMessage=!0,$scope.showNoContentForSelectedDateMessage=!1;response.nextPageUrl||($scope.showNoMoreContentMessage=!0)}function handleErrorResponse(){$scope.requestInProcess=!1,$scope.dateSelectionVisible=!0,$scope.showNoMoreContentMessage=!0}$scope.episodes=[],$scope.nextPageUrl=null,$scope.showPodcastFlyout=!1,$scope.requestInProcess=!1,$scope.datePickerVisible=!1,$scope.dateSelectionVisible=!1,$scope.maxDate=moment().toDate(),$scope.showNoMoreContentMessage=!1,$scope.showInformationVisible=!1,$scope.shouldShowCompleteDescription=!1,$scope.showNoContentForSelectedDateMessage=!1,$scope.toggleShowInformation=toggleShowInformation,$scope.requestEpisodes=requestEpisodes,$scope.requestNextEpisodes=requestNextEpisodes,$scope.getTeaserSubtitleForViewport=getEpisodeSubtitle,$scope.showCompleteDescription=showCompleteDescription,$scope.showMostClickedVideosModule=showMostClickedVideosModule,$scope.shouldShowMostClickedVideosByTopicModule=!1,updateFormattedMaxDate($scope.maxDate),viewPorts.callbackForAny(function(viewPort){currentViewPort=viewPort,$scope.showInformationVisible=viewPort!==viewPorts.SMALL_TYPE}),isFirstRequestDone=!1,requestNewEpisodes(buildLatestEpisodesUrlForDate()),SRGConfig.currentSubPortal===TV_SUB_PORTAL&&(historyEntry={id:$attrs.showId,ts:moment().unix(),title:$attrs.showTitle,url:$location.absUrl(),imageUrl:$attrs.imageUrl,latestEpisodeLink:$attrs.latestEpisodeLink},showHistory.add(historyEntry))}angular.module("srg-play.features").controller("ShowOverviewController",ShowOverviewController),ShowOverviewController.$inject=["_","$scope","$attrs","$location","SRGConfig","moment","PlayJSONWebservice","viewPorts","showHistory","mediaStageGeoblockFilter","URI"]}(),function(){function ShowsAtoZListController(atoZIndexServiceUnchunked,indexChangeService,$scope,$attrs,$location){var aToZIndexService,displayableSections,alphabeticalSections;function displayAtoZIndex(){$scope.currentIndexList=aToZIndexService.fullIndexList}function hideSectionsNotBelongingToSelectedIndex(){$scope.filteredAtoZSections=displayableSections.filter(function(section){return aToZIndexService.currentIndex===aToZIndexService.INDEX_ALL||aToZIndexService.currentIndex===section.id})}$scope.changeCurrentIndex=function(id){aToZIndexService.changeCurrentIndex(id),indexChangeService.changeIndex({indexLetter:id}),hideSectionsNotBelongingToSelectedIndex(),displayAtoZIndex()},$scope.$on("$locationChangeStart",function(){$scope.currentIndexList&&$location.search().index&&$scope.changeCurrentIndex($location.search().index)}),alphabeticalSections=$scope.$eval($attrs.alphabeticalSections)||[],displayableSections=alphabeticalSections.filter(function(section){return section.hasShows}),aToZIndexService=atoZIndexServiceUnchunked(alphabeticalSections,$attrs.titleforindexall),displayAtoZIndex(),hideSectionsNotBelongingToSelectedIndex()}angular.module("srg-play.features").controller("ShowsAtoZListController",ShowsAtoZListController),ShowsAtoZListController.$inject=["atoZIndexServiceUnchunked","indexChangeService","$scope","$attrs","$location"]}(),function(){function ShowsByDateController(_,moment,$scope,$attrs,$location,$document,programDayFactory,chartbeatService,viewPorts){function showOnlyCurrentSelectedDay(){resetDisplayedDays(),$scope.displayNewDay($scope.currentTimestamp,!0)}function onNewDateSelected(dateString){var dateTimestamp=moment.utc(dateString,"DD-MM-YYYY").unix();$scope.displayNewDay(dateTimestamp,!0)}function requestToday(){$scope.displayNewDay(timestampStartOfToday(),!0)}function requestYesterday(){$scope.displayNewDay(subtractOneDayFromTimestamp(timestampStartOfToday()),!0)}function appendPreviousDay(){var timestampPreviousDay=subtractOneDayFromTimestamp($scope.currentTimestamp);$scope.displayNewDay(timestampPreviousDay)}function displayNewDay(timestamp,removeExistingDays){removeExistingDays&&resetDisplayedDays();var programDay=programDayFactory(function(timestamp){return utcDateFromTimestamp(timestamp).format("DD-MM-YYYY")}(timestamp));!function(programDay){var previousUrlParams=$location.search(),newUrlParams=_.merge(previousUrlParams,{date:programDay.dateString});$location.search(newUrlParams),$location.replace()}(programDay),function(programDay){$scope.days.push(programDay)}(programDay),function(programDay){chartbeatService.trackVirtualPageChange(programDay.dateString+" - "+$document[0].title)}(programDay),$scope.currentTimestamp=timestamp,$scope.currentDate=utcDateFromTimestamp(timestamp).toDate()}function pageScrolledDown(){viewPorts.getCurrent()!==viewPorts.SMALL_TYPE&&($scope.showCalendar=!1)}function resetDisplayedDays(){$scope.days=[]}function timestampStartOfToday(){return getTimestampStartOfDay(moment().unix())}function getTimestampStartOfDay(timestamp){return utcDateFromTimestamp(timestamp).startOf("day").unix()}function subtractOneDayFromTimestamp(timestamp){return utcDateFromTimestamp(timestamp).subtract(1,"day").unix()}function utcDateFromTimestamp(timestamp){return moment.unix(timestamp).utc()}function requestStarted(){$scope.requestInProcess=!0}function requestFinished(){$scope.requestInProcess=!1}function onUrlQueryChanged(){var query=$location.search(),newDate=moment.utc(query.date,"DD-MM-YYYY");newDate.isValid()&&!newDate.isSame(moment.unix($scope.currentTimestamp))&&$scope.displayNewDay(newDate.unix(),!0)}$scope.requestInProcess=!1,$scope.currentTimestamp=getTimestampStartOfDay($attrs.timestamp),$scope.currentDate=utcDateFromTimestamp($attrs.timestamp).toDate(),$scope.onNewDateSelected=onNewDateSelected,$scope.requestToday=requestToday,$scope.requestYesterday=requestYesterday,$scope.appendPreviousDay=appendPreviousDay,$scope.displayNewDay=displayNewDay,$scope.pageScrolledDown=pageScrolledDown,showOnlyCurrentSelectedDay(),$scope.$on("resetShowsByDateView",showOnlyCurrentSelectedDay),$scope.$on("showsByDateRequestStarted",requestStarted),$scope.$on("showsByDateRequestFinished",requestFinished),$scope.$on("$locationChangeStart",onUrlQueryChanged)}angular.module("srg-play.features").controller("ShowsByDateController",ShowsByDateController),ShowsByDateController.$inject=["_","moment","$scope","$attrs","$location","$document","programDayFactory","chartbeatService","viewPorts"]}(),function(){function TvHomeQuickAccessController($scope,PersonalizationSettings,favouriteShowsRequestService,_){function handleShowsResponse(showsResponse){_.ifElse(areShowsAvailable,setShowsOnScope,setNoShowsAvailable)(showsResponse)}function handleShowsErrorResponse(response){Array.isArray(response.data)&&response.data.length>0?handleShowsResponse(response.data):setNoShowsAvailable()}function setShowsOnScope(shows){return $scope.showTeaserList=_.filter(showHasEpisodes,shows),$scope.showQuickAccessModule=$scope.showTeaserList.length>0,shows}function showHasEpisodes(show){return show.episodes&&show.episodes.length>0}function setNoShowsAvailable(){$scope.showTeaserList=[],$scope.showsAvailable=!1}function areShowsAvailable(shows){return list=shows,_.not(_.isEmpty(list));var list}function requestFinished(){$scope.requestInProcess=!1}function addTeaserFlagToClickedEvent($event){$event&&$event.originalEvent&&($event.originalEvent.srgClickTarget="teaser")}$scope.showTeaserList=[],$scope.showQuickAccessModule=!1,$scope.requestInProcess=!1,$scope.teaserClicked=addTeaserFlagToClickedEvent,PersonalizationSettings.isPersonalizationActive()&&($scope.requestInProcess=!0,favouriteShowsRequestService.request({withShowHistoryFallback:!0,numberOfShows:2}).then(handleShowsResponse).catch(handleShowsErrorResponse).finally(requestFinished))}angular.module("srg-play.features").controller("TvHomeQuickAccessController",TvHomeQuickAccessController),TvHomeQuickAccessController.$inject=["$scope","PersonalizationSettings","favouriteShowsRequestService","_"]}(),function(){function LiveOverviewVideoController(URLParameterCookieStore,SRGConfig,technicalPlayerService,$scope,viewPorts,PlayJSONWebservice,$sce,$interval){var livestreamSelectionStore,url;function handleLivestreamsResponse(response){$scope.livestreamsLoaded=!0,updateLivestreamResponseOnScope(response);var updateInterval,livestreamUrn=function(livestreams){var previouslyWatchedLivestreamId=livestreamSelectionStore.get();if(previouslyWatchedLivestreamId){var previousWatchedLivestream=function(list,id){for(var i=0;i<list.length;i++)if(list[i].id===id)return list[i]}(livestreams,previouslyWatchedLivestreamId);if(previousWatchedLivestream)return previousWatchedLivestream.urn}else if(livestreams.length>0){var firstLivestream=livestreams[0];return livestreamSelectionStore.save(firstLivestream.id),firstLivestream.urn}return""}(response.teaser);$scope.selectedLiveStream=findStreamByUrn(response.teaser,livestreamUrn),startLivestreamPlayer(livestreamUrn),updateInterval=$interval(function(){var url;url=SRGConfig.tvPortal.ajaxUrls.liveOverview,PlayJSONWebservice.getResource(url,{},{cache:!1}).get().$promise.then(function(response){updateLivestreamResponseOnScope(response),$scope.selectedLiveStream=findStreamByUrn(response.teaser,$scope.selectedLiveStream.urn)})},6e4),$scope.$on("$destroy",function(){$interval.cancel(updateInterval)})}function updateLivestreamResponseOnScope(response){response.teaser.filter(isNowAndNextAvailableForLivestream).forEach(categorizeProgramItems),$scope.liveStreams=response.teaser}function initPlayerAPI(){technicalPlayerService.init({playerId:"srg_player_technical_player"})}function startLivestreamPlayer(urn){var playerBaseUrl=SRGConfig.tvPortal.livePage.playerBaseUrl;$scope.technicalPlayerUrl=$sce.trustAsResourceUrl(playerBaseUrl+"?urn="+urn+"&autoplay=true")}function changeLivestream(index,element){var livestream=$scope.liveStreams[index];livestream&&(technicalPlayerService.loadUsingUrn(livestream.urn),$scope.selectedLiveStream=livestream,livestreamSelectionStore.save(livestream.id))}function viewportHasChanged(newViewport){$scope.currentViewPort=newViewport,function(oldViewport,newViewport){return oldViewport&&oldViewport===viewPorts.SMALL_TYPE&&newViewport&&newViewport!==viewPorts.SMALL_TYPE}($scope.currentViewPort,newViewport)&&(startLivestreamPlayer($scope.selectedLiveStream.urn),$scope.initPlayer())}function isNowAndNextAvailableForLivestream(livestream){return!!livestream.nowAndNext.programItems&&livestream.nowAndNext.programItems.length>0}function categorizeProgramItems(livestream){livestream.nowAndNext.programItemsNext=[],livestream.nowAndNext.programItems.forEach(function(programItem){!0===programItem.isCurrent?livestream.nowAndNext.programItemNow=programItem:livestream.nowAndNext.programItemsNext.push(programItem)})}function hideLoadingIndicator(){$scope.requestInProcess=!1}function findStreamByUrn(list,urn){for(var i=0;i<list.length;i++)if(list[i].urn===urn)return list[i]}function noCurrentProgramInfoFor(liveStream){return angular.isUndefined(liveStream.nowAndNext)||angular.isUndefined(liveStream.nowAndNext.programItems)||0===liveStream.nowAndNext.programItems.length||angular.isUndefined(liveStream.nowAndNext.programItemNow)}livestreamSelectionStore=new URLParameterCookieStore("tvLiveId"),$scope.requestInProcess=!1,$scope.stations=[],$scope.selectedLiveStream=null,$scope.liveStreams=null,$scope.currentViewPort="",$scope.livestreamsLoaded=!1,$scope.changeLivestream=changeLivestream,$scope.initPlayer=initPlayerAPI,$scope.noCurrentProgramInfoFor=noCurrentProgramInfoFor,viewPorts.callbackForAny(viewportHasChanged),(url=SRGConfig.tvPortal.ajaxUrls.liveOverview,$scope.requestInProcess=!0,PlayJSONWebservice.getResource(url).get().$promise).then(handleLivestreamsResponse).finally(hideLoadingIndicator)}angular.module("srg-play.features").controller("LiveOverviewVideoController",LiveOverviewVideoController),LiveOverviewVideoController.$inject=["URLParameterCookieStore","SRGConfig","technicalPlayerService","$scope","viewPorts","PlayJSONWebservice","$sce","$interval"]}(),function(){function favouriteShowsRequestService(PlayJSONWebservice,UrlPatternResolver,userId,showHistory,favouriteShowsStorageService,_){return{request:function(config){return(favouriteShowsUrl=getFavouriteShowsUrl(config),PlayJSONWebservice.getResource(favouriteShowsUrl,{}).get().$promise).then(sanitizeResult);var favouriteShowsUrl},getUrl:getFavouriteShowsUrl};function getFavouriteShowsUrl(config){return function(config){var favouriteShowsRequestConfig=function(config){return config.requiredShowIds=config.withFavorizedShows?favouriteShowsStorageService.getAll().map(function(item){return item.id}).join(","):void 0,config}(function(config){return config.fallbackShowIds=config.withShowHistoryFallback?showHistory.get().map(function(item){return item.id}).join(","):void 0,config}(config));return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.FAVOURITE_SHOWS,favouriteShowsRequestConfig)}(_.merge({numberOfShows:8,userId:config&&config.userId||userId.get(),withShowHistoryFallback:!1,withFavorizedShows:!1},config))}function sanitizeResult(favouriteShows){return favouriteShows.teaser.length?favouriteShows.teaser:[]}}angular.module("srg-play.features").factory("favouriteShowsRequestService",favouriteShowsRequestService),favouriteShowsRequestService.$inject=["PlayJSONWebservice","UrlPatternResolver","userId","showHistory","favouriteShowsStorageService","_"]}(),function(){function favouriteShowsStorageService(_,localStoreFactory,localStoreKeys,moment){var config={localStoreKey:localStoreKeys.favShows,maxSavedEntries:50,entryValidator:function(entry){return _.not(_.isNil(entry.id))&&_.not(_.isNil(entry.ts))}},store=localStoreFactory.getStoreList(config.localStoreKey);return{saveShow:function(id){if(!isShowSaved(id))return store.unshift({id:id,ts:moment().unix()}),store.length>config.maxSavedEntries?store.pop():store},removeShow:function(id){if(isShowSaved(id))return store.splice(_.findIndex(_.propEq("id",id))(store),1)},isShowSaved:isShowSaved,getAll:function(){return store}};function isShowSaved(id){return store.some(function(show){return show.id===id})}}angular.module("srg-play.features").factory("favouriteShowsStorageService",favouriteShowsStorageService),favouriteShowsStorageService.$inject=["_","localStoreFactory","localStoreKeys","moment"]}(),function(){function favouriteShowsSubscriptionButton(PersonalizationSettings,favouriteShowsStorageService){return{restrict:"E",scope:{labelSelected:"@",labelUnselected:"@",adjustmentClass:"@",modalPersonalizationInformation:"@",modalPersonalizationActivate:"@",modalPersonalizationCancel:"@",showId:"@"},link:function(scope,element,attr){function subscribeShow(){return scope.isSubscribed=!0,favouriteShowsStorageService.saveShow(scope.showId)}scope.revealId="subscriptionModal",scope.isPersonalizationActive=PersonalizationSettings.isPersonalizationActive(),scope.isSubscribed=favouriteShowsStorageService.isShowSaved(scope.showId),element.on("click",function(){return scope.isSubscribed?(scope.isSubscribed=!1,favouriteShowsStorageService.removeShow(scope.showId)):subscribeShow()}),scope.isPersonalizationActive&&(scope.revealId=void 0),scope.confirmActivation=function(){scope.revealId=void 0,PersonalizationSettings.activatePersonalization(),scope.isPersonalizationActive=!0,subscribeShow()}},template:'\n        <a class="subscription-btn [{[ adjustmentClass ]}]"\n           href="#" ng-attr-data-reveal-id="{{ revealId }}">\n           <srg-icon-text \n               text="{{ isSubscribed && isPersonalizationActive ? labelSelected : labelUnselected }}" \n               icon-class="{{ (isSubscribed && isPersonalizationActive) ? \'icon-star\' : \'icon-star-outline\' }}">\n           </srg-icon-text>\n        </a>\n\n        <div id="subscriptionModal" class="reveal-modal small personalizationModal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">\n            <div>{{ modalPersonalizationInformation }}</div>\n\n            <button class="mediumButton buttonTextCentered close-reveal-modal leftButton" ng-click="confirmActivation()">\n                <span>{{ modalPersonalizationActivate }}</span>\n            </button>\n\n            <button class="mediumButton buttonTextCentered close-reveal-modal" aria-label="Close">\n                <span>{{ modalPersonalizationCancel }}</span>\n            </button>\n        </div>\n      '}}angular.module("srg-play.features").directive("favouriteShowsSubscriptionButton",favouriteShowsSubscriptionButton),favouriteShowsSubscriptionButton.$inject=["PersonalizationSettings","favouriteShowsStorageService"]}(),function(){function MyVideosPageController($scope,$attrs,PersonalizationSettings,PersonalizationSettingsObserver,favouriteShowsRequestService,userId,watchLaterService){function setUrls(){$scope.favouriteShowsUrl=favouriteShowsRequestService.getUrl({withFavorizedShows:!0,numberOfShows:3}),$scope.videoHistoryUrl=$attrs.usersVideoHistoryUrl.replace(/USERID/,userId.get()),$scope.watchLaterUrl=$attrs.watchLaterUrl;var watchLaterVideos=watchLaterService.getAll().join(",");$scope.watchLaterUrlParams={urns:watchLaterVideos}}$scope.isPersonalizationActive=PersonalizationSettings.isPersonalizationActive(),PersonalizationSettingsObserver.onPersonalizationActivation(function(){$scope.isPersonalizationActive=!0,setUrls()}),PersonalizationSettingsObserver.onPersonalizationDeactivation(function(){$scope.isPersonalizationActive=!1}),$scope.isPersonalizationActive&&setUrls(),$scope.deleteWatchLater=function(){watchLaterService.clear(),setUrls()},$scope.onWatchLaterLoaded=function(assets){watchLaterService.removeUnavailable(assets)},$scope.hasWatchLaterItems=function(){return watchLaterService.hasItems()}}angular.module("srg-play.features").controller("MyVideosPageController",MyVideosPageController),MyVideosPageController.$inject=["$scope","$attrs","PersonalizationSettings","PersonalizationSettingsObserver","favouriteShowsRequestService","userId","watchLaterService"]}(),function(){function PersonalRecommendedController($scope,$attrs,peachService,maRtsInfo){var url,userId;url=$attrs.recommendationUrl,$scope.recommendationUrl="".concat(url,"?").concat((userId=maRtsInfo.getPeachUserId())?"peachUId=".concat(userId):""),$scope.onRecommendationsLoaded=function(response){$scope.moduleTitle=response.title,function(response){var displayedRecommendations={id:response.recommendationId,items:response.teaser};peachService.sendRecommendationDisplayed(displayedRecommendations)}(response)}}angular.module("srg-play.features").controller("PersonalRecommendedController",PersonalRecommendedController),PersonalRecommendedController.$inject=["$scope","$attrs","peachService","maRtsInfo"]}(),function(){function tvProgramDay($http,$compile){return{link:function(scope,element,attrs){scope.day&&(url="/play/tv/programDay/"+scope.day.dateString,scope.$emit("showsByDateRequestStarted"),$http({method:"GET",url:url}).then(handleResponse).catch(handleError).finally(requestFinished));var url;function handleResponse(response){renderResponse(response)}function handleError(response){!function(response){return 404===response.status}(response)?element.replaceWith($compile('<div class="programDay__noContentMessage">'+attrs.errorMessage+"</div>")(scope)):renderResponse(response)}function renderResponse(response){element.replaceWith($compile(response.data)(scope))}function requestFinished(){scope.$emit("showsByDateRequestFinished")}scope.changeDay=function(dateString){scope.onDayChange({dateString:dateString})}},template:'<div class="loadingContainer loadingContainer--big" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div>',scope:{day:"=",onDayChange:"&",requestToday:"&",requestYesterday:"&"}}}angular.module("srg-play.features").directive("tvProgramDay",tvProgramDay),tvProgramDay.$inject=["$http","$compile"]}(),function(){function recommendedVideosModule(userId,URI){return{templateUrl:function(elem,attrs){var url=new URI(attrs.url),uid=userId.get();uid&&url.addQuery({userId:uid});return url.toString()}}}angular.module("srg-play.features").directive("recommendedVideos",recommendedVideosModule),recommendedVideosModule.$inject=["userId","URI"]}(),function(){function showHistory(_,localStoreKeys,localHistory,PersonalizationSettingsObserver){var history=localHistory({localStoreKey:localStoreKeys.showHistory,maxSavedEntries:2,propertyPicker:_.pick(["id","title","url","imageUrl","latestEpisodeLink","ts"]),entryValidator:function(entry){return _.not(_.isNil(entry.ts))&&_.not(_.isNil(entry.id))&&_.not(_.isNil(entry.title))&&_.not(_.isNil(entry.url))&&_.not(_.isNil(entry.imageUrl))&&_.not(_.isNil(entry.latestEpisodeLink))}});return PersonalizationSettingsObserver.onPersonalizationDeactivation(history.clean),history}angular.module("srg-play.features").factory("showHistory",showHistory),showHistory.$inject=["_","localStoreKeys","localHistory","PersonalizationSettingsObserver"]}(),angular.module("srg-play.features").service("topicChangeService",["_",function(_){var topicChangeCallbacks=[],notifyCallback=_.curry(function(topic,callback){callback(_.clone(topic))});this.changeTopic=function(topic){_.map(notifyCallback(topic),topicChangeCallbacks)},this.registerTopicChangeCallback=function(callback){topicChangeCallbacks.push(callback)}}]),function(){function TopicModulesController($scope,topicsProviderFactory,SeoStringGenerator,userId){function setTopicsOnScope(topicsProvider){$scope.topics=topicsProvider.topics()}$scope.topics=[],function(){new SeoStringGenerator;var topicsRequestConfig={userId:userId.get(),latestTopicsCount:15,mostViewedTopicsCount:15,moduleContext:"homepage"};topicsProviderFactory(topicsRequestConfig).then(setTopicsOnScope)}()}angular.module("srg-play.features").controller("TopicLatestModulesController",TopicModulesController),TopicModulesController.$inject=["$scope","topicsProviderFactory","SeoStringGenerator","userId"]}(),function(){function topicLink($location){return{restrict:"A",scope:{url:"@topicLink"},link:function(scope,element){updateTopicStatus(scope,element),scope.$on("$locationChangeStart",function(){updateTopicStatus(scope,element)})}};function updateTopicStatus(scope,element){scope.url===$location.path()?(scope.isSelected=!0,getTopicLink(element).addClass("subNav__link--active")):(scope.isSelected=!1,function(topicLinkElement){topicLinkElement.removeClass("subNav__link--active")}(getTopicLink(element)))}function getTopicLink(topicElement){return topicElement.find(".subNav__link")}}angular.module("srg-play.features").directive("topicLink",topicLink),topicLink.$inject=["$location"]}(),function(){function topicPageModules(){return{restrict:"EA",scope:{errorMessage:"@",selectedTopic:"="},template:'<div class="loadingContainer loadingContainer--big" ng-show="topicModules.areRequestsInProcess()" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div><teaser-module class="teaserModule" src="selectedTopic.mostViewedShowsByTopicModuleUrl" ng-if="selectedTopic.mostViewedShowsByTopicModuleUrl" ng-hide="topicModules.areRequestsInProcess()" on-load="topicModules.markMostViewedShowsRequestSuccessful()" on-error="topicModules.markMostViewedShowsRequestFinished()"></teaser-module><teaser-module class="teaserModule" src="selectedTopic.latestMainTopicAboveSubTopicsModuleUrl" ng-if="selectedTopic.latestMainTopicAboveSubTopicsModuleUrl" ng-hide="topicModules.areRequestsInProcess()" on-load="topicModules.markLatestRequestSuccessful()" on-error="topicModules.markLatestRequestFinished()"></teaser-module><teaser-module class="teaserModule" ng-repeat="subTopic in selectedTopic.subTopics"ng-if="selectedTopic.subTopics" ng-hide="subTopic.hide" src="subTopic.latestModuleUrl" on-load="topicModules.markSubTopicRequestSuccessful()"on-error="subTopicRequestFailed(subTopic)"></teaser-module><teaser-module class="teaserModule" src="selectedTopic.mostClickedModuleUrl" ng-if="selectedTopic.mostClickedModuleUrl && !selectedTopic.subTopics" ng-hide="topicModules.areRequestsInProcess()" on-load="topicModules.markMostClickedRequestSuccessful()" on-error="topicModules.markMostClickedRequestFinished()"></teaser-module><teaser-module class="teaserModule" src="selectedTopic.latestModuleUrl" ng-if="selectedTopic.latestModuleUrl && !selectedTopic.subTopics" ng-hide="topicModules.areRequestsInProcess()" on-load="topicModules.markLatestRequestSuccessful()" on-error="topicModules.markLatestRequestFinished()"></teaser-module><div class="noContentMessage" ng-hide="topicModules.areRequestsInProcess() || topicModules.isDataAvailable()">[{[ ::errorMessage ]}]</div>',controller:"TopicPageModulesController",controllerAs:"topicModules"}}angular.module("srg-play.features").directive("topicPageModules",topicPageModules),topicPageModules.$inject=[]}(),function(){function TopicPageModulesController($scope){var latestRequestInProcess,latestRequestSuccess,mostClickedRequestInProcess,mostClickedRequestSuccess,subTopicRequestInProcess,subTopicRequestSuccess,mostViewedShowsByTopicRequestInProcess,mostViewedShowsByTopicRequestSuccess,callback,topicModules=this;function markTopicModulesRequestsAsStarted(topic){resetRequestStatus(),topic&&(topic.latestModuleUrl&&(latestRequestInProcess=!0),topic.mostViewedShowsByTopicModuleUrl&&(mostViewedShowsByTopicRequestInProcess=!0),topic.subTopics?subTopicRequestInProcess=!0:topic.mostClickedModuleUrl&&(mostClickedRequestInProcess=!0))}function resetRequestStatus(){latestRequestSuccess=!1,latestRequestInProcess=!1,mostClickedRequestSuccess=!1,mostClickedRequestInProcess=!1,subTopicRequestInProcess=!1,subTopicRequestSuccess=!1,mostViewedShowsByTopicRequestInProcess=!1,mostViewedShowsByTopicRequestSuccess=!1}function areRequestsInProcess(){return latestRequestInProcess||mostClickedRequestInProcess||subTopicRequestInProcess||mostViewedShowsByTopicRequestInProcess}function isDataAvailable(){return latestRequestSuccess||mostClickedRequestSuccess||subTopicRequestSuccess||mostViewedShowsByTopicRequestSuccess}function latestRequestSuccessful(){latestRequestFinished(),latestRequestSuccess=!0}function latestRequestFinished(){latestRequestInProcess=!1}function mostClickedRequestSuccessful(){mostClickedRequestFinished(),mostClickedRequestSuccess=!0}function mostClickedRequestFinished(){mostClickedRequestInProcess=!1}function subTopicRequestFailed(subTopic){subTopic.hide=!0,subTopicRequestInProcess=!1}function subTopicRequestSuccessful(){subTopicRequestInProcess=!1,subTopicRequestSuccess=!0}function mostViewedShowsByTopicRequestSuccessful(){mostViewedShowsByTopicRequestFinished(),mostViewedShowsByTopicRequestSuccess=!0}function mostViewedShowsByTopicRequestFinished(){mostViewedShowsByTopicRequestInProcess=!1}resetRequestStatus(),callback=markTopicModulesRequestsAsStarted,$scope.$watch("selectedTopic",callback),topicModules.isDataAvailable=isDataAvailable,topicModules.areRequestsInProcess=areRequestsInProcess,topicModules.markLatestRequestFinished=latestRequestFinished,topicModules.markLatestRequestSuccessful=latestRequestSuccessful,topicModules.markMostClickedRequestFinished=mostClickedRequestFinished,topicModules.markMostClickedRequestSuccessful=mostClickedRequestSuccessful,topicModules.markSubTopicRequestFailed=subTopicRequestFailed,topicModules.markSubTopicRequestSuccessful=subTopicRequestSuccessful,topicModules.markMostViewedShowsRequestFinished=mostViewedShowsByTopicRequestFinished,topicModules.markMostViewedShowsRequestSuccessful=mostViewedShowsByTopicRequestSuccessful}angular.module("srg-play.features").controller("TopicPageModulesController",TopicPageModulesController),TopicPageModulesController.$inject=["$scope"]}(),function(){function TopicSelectionController(_,$scope,$rootScope,$timeout,topicChangeService,topicsProviderFactory,topicSelectionStoreFactory,$location,$document,$transitions,chartbeatService){var topicSelectionStore,lastSelectedTopicId,topicsRequestConfig={latestTopicsCount:100,mostViewedTopicsCount:24,moduleContext:"topicpage"};function render(topicsProvider){$scope.requestInProcess=!1;var topicsList=topicsProvider.topics();!function(topicsList){return topicsList.length>0}(topicsList)?$scope.areTopicsAvailable=!1:(topicSelectionStore=topicSelectionStoreFactory(topicsProvider),function(topicsList){$scope.listTopics=topicsList,$scope.dropdownTopics=topicsList;var activeTopic=(topics=topicsList,storedId=topicSelectionStore.getTopicId(),list=topics,id=storedId,_.pipe(_.find(_.propEq("id",id)))(list));var topics,storedId,list,id;lastSelectedTopicId=activeTopic.id,notifyChartbeatOfTopicUsage(activeTopic),selectTopic(activeTopic)}(topicsList)),$timeout(openDropdown,200)}function openDropdown(){if("true"===($location.search()||{}).expandTopics){var el=angular.element("#topicsDropdown");el.length&&(el.click(),$location.search("expandTopics",null))}}function requestTopicsFailed(){$scope.requestInProcess=!1,$scope.areTopicsAvailable=!1}function selectTopic(topic){var topicId;$scope.selectedTopicOnList=topic,$scope.selectedTopicOnDropdown=_.clone(topic),topicChangeService.changeTopic(topic),function(topic){return topic.id!==lastSelectedTopicId}(topic)&&(topicId=topic.id,topicSelectionStore.saveTopicId(topicId),function(topic){notifyChartbeatOfTopicUsage(topic),$rootScope.$broadcast("netmetrixReferrerChange",$location.absUrl())}(topic)),lastSelectedTopicId=topic.id}function notifyChartbeatOfTopicUsage(topic){chartbeatService.trackVirtualPageChange(topic.title+" - "+$document[0].title)}function updateTopicUrl(topic){$location.path(topic.url)}$scope.listTopics=[],$scope.dropdownTopics=[],$scope.requestInProcess=!0,$scope.areTopicsAvailable=!0,$scope.changeTopic=updateTopicUrl,topicsProviderFactory(topicsRequestConfig).then(render,requestTopicsFailed),$transitions.onSuccess({to:"tvTopicPage"},function(){var url,topicToSelect;url=$location.path(),(topicToSelect=function(list,url){return _.pipe(_.find(_.propEq("url",url)))(list)}($scope.listTopics,url))&&selectTopic(topicToSelect)})}angular.module("srg-play.features").controller("TopicSelectionController",TopicSelectionController),TopicSelectionController.$inject=["_","$scope","$rootScope","$timeout","topicChangeService","topicsProviderFactory","topicSelectionStoreFactory","$location","$document","$transitions","chartbeatService"]}(),function(){function topicSelectionStoreFactory(_,CookieStore,URLPathStore){var cookieStore=new CookieStore("topicId");return function(topicsProvider){var topics=topicsProvider.topics(),fallbackTopic=_.head(topics)||{};return{saveTopicId:function(id){var urlFromTopicId=topicsProvider.urlById(id),validPath=urlFromTopicId||fallbackTopic.url,validId=urlFromTopicId?id:fallbackTopic.id;URLPathStore.changeAndSavePath(validPath),cookieStore.saveCookieValue(validId)},getTopicId:function(){var topicIdFromUrl=_.pipe(URLPathStore.getUrlPath,topicsProvider.idByUrl)(),topicIdFromCookie=cookieStore.getCookieValue(),topicId=_.or(_.or(topicIdFromUrl,topicIdFromCookie),fallbackTopic.id),validTopicId=(id=topicId,matchedTopic=_.pipe(_.find(_.propEq("id",id)))(topics),Boolean(matchedTopic)?topicId:fallbackTopic.id);var id,matchedTopic;topicIdFromUrl||URLPathStore.changeAndSavePath(topicsProvider.urlById(validTopicId));return validTopicId}}}}angular.module("srg-play.features").factory("topicSelectionStoreFactory",topicSelectionStoreFactory),topicSelectionStoreFactory.$inject=["_","CookieStore","URLPathStore"]}(),function(){function TopicsProviderFactory(_,topicsRequestService){return function(topicsRequestConfig){return _.pipeP(topicsRequestService.request,createTopicsProvider)(topicsRequestConfig)};function createTopicsProvider(topicsResponse){topicsResponse=topicsResponse||[];var props_id="id",props_url="url",props_title="title",props_mostViewed="mostClickedModuleUrl",props_latest="latestModuleUrl",props_latestMainTopicAboveSubTopics="latestMainTopicAboveSubTopicsModuleUrl",props_mostViewedShowsByTopicModuleUrl="mostViewedShowsByTopicModuleUrl",props_subTopics="subTopics",getTopicsResponse=_.always(topicsResponse),cloneTopics=_.map(_.pick([props_id,props_title,props_url,props_mostViewed,props_latest,props_latestMainTopicAboveSubTopics,props_mostViewedShowsByTopicModuleUrl,props_subTopics])),findInTopics=_.flip(_.find)(topicsResponse),findPropInTopics=function(prop){return _.compose(_.propOr(null,prop),findInTopics)},idMatcher=_.compose(_.propEq(props_id),_.identity),urlMatcher=_.compose(_.propEq(props_url),_.identity);return{idByUrl:_.compose(findPropInTopics(props_id),urlMatcher),urlById:_.compose(findPropInTopics(props_url),idMatcher),titleById:_.compose(findPropInTopics(props_title),idMatcher),topics:_.compose(cloneTopics,getTopicsResponse)}}}angular.module("srg-play.features").factory("topicsProviderFactory",TopicsProviderFactory),TopicsProviderFactory.$inject=["_","topicsRequestService"]}(),function(){function TopicsRequestService(_,PlayJSONWebservice,UrlPatternResolver){return{request:function(topicRequestConfig){return topicsRequestConfig=topicRequestConfig,topicsRequestConfig=function(topicsRequestConfig){return(topicsRequestConfig=topicsRequestConfig||{}).latestTopicsCount=topicsRequestConfig.latestTopicsCount||24,topicsRequestConfig.mostViewedTopicsCount=topicsRequestConfig.mostViewedTopicsCount||24,topicsRequestConfig.moduleContext=topicsRequestConfig.moduleContext||"",topicsRequestConfig}(topicsRequestConfig),topicsUrl=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.TOPICS,topicsRequestConfig,{userId:topicsRequestConfig.userId}),PlayJSONWebservice.getResource(topicsUrl,{},{isArrayResponse:!0}).get().$promise;var topicsUrl;var topicsRequestConfig}}}angular.module("srg-play.features").factory("topicsRequestService",TopicsRequestService),TopicsRequestService.$inject=["_","PlayJSONWebservice","UrlPatternResolver"]}(),function(){angular.module("srg-play.features").directive("showHistory",function(){return{restrict:"E",template:'<div class="showHistory" aria-live="polite"><div class="historyEntry" ng-repeat="entry in history.entries track by entry.id"><a ng-href="[{[ entry.url ]}]" tabindex="-1" data-cs-referrer=""><img class="historyEntry__image" ng-click="history.tracking.trackHistoryShowClick()" ng-src="[{[ entry.imageUrl ]}]/scale/width/224"></a><a class="historyEntry__title" ng-href="[{[ entry.url ]}]" ng-click="history.tracking.trackHistoryShowClick(entry.title)" data-cs-referrer="">[{[ entry.title ]}]</a><a class="historyEntry__lastEpisodeLink" ng-href="[{[ entry.latestEpisodeLink ]}]" ng-click="history.tracking.trackHistoryEpisodeClick(entry.title)" target="_self"data-cs-referrer="">[{[ ::history.latestEpisodeLabel ]}]<span class="historyEntry__lastEpisodeDate" ng-include="entry.dateOfLatestEpisodeUrl"></span></a></div><p ng-hide="history.isAvailable" class="showHistory__noContentDescription">[{[ ::history.noContentDescription ]}]</p></div>',scope:{latestEpisodeLabel:"@",noContentDescription:"@"},controller:"showHistoryController",controllerAs:"history",bindToController:!0}})}(),function(){function showHistoryController(showHistory,UrlPatternResolver,showHistoryTrackingService){var history=this;history.entries=[],history.isAvailable=!1,history.tracking={trackHistoryShowClick:showHistoryTrackingService.trackHistoryShowClick,trackHistoryEpisodeClick:showHistoryTrackingService.trackHistoryEpisodeClick},history.entries=showHistory.get().map(function(entry){var show;return entry.dateOfLatestEpisodeUrl=(show=entry,UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.DATE_OF_LATEST_EPISODE,{showId:show.id})),entry}),history.isAvailable=history.entries.length>0}angular.module("srg-play.features").controller("showHistoryController",showHistoryController),showHistoryController.$inject=["showHistory","UrlPatternResolver","showHistoryTrackingService"]}(),function(){function showHistoryTrackingService(tcEvents){return{trackHistoryShowClick:function(showName){trackInteractionWithTagCommander({type:"tvSubnavigationShowsFlyout",name:"lastViewedShows-historyShow",value_1:showName})},trackHistoryEpisodeClick:function(showName){trackInteractionWithTagCommander({type:"tvSubnavigationShowsFlyout",name:"lastViewedShows-lastEpisode",value_1:showName})}};function trackInteractionWithTagCommander(event){tcEvents({id:"hidden_event",data:{event_type:event.type,event_name:event.name,event_value_1:event.value_1}})}}angular.module("srg-play.features").factory("showHistoryTrackingService",showHistoryTrackingService),showHistoryTrackingService.$inject=["tcEvents"]}(),function(){angular.module("srg-play.features").component("srgWatchLater",{template:'<button ng-if="::$ctrl.isPersonalizationActive"\n                    class="watch-later"\n                    ng-click="$ctrl.toggleWatchLater()"\n                    role="checkbox"\n                    title="{{ ::$ctrl.watchLaterText }}"\n                    aria-checked="{{ $ctrl.isVideoAdded }}"\n                    aria-label="{{ ::$ctrl.watchLaterText }}">\n                <srg-icon-text\n                    text="{{ ::$ctrl.watchLaterText }}"\n                    icon-class="{{ $ctrl.isVideoAdded ? \'icon-clock\' : \'icon-clock-outline\' }}">\n                </srg-icon-text>\n                <div ng-if="$ctrl.showNotification"\n                    class="watch-later__tooltip"\n                    ng-class="$ctrl.toolTipModifier">\n                     <div class="watch-later__tooltip-content" ng-click="$ctrl.navigateToMyVideos($event)">{{ $ctrl.notificationText }}</div>\n                 </div>\n            </button>\n            <button ng-if="$ctrl.isMyRTSActive()"\n                ng-click="$ctrl.addAssetToMaRTS()"\n                class="watch-later watch-later-rts"\n                title="{{ $ctrl.addToPlayListTitle }}">\n                <srg-icon-text\n                    text="{{ ::$ctrl.watchLaterText }}"\n                    icon-class="icon-clock-outline">\n            </button>',bindings:{watchLaterText:"@",videoAddedText:"@",videoRemovedText:"@",videoUrn:"@",addToPlayListTitle:"@",forwardingLink:"@"},controller:["$rootScope","$scope","$timeout","$window","$element","$location","watchLaterService","PersonalizationSettings","maRTSPlaylist","maRtsInfo",function($rootScope,$scope,$timeout,$window,$element,$location,watchLaterService,PersonalizationSettings,maRTSPlaylist,maRtsInfo){var notificationTimer,vm=this;vm.notificationText="",vm.showNotification=!1,vm.toolTipModifier="",vm.isPersonalizationActive=PersonalizationSettings.isPersonalizationActive(),vm.$onInit=function(){return vm.isVideoAdded=watchLaterService.isVideoAdded(vm.videoUrn)},$scope.$on("srgWatchLater-hide",function(){return vm.showNotification=!1}),vm.toggleWatchLater=function(){vm.isVideoAdded=watchLaterService.toggle(vm.videoUrn),notifyUser()},vm.isMyRTSActive=function(){return maRtsInfo.isActive()},vm.addAssetToMaRTS=function(){return maRTSPlaylist.addToPlaylist(vm.videoUrn,"play")},vm.navigateToMyVideos=function(event){event&&vm.forwardingLink&&!$location.url().includes(vm.forwardingLink)&&(event.preventDefault(),event.stopPropagation(),$location.path(vm.forwardingLink))};var notifyUser=function(){var bounding,elementLeft,elementCenter;bounding=$element[0].getBoundingClientRect(),elementLeft=bounding.x||bounding.left,elementCenter=elementLeft+bounding.width/2,elementLeft<120?vm.toolTipModifier="".concat("watch-later__tooltip","--left-align"):elementCenter>$window.innerWidth-120?vm.toolTipModifier="".concat("watch-later__tooltip","--right-align"):vm.toolTipModifier="",vm.notificationText=vm.isVideoAdded?vm.videoAddedText:vm.videoRemovedText,$rootScope.$broadcast("srgWatchLater-hide"),vm.showNotification=!0,$timeout.cancel(notificationTimer),notificationTimer=$timeout(function(){return vm.showNotification=!1},2500)}}]})}(),function(){function watchLaterService(localStoreFactory,localStoreKeys,PersonalizationSettings){var watchLaterLimit=50,store=localStoreFactory.getStoreEntry(localStoreKeys.watchLater);return store.videos=store.videos||[],{getAll:function(){if(PersonalizationSettings.isPersonalizationActive())return store.videos.slice().reverse();return[]},isVideoAdded:isVideoAdded,toggle:function(urn){if(!PersonalizationSettings.isPersonalizationActive())return!1;isVideoAdded(urn)?store.videos=store.videos.filter(function(video){return video!==urn}):(store.videos.length>=watchLaterLimit&&store.videos.shift(),store.videos.push(urn));return isVideoAdded(urn)},clear:function(){store.videos=[]},hasItems:function(){return store.videos.length>0},removeUnavailable:function(availableVideos){var availableUrns=availableVideos.map(function(video){return video.urn});store.videos=store.videos.filter(function(video){return availableUrns.includes(video)})}};function isVideoAdded(urn){return store.videos.includes(urn)}}angular.module("srg-play.features").factory("watchLaterService",watchLaterService),watchLaterService.$inject=["localStoreFactory","localStoreKeys","PersonalizationSettings"]}(),function(){angular.module("srg-play.features").component("srgChip",{template:'\n        <a\n          class="chip" data-id="{{ $ctrl.data.id }}"\n          aria-label="{{ $ctrl.removeAriaText }}"\n          ng-click="$ctrl.onRemove({ data: {\n            id: $ctrl.data.id,\n            aggregation: $ctrl.data.aggregation,\n          } })"\n        >\n          <span class="chip__label">[{[ $ctrl.data.title ]}]</span>\n          <span class="chip__btn-close"></span>\n        </a>\n      ',bindings:{data:"<",onRemove:"&",removeAriaText:"@"},controller:[function(){}]})}(),function(){angular.module("srg-play.features").component("srgDropdown",{template:'\n        <div class="dropdown"\n          click-outside="$ctrl.saveAndClose()"\n          ng-class="{ \'dropdown--open\': $ctrl.isOpen, \'dropdown--filtered\': $ctrl.isFiltered() }">\n\n          <button class="dropdown__button" ng-click="$ctrl.toggleDropdown()">{{ $ctrl.name }}</button>\n\n          <div class="dropdown__container" ng-if="$ctrl.showContainer()">\n\n            <div class="dropdown-search__wrapper" ng-if="$ctrl.showFilter()">\n              <input class="dropdown-search__input" type="search"\n                novalidate spellcheck="false" autocomplete="off"\n                ng-model="$ctrl.filter"\n                placeholder="{{ ::$ctrl.translate(\'srg.search.dropdown.search\') }}" />\n\n              <button class="dropdown-search__reset iconImg"\n                type="button" tabindex="-1"\n                ng-class="$ctrl.getFilterIcon()"\n                ng-click="$ctrl.resetFilter()"></button>\n            </div>\n\n            <ul class="dropdown__scroll-container">\n              <li class="dropdown__item"\n                ng-class="{ \'dropdown__item--divider\': $ctrl.isDivider(value),\n                \'dropdown__item--single-selection\': $ctrl.isSingleSelectionButton(value) }"\n                ng-repeat="value in $ctrl.values | filter:{ title: $ctrl.filter }:false"\n                data-id="{{ value.id }}">\n                  <input ng-if="$ctrl.isCheckbox(value)"\n                    type="checkbox"\n                    id="dropdown-{{ value.id }}"\n                    ng-click="$ctrl.toggleValue(value.id)"\n                    ng-checked="$ctrl.isItemSelected(value.id)">\n\n                  <label ng-if="$ctrl.isCheckbox(value)"\n                    for="dropdown-{{ value.id }}">\n                    <span ng-bind-html="$ctrl.highlight(value.title)"></span>\n                    <span aria-hidden="true">({{ value.count }})</span>\n                  </label>\n\n                  <hr ng-if="$ctrl.isDivider(value)">\n\n                  <button ng-if="$ctrl.isSingleSelectionButton(value)" class="date-filter-dropdown__quick-filter"\n                   ng-class="{ \'date-filter-dropdown__quick-filter--active\': $ctrl.isItemSelected(value.id) }"\n                   ng-click="$ctrl.toggleValue(value.id); $ctrl.saveAndClose()">\n                     {{value.title}} ({{ value.count }})\n                   </button>\n              </li>\n            </ul>\n\n            <button ng-click="$ctrl.saveAndClose()" class="dropdown__save-button">\n              {{ $ctrl.buttonText }}\n            </button>\n          </div>\n        </div>',bindings:{values:"<",selectedValues:"<",searchEnabled:"<",isLoading:"<",onSave:"&",name:"@"},controller:["$element","translator",function($element,translator){var vm=this;vm.$onInit=function(){vm.selectedValues=vm.selectedValues||[],vm.buttonText=translator.translate("srg.search.dropdown.close")},vm.$onChanges=function(changes){changes.values&&angular.isUndefined(changes.values.currentValue)&&(vm.isOpen=!1)},vm.isOpen=!1,vm.showContainer=function(){return vm.isOpen&&!vm.isLoading},vm.isItemSelected=function(id){return vm.selectedValues.indexOf(id)>=0},vm.isFiltered=function(){return vm.selectedValues.length},vm.toggleValue=function(id){if(vm.isDivider({id:id}))return;if(vm.buttonText=translator.translate("srg.search.dropdown.save"),vm.isItemSelected(id)){var index=vm.selectedValues.indexOf(id);vm.selectedValues.splice(index,1)}else vm.isSingleSelectionButton({id:id})&&(vm.selectedValues=vm.selectedValues.filter(function(valueId){return!vm.isSingleSelectionButton({id:valueId})})),vm.selectedValues.push(id)},vm.saveAndClose=function(){vm.isOpen&&(vm.onSave({selectedValues:vm.selectedValues}),vm.isOpen=!1,vm.filter=void 0,(scrollContainer=$element.find(".dropdown__scroll-container"))&&scrollContainer[0]&&(scrollContainer[0].scrollTop=0));var scrollContainer;vm.buttonText=translator.translate("srg.search.dropdown.close")},vm.toggleDropdown=function(){vm.isOpen?vm.saveAndClose():vm.isOpen=!0},vm.showFilter=function(){var valueLengthWithoutDividers=(vm.values||[]).filter(function(v){return!vm.isDivider(v)}).length;return vm.searchEnabled&&valueLengthWithoutDividers>6},vm.resetFilter=function(){vm.filter="",$element.find(".dropdown-search__input").focus()},vm.highlight=function(title){if(angular.isUndefined(vm.filter)||angular.isUndefined(title))return title;return title.replace(new RegExp(vm.filter,"gi"),function(match){return'<span class="dropdown__item--highlighted">'.concat(match,"</span>")})},vm.getFilterIcon=function(){return vm.filter&&vm.filter.length>0?"iconImgClose":"iconImgSearch"},vm.isDivider=function(value){return"divider"===value.id},vm.isSingleSelectionButton=function(value){return["shorterThan5","longerThan30"].some(function(id){return id===value.id})},vm.isCheckbox=function(value){return!vm.isDivider(value)&&!vm.isSingleSelectionButton(value)},vm.translate=translator.translate}]})}(),function(){angular.module("srg-play.features").component("srgIconText",{template:'\n        <div class="icon-text" \n          aria-label="{{ $ctrl.text }}">\n          <i ng-if="$ctrl.iconClass" class="icon-text__icon" ng-class="$ctrl.iconClass"></i>\n          <span class="icon-text__text">{{ $ctrl.text }}</span>\n        </div>\n      ',bindings:{iconClass:"@",text:"@"},controller:[function(){}]})}(),function(){function geoblockDisplaySettings(SRGConfig,URI){return{restrict:"E",scope:{displayFlag:"=",displaySettings:"=",displayWelcomeBack:"=",showSettingsTriggerElement:"@",subNaviType:"@"},replace:!0,templateUrl:URI("/play/abroad/settings").addQuery({subPortal:SRGConfig.currentSubPortal}).toString(),controller:["$scope","abroadSettings","$state",function($scope,abroadSettings,$state){void 0===abroadSettings.hideGeoblockedMedia&&(abroadSettings.hideGeoblockedMedia=!1),$scope.viewOptions={showGeoblockedAssets:!abroadSettings.hideGeoblockedMedia},$scope.optionShowGeoblockedAssetsChanged=function(){abroadSettings.hideGeoblockedMedia=!$scope.viewOptions.showGeoblockedAssets,$state.reload()}}]}}angular.module("srg-play.features").directive("geoblockDisplaySettings",geoblockDisplaySettings),geoblockDisplaySettings.$inject=["SRGConfig","URI"]}(),function(){function GeoblockSettingsVisibilityController(abroadSettings,userLocationFactory){var hideBlockedMedia=abroadSettings.hideGeoblockedMedia,userLocation=userLocationFactory();this.renderDialog=Boolean(userLocation.isAbroad||userLocation.isBackInCH&&hideBlockedMedia),this.showSettings=userLocation.isAbroad,this.showWelcomeBack=Boolean(userLocation.isBackInCH&&hideBlockedMedia),this.showDialog=Boolean(this.showWelcomeBack||userLocation.isFirstTimeAbroad)}angular.module("srg-play.features").controller("GeoblockSettingsVisibilityController",GeoblockSettingsVisibilityController),GeoblockSettingsVisibilityController.$inject=["abroadSettings","userLocationFactory"]}(),function(){function lastKnownLocationService(locationService,abroadSettings){var wasAbroadInTheLastSession=!1;return abroadSettings.lastKnownLocation=abroadSettings.lastKnownLocation||{},wasAbroadInTheLastSession=abroadSettings.lastKnownLocation.wasAbroadLastSession,abroadSettings.lastKnownLocation.wasAbroadLastSession=locationService.get().isAbroad,{getLast:function(){return{wasAbroad:wasAbroadInTheLastSession}}}}angular.module("srg-play.features").service("lastKnownLocationService",lastKnownLocationService),lastKnownLocationService.$inject=["locationService","abroadSettings"]}(),function(){function locationService($document){return{get:function(){return{isAbroad:$document.find("body").hasClass("clientIsAbroad")}}}}angular.module("srg-play.features").factory("locationService",locationService),locationService.$inject=["$document"]}(),function(){function userLocationFactory(locationService,lastKnownLocationService){return function(){var isUserAbroad=locationService.get().isAbroad,wasUserAbroad=lastKnownLocationService.getLast().wasAbroad;return{isAbroad:isUserAbroad,isFirstTimeAbroad:isUserAbroad&&!wasUserAbroad,isBackInCH:!isUserAbroad&&wasUserAbroad}}}angular.module("srg-play.features").service("userLocationFactory",userLocationFactory),userLocationFactory.$inject=["locationService","lastKnownLocationService"]}(),function(){function PagedList(_){return function($items,$itemsPerPage,$itemCountFirstPage){var itemList=$items||[],itemCountFirstPage=$itemCountFirstPage||$itemsPerPage||5,itemsPerPage=$itemsPerPage||5,getFirstPage=_.take(itemCountFirstPage),getTailItems=_.drop(itemCountFirstPage),getTailPages=_.pipe(getTailItems,_.splitEvery(itemsPerPage)),pages=_.ifElse(_.length,function(itemList){var firstPage=getFirstPage(itemList),tailPages=getTailPages(itemList);return _.prepend(firstPage,tailPages)},_.always([]))(itemList);return{itemList:itemList,itemCountFirstPage:itemCountFirstPage,itemsPerPage:itemsPerPage,currentPage:0,pageCount:_.always(pages.length),getNextPage:function(){var that=this,findNextPage=_.addIndex(_.find)(function(val,idx){return idx===that.currentPage}),getNextPage=_.either(findNextPage,_.always([])),nextPage=getNextPage(pages);return nextPage.length&&(that.currentPage+=1),nextPage},isNextPageAvailable:function(){return this.currentPage!==this.pageCount()&&this.itemList.length>0}}}}angular.module("srg-play.features").factory("PagedList",PagedList),PagedList.$inject=["_"]}(),function(){function userSurvey(){return{restrict:"E",template:'\n      <a ng-click="survey.open()" data-reveal-id="userSurveyModal" tabindex="0">\n        [{[ survey.buttonText ]}]\n      </a>\n      <div id="userSurveyModal" class="reveal-modal surveyModal" data-reveal aria-hidden="true" role="dialog" ng-show="survey.show">\n        <a class="close-reveal-modal" aria-label="Close" ng-click="survey.close()">&#215;</a>\n        <iframe onload="this.contentWindow.focus()" class="surveyModalIframe" ng-src="[{[ survey.link ]}]" frameborder="0" ng-if="survey.show"></iframe>\n      </div>',scope:{buttonText:"@",clientIp:"@"},controller:"userSurveyController",controllerAs:"survey",bindToController:!0}}angular.module("srg-play.features").directive("userSurvey",userSurvey),userSurvey.$inject=[]}(),function(){function userSurveyController($sce,$window,SRGConfig,viewPorts,UrlPatternResolver){var userSurvey=this;function openSurvey(){var bu,version,survey,userAgent,currentViewport,resolvedUrl;userSurvey.link||(bu=SRGConfig.businessUnit,version=SRGConfig.version,survey=SRGConfig.sharedPortal.userSurvey[bu],userAgent=encodeURI($window.navigator.userAgent),currentViewport=viewPorts.getCurrent(),resolvedUrl=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.USER_SURVEY,{surveyId:survey.surveyId,version:version,userAgent:userAgent,viewPort:currentViewport},{clientip:userSurvey.clientIp}),userSurvey.link=$sce.trustAsResourceUrl(resolvedUrl)),userSurvey.show=!0}function closeSurvey(){userSurvey.show=!1}userSurvey.show=!1,userSurvey.open=openSurvey,userSurvey.close=closeSurvey}angular.module("srg-play.features").controller("userSurveyController",userSurveyController),userSurveyController.$inject=["$sce","$window","SRGConfig","viewPorts","UrlPatternResolver"]}(),angular.module("srg-play.features").directive("aToZFlyoutToggle",function(){return{restrict:"A",scope:!0,controller:"aToZNavigationToggleController"}}),function(){function AToZIndexNavigationService(_,atoZIndexServiceUnchunked,ShowsAToZRequestService){var aToZIndexService;function setTitleIfNotExistent(item){item.title=item.id}this.getAToZIndexList=function(indexAllTitle){var indexList=aToZIndexService.fullIndexList;return _.prepend({id:aToZIndexService.INDEX_ALL,title:indexAllTitle,isActive:!0},indexList)},this.requestAToZList=function(url,urlParams){return ShowsAToZRequestService.request(url,_.or(urlParams,{})).then(function(aToZList){return _.map(setTitleIfNotExistent,aToZList),aToZIndexService=atoZIndexServiceUnchunked(aToZList),aToZList})}}angular.module("srg-play.features").service("AToZIndexNavigationService",AToZIndexNavigationService),AToZIndexNavigationService.$inject=["_","atoZIndexServiceUnchunked","ShowsAToZRequestService"]}(),function(){function aToZNavigation($state,$timeout){var PORTAL_TYPE_TV="tv",PORTAL_TYPE_RADIO="radio",TV_ATOZ_NAVIGATION_CONTROLLER="AToZIndexTvNavigationController",RADIO_ATOZ_NAVIGATION_CONTROLLER="AToZIndexRadioNavigationController";return{restrict:"E",scope:{url:"@pageUrl",allKeyTitle:"@",toggleNavigation:"&",visibility:"=?"},compile:function(element,attrs){attrs.controller=function(portalType){if(portalType===PORTAL_TYPE_TV)return TV_ATOZ_NAVIGATION_CONTROLLER;if(portalType===PORTAL_TYPE_RADIO)return RADIO_ATOZ_NAVIGATION_CONTROLLER}(attrs.portalType)},template:'<ul class="showsAlphabeticalNavigation" on-escape="visibility = false;"><li class="showsAlphabeticalNavigation__index" ng-repeat="index in currentIndexList"><a class="showsAlphabeticalNavigation__link showsAlphabeticalNavigation__link--active" data-cs-referrer="" ng-class="{ \'showsAlphabeticalNavigation__link--selected\': index.title === currentIndexLetter }" ng-if="index.isActive" ng-href="[{[ ::url ]}]?index=[{[ ::index.id|encodeURIComponent ]}]" ng-click="toggleNavigation()"aria-label="[{[ ::index.title ]}]"><span>[{[ ::index.title ]}]</span></a><div class="showsAlphabeticalNavigation__link showsAlphabeticalNavigation__link--inactive" ng-if="!index.isActive"><span>[{[ ::index.title ]}]</span></div></li></ul>',controller:"@",name:"controller"}}angular.module("srg-play.features").directive("aToZNavigation",aToZNavigation),aToZNavigation.$inject=["$state","$timeout"]}(),angular.module("srg-play.features").controller("aToZNavigationToggleController",["$scope","indexChangeService","topicChangeService",function($scope,indexChangeService,topicChangeService){$scope.showAToZNavigation=!1,$scope.toggleAToZNavigation=function(){$scope.showAToZNavigation=!$scope.showAToZNavigation},$scope.hideAToZNavigation=function(){$scope.showAToZNavigation=!1},indexChangeService.registerIndexChangeCallback($scope.hideAToZNavigation),topicChangeService.registerTopicChangeCallback($scope.hideAToZNavigation)}]),function(){angular.module("srg-play.features").component("srgMobileNavigationButton",{template:'\n      <a class="toggleMenu naviBarEntry"\n        href=""\n        ng-click="$ctrl.toggleNavi()"\n        aria-label="{{ $ctrl.ariaLabel }}">\n          <span class="icon-menu"></span>\n      </a>\n      ',bindings:{navigation:"=",ariaLabel:"@",moreLinkText:"@",tvTabText:"@",radioTabText:"@",logoAltText:"@",closeText:"@"},controller:["$scope","viewStack",function($scope,viewStack){this.toggleNavi=function(){viewStack.pushSideNav({template:'<srg-mobile-navigation\n                          navigation="$ctrl.navigation"\n                          more-link-text="$ctrl.moreLinkText"\n                          tv-tab-text="$ctrl.tvTabText"\n                          radio-tab-text="$ctrl.radioTabText"\n                          alt-text-logo="$ctrl.logoAltText"\n                          close-text="$ctrl.closeText"/>',scope:$scope})}}]})}(),function(){angular.module("srg-play.features").component("srgMobileNavigation",{template:'\n        <div class="mobile-navigation">\n          <header class="mobile-navigation__header">\n            <div>\n              <div ng-if="$ctrl.hasRadioChannels()">\n                <button class="mobile-navigation__tab"\n                    ng-class="{ \'mobile-navigation__tab--active\' : $ctrl.isTVActive() }"\n                    ng-click="$ctrl.setActiveNavigation($ctrl.typeTv)">\n                  {{ $ctrl.tvTabText }}\n                </button>\n                <button class="mobile-navigation__tab"\n                    ng-class="{ \'mobile-navigation__tab--active\' : !$ctrl.isTVActive() }"\n                    ng-click="$ctrl.setActiveNavigation($ctrl.typeRadio)">\n                  {{ $ctrl.radioTabText }}\n                </button>\n              </div>\n            </div>\n            <button class="mobile-navigation__close icon-close" ng-click="$ctrl.close()" aria-label="{{ $ctrl.closeText }}"></button>\n          </header>\n          <main class="mobile-navigation__content">\n           <ul class="mobile-navigation__list">\n             <li class="list__entry"\n                 ng-repeat="navigationItem in $ctrl.getNavigationItems()">\n               <a class="list__navigation"\n                 ng-href="{{ navigationItem.link }}"\n                 ng-click="$ctrl.onNaviItemClick(navigationItem, $event)"\n                 aria-label="{{ navigationItem.text }}">\n\n                 <div class="list__image-container" ng-if="navigationItem.image" aria-hidden="true">\n                   <img\n                     class="list__image"\n                     ng-src="{{ navigationItem.image }}"\n                     alt="{{ navigationItem.text }}"/>\n                 </div>\n                 <srg-icon-text aria-hidden="true"\n                     icon-class="{{ navigationItem.iconClass }}"\n                     text="{{ navigationItem.text }}">\n                 </srg-icon-text>\n               </a>\n             </li>\n             <hr class="list__divider" aria-hidden="true">\n             <li class="list__entry">\n               <button class="list__navigation list__navigation--more" ng-click="$ctrl.openShowMore()">\n                 <srg-icon-text\n                     icon-class="icon-chevron-right"\n                     text="{{ $ctrl.moreLinkText }}">\n                 </srg-icon-text>\n               </button>\n             </li>\n           </ul>\n          </main>\n          <footer class="mobile-navigation__footer">\n           <a class="srgplayLogo mobile-navigation__logo" href="/play" title="{{ $ctrl.altTextLogo }}"></a>\n          </footer>\n        </div>\n      ',bindings:{navigation:"=",moreLinkText:"=",tvTabText:"=",radioTabText:"=",altTextLogo:"=",closeText:"="},controller:["$scope","$location","$window","viewStack","SRGConfig",function($scope,$location,$window,viewStack,SRGConfig){var isTVActive,vm=this;vm.typeRadio="radio",vm.typeTv="tv";var radioNavigationItems=[];vm.$onInit=function(){radioNavigationItems=SRGConfig.radioPortal.channels.map(function(channel){return{text:channel.name,link:"/play/radio?station=".concat(channel.id),image:channel.imageLiveModule,isRadio:!0}}),vm.setActiveNavigation($location.path().includes("/tv")?vm.typeTv:vm.typeRadio)},vm.openShowMore=function(){viewStack.pushSideNav({template:'<srg-mobile-navigation-more\n                           alt-text-logo="$ctrl.altTextLogo"\n                           navigation="$ctrl.navigation.moreNavigationItems"\n                           close-text="$ctrl.closeText"/>',scope:$scope})},vm.onNaviItemClick=function(navigationItem,$event){vm.close(),navigationItem.isRadio&&($event.preventDefault(),$window.location.assign(navigationItem.link))},vm.getNavigationItems=function(){return vm.isTVActive()?vm.navigation.tvNavigationItems:radioNavigationItems},vm.hasRadioChannels=function(){return!!radioNavigationItems.length},vm.isTVActive=function(){return isTVActive},vm.setActiveNavigation=function(type){isTVActive=!vm.hasRadioChannels()||type===vm.typeTv},vm.close=function(){return viewStack.pop()}}]})}(),function(){angular.module("srg-play.features").component("srgMobileNavigationMore",{template:'\n        <div class="mobile-navigation">\n          <header class="mobile-navigation__header">\n            <button class="mobile-navigation__back icon-chevron-left" ng-click="$ctrl.close()" aria-label="{{ $ctrl.closeText }}">         \n            </button>\n          </header>\n          <main class="mobile-navigation__content">\n           <ul class="mobile-navigation__list">\n             <li class="list__entry" \n                 ng-repeat="navigationItem in $ctrl.navigation">\n               <a class="list__navigation" \n                 ng-href="{{ navigationItem.link }}">\n                 {{ navigationItem.text }}\n               </a>\n             </li>\n           </ul>\n          </main>\n          <footer class="mobile-navigation__footer">\n           <a class="srgplayLogo mobile-navigation__logo" href="/play" title="{{ $ctrl.altTextLogo }}"></a>\n          </footer>    \n        </div>\n      ',bindings:{navigation:"=",altTextLogo:"=",closeText:"="},controller:["viewStack",function(viewStack){this.close=function(){viewStack.pop()}}]})}(),function(){angular.module("srg-play.features").component("srgMobileRadioSubnavigation",{template:'\n        <div class="radio-subnavigation">\n          <h1 class="radio-subnavigation__title">{{ $ctrl.currentStation.name}}</h1>\n          <ul class="radio-subnavigation__navigation">\n            <li ng-repeat="link in $ctrl.links"\n              class="radio-subnavigation__navigation-item"\n              ng-click="$ctrl.scrollToEntry($event)"\n              ng-class="{ \'radio-subnavigation__navigation-item--active\': $ctrl.isActive(link) }">\n              <a class="radio-subnavigation__link"\n                ng-href="{{ link.link }}">{{ link.title }}</a>\n            </li>\n          </ul>\n        </div>\n      ',bindings:{links:"="},controller:["$location","$element","$timeout","radioStationChoiceService",function($location,$element,$timeout,radioStationChoiceService){this.currentStation=radioStationChoiceService.getCurrentStationInfo(),this.isActive=function(link){return $location.path().endsWith(link.link)},this.$postLink=function(){$timeout(function(){scrollTo($element.find(".radio-subnavigation__navigation-item--active")[0])},100)},this.scrollToEntry=function(event){return scrollTo(event.target)};var minLeftOffset=150;function scrollTo(naviEntry){if(naviEntry&&naviEntry.offsetLeft){var offsetLeft=naviEntry.offsetLeft>minLeftOffset?naviEntry.offsetLeft:0;$element.find(".radio-subnavigation__navigation").scrollLeft(offsetLeft)}}}]})}(),function(){function PersonalizationHeaderController($scope,localStoreFactory){$scope.personalizationHeaderActive=!0;var store=localStoreFactory.getStoreEntry("personalizationSettings");store.settings=store.settings||{},!1===store.settings.showHeaderMessage&&($scope.personalizationHeaderActive=!1),$scope.closeHeaderMessage=function(){store.settings.showHeaderMessage=!1}}angular.module("srg-play.features").controller("PersonalizationHeaderController",PersonalizationHeaderController),PersonalizationHeaderController.$inject=["$scope","localStoreFactory"]}(),function(){function searchFlyoutController($q,$scope,$attrs,$location,searchTabSelection,searchFlyoutTrackingService,ally,URI){var tabSelection,flyoutFocusTrap,query,searchPageUrls,translatedLabels,searchFlyout=this;function openFlyout(){flyoutFocusTrap&&flyoutFocusTrap.disengage(),flyoutFocusTrap=ally.maintain.tabFocus({context:"#searchFlyoutContainer"}),searchFlyout.isOpen=!0}function closeFlyout(){flyoutFocusTrap&&(flyoutFocusTrap.disengage(),flyoutFocusTrap=null),searchFlyout.isOpen=!1}function selectTab(tabId){searchFlyoutTrackingService.trackTabChange({searchQuery:searchFlyout.searchQuery,activeTab:searchFlyout.activeTab.title}),searchFlyout.activeTab=tabSelection.selectTab(tabId),onSearchQueryChanged(searchFlyout.searchQuery)}function onSearchQueryChanged(query){!function(query){query&&query.length>0&&(searchFlyout.isOpen||searchFlyout.open())}(query),!function(query){return query&&query.length>=3}(query)?(resetFlyoutShows(),resetFlyoutAssets(),searchFlyout.isSearchQueryValid=!1):(searchFlyout.isSearchQueryValid=!0,searchFlyout.showNoResultsMessage=!1,$q.all([function(query){return searchFlyout.showsSearchInProcess=!0,searchFlyout.activeTab.requestShows(query,2).then(addShowsToFlyout).catch(resetFlyoutShows).finally(searchForShowsFinished)}(query),function(query){return searchFlyout.assetsSearchInProcess=!0,searchFlyout.activeTab.requestFirstPageOfAssets(query,4).then(addAssetsToFlyout).catch(resetFlyoutAssets).finally(searchForAssetsFinished)}(query)]).then(handleEmptySearchResults))}function handleEmptySearchResults(){searchFlyout.shows.length||searchFlyout.assets.length||(searchFlyoutTrackingService.trackNoResult({searchQuery:searchFlyout.searchQuery,activeTab:searchFlyout.activeTab.title}),searchFlyout.showNoResultsMessage=!0)}function addShowsToFlyout(result){searchFlyout.shows=result.shows||[],searchFlyout.numberOfAvailableShows=result.numberOfAvailableShows||0}function addAssetsToFlyout(result){searchFlyout.assets=result.assets||[],searchFlyout.numberOfAvailableAssets=result.numberOfAvailableAssets||0}function resetFlyoutShows(){searchFlyout.shows=[],searchFlyout.numberOfAvailableShows=0}function resetFlyoutAssets(){searchFlyout.assets=[],searchFlyout.numberOfAvailableAssets=0}function searchForAssetsFinished(){searchFlyout.assetsSearchInProcess=!1}function searchForShowsFinished(){searchFlyout.showsSearchInProcess=!1}function submitSearch(event){-1!==searchFlyout.activeTab.searchPageUrl.indexOf($attrs.activeSubPortal)&&function(event){event.preventDefault(),queryString=encodeURIComponent(searchFlyout.searchQuery),searchUrl=new URI(searchFlyout.activeTab.searchPageUrl).addQuery({query:queryString}).toString(),$location.url(searchUrl),closeFlyout();var queryString,searchUrl}(event),angular.isFunction(searchFlyout.outerOnSubmitSearch)&&searchFlyout.outerOnSubmitSearch()}searchFlyout.isOpen=!1,searchFlyout.isSearchQueryValid=!1,searchFlyout.showsSearchInProcess=!1,searchFlyout.assetsSearchInProcess=!1,searchFlyout.showNoResultsMessage=!1,searchPageUrls=$scope.$eval($attrs.searchPageUrls),translatedLabels=$scope.$eval($attrs.translatedLabels),tabSelection=searchTabSelection($attrs.activeSubPortal,translatedLabels,searchPageUrls),searchFlyout.tabs=tabSelection.tabs,searchFlyout.activeTab=tabSelection.activeTab,searchFlyout.isMoreThanOneTabAvailable=Object.keys(searchFlyout.tabs).length>1,searchFlyout.selectTab=selectTab,searchFlyout.open=openFlyout,searchFlyout.close=closeFlyout,searchFlyout.submitSearch=submitSearch,searchFlyout.outerOnSubmitSearch=$scope.$eval($attrs.searchOnSubmit),searchFlyout.tracking={trackTeaserClick:function(teaserPosition){searchFlyoutTrackingService.trackTeaserClick({searchQuery:searchFlyout.searchQuery,activeTab:searchFlyout.activeTab.title,teaserPosition:teaserPosition})},trackShowAllClick:function(){searchFlyoutTrackingService.trackShowAllClick({searchQuery:searchFlyout.searchQuery,activeTab:searchFlyout.activeTab.title})}},searchFlyout.searchQuery=(query=$location.search().query)?decodeURIComponent(query):void 0,$scope.$watch("searchFlyout.searchQuery",function(newValue,oldValue){newValue!==oldValue&&onSearchQueryChanged(newValue)})}angular.module("srg-play.features").controller("searchFlyoutController",searchFlyoutController),searchFlyoutController.$inject=["$q","$scope","$attrs","$location","searchTabSelection","searchFlyoutTrackingService","ally","URI"]}(),function(){function searchFlyoutTrackingService(tcEvents,$state){return{trackTabChange:function(data){tagCommanderTrackEvent({type:"SearchFlyout",name:"TabChange"},data)},trackNoResult:function(data){tagCommanderTrackEvent({type:"SearchFlyout",name:"NoResult"},data)},trackTeaserClick:function(data){tagCommanderTrackEvent({type:"SearchFlyout",name:"TeaserClick"},data)},trackShowAllClick:function(data){tagCommanderTrackEvent({type:"SearchFlyout",name:"ShowAllClick"},data)}};function tagCommanderTrackEvent(event,data){tcEvents({id:"hidden_event",data:{event_type:event.type,event_name:event.name,event_value_1:$state.current.name,event_value_2:data.searchQuery,event_value_3:data.activeTab,event_value_4:data.teaserPosition}})}}angular.module("srg-play.features").factory("searchFlyoutTrackingService",searchFlyoutTrackingService),searchFlyoutTrackingService.$inject=["tcEvents","$state"]}(),function(){function ShowsAToZRequestService(_,PlayJSONWebservice){return{request:function(showsAToZUrl,urlParams){return PlayJSONWebservice.getResource(showsAToZUrl,urlParams,{isArrayResponse:!0}).get().$promise}}}angular.module("srg-play.features").factory("ShowsAToZRequestService",ShowsAToZRequestService),ShowsAToZRequestService.$inject=["_","PlayJSONWebservice"]}(),function(){function mobileNaviBarController($scope){$scope.mobileSearch=!1,$scope.toggleSearchMobile=function(){return $scope.mobileSearch=!$scope.mobileSearch,$scope.mobileSearch},$scope.closeAllMobileTopNaviElements=function(){$scope.mobileSearch=!1}}mobileNaviBarController.$inject=["$scope"],angular.module("srg-play.features").controller("mobileNaviBarController",mobileNaviBarController)}(),function(){function radioCurrentPageIndicator(radioStationChoiceService,URI){return{restrict:"E",replace:!0,templateUrl:function(elem,attrs){attrs.channelIdOverride&&radioStationChoiceService.changeRadioStation(attrs.channelIdOverride);return new URI(attrs.templateUrl).addQuery({activePageKey:attrs.activePageKey,currentChannel:radioStationChoiceService.getCurrentStation()}).toString()}}}angular.module("srg-play.features").directive("radioCurrentPageIndicator",radioCurrentPageIndicator),radioCurrentPageIndicator.$inject=["radioStationChoiceService","URI"]}(),function(){function radioChannelNavigation(radioStationChoiceService,URI){return{restrict:"E",replace:!0,templateUrl:function(elem,attrs){attrs.channelIdOverride&&radioStationChoiceService.changeRadioStation(attrs.channelIdOverride);return new URI(attrs.templateUrl).addQuery({activeChannel:radioStationChoiceService.getCurrentStation()}).toString()}}}angular.module("srg-play.features").directive("radioChannelNavigation",radioChannelNavigation),radioChannelNavigation.$inject=["radioStationChoiceService","URI"]}(),function(){function eventModules(URI,$location){return{templateUrl:function(elem,attr){return url=attr.url,new URI(url).addQuery((pageQueryParameters=$location.search(),pageQueryParameters.eventId?{previewEventId:pageQueryParameters.eventId}:{})).toString();var url,pageQueryParameters}}}angular.module("srg-play.features").directive("eventModules",eventModules),eventModules.$inject=["URI","$location"]}(),function(){function livestreamTeaserController($scope,SRGConfig,moment,$interval){var livestreamInfoUpdate;function addLiveInformationToTeaser(){var livestream;$scope.teaser.isLive=(livestream=$scope.teaser).validFrom<=currentTimestamp()&&livestream.validTo>=currentTimestamp(),$scope.teaser.hasFinished=function(livestream){return livestream.validTo<currentTimestamp()}($scope.teaser),$scope.teaser.soonAvailable=function(livestream){return secondsTillLivestreamStart(livestream)<=(hours=SRGConfig.tvPortal.eventModule.soonAvailableBoundaryInHours,3600*hours)&&secondsTillLivestreamStart(livestream)>0;var hours}($scope.teaser),$scope.teaser.soonAvailable&&($scope.teaser.timeTillStart=function(livestream){return duration=moment.duration(secondsTillLivestreamStart(livestream),"seconds"),moment.utc(duration.asMilliseconds()).format("HH:mm:ss");var duration}($scope.teaser))}function secondsTillLivestreamStart(livestream){return livestream.validFrom-currentTimestamp()}function currentTimestamp(){return moment().unix()}livestreamInfoUpdate=$interval(addLiveInformationToTeaser,1e3),$scope.$on("$destroy",function(){$interval.cancel(livestreamInfoUpdate)})}angular.module("srg-play.features").controller("livestreamTeaserController",livestreamTeaserController),livestreamTeaserController.$inject=["$scope","SRGConfig","moment","$interval"]}(),function(){function progressBar(_,moment,$interval){return{restrict:"E",scope:{startTime:"=",endTime:"=",color:"@",backgroundColor:"@"},template:'<div class="progress-bar-background" ng-style="backgroundStyle"></div><div class="progress-bar" ng-style="progressBarStyle"></div>',link:function(scope,element,attrs){scope.backgroundStyle={width:"100%",height:"100%",position:"absolute","background-color":scope.backgroundColor},scope.progressBarStyle={width:getProgressAsPercentage()+"%",height:"100%",position:"absolute","background-color":scope.color};var progressBarUpdateInterval=$interval(function(){scope.progressBarStyle.width=getProgressAsPercentage()+"%"},2e3);function getProgressAsPercentage(){return(percentageValue=(moment().unix()-scope.startTime)/(scope.endTime-scope.startTime)*100)>100?100:Math.floor(percentageValue);var percentageValue}scope.$on("$destroy",function(){$interval.cancel(progressBarUpdateInterval)})}}}angular.module("srg-play.features").directive("progressBar",progressBar),progressBar.$inject=["_","moment","$interval"]}(),function(){function eventModule($http,$compile){return{link:function(scope,element){scope.eventId&&(eventId=scope.eventId,$http({method:"GET",url:"/play/tv/event/"+eventId}).then(renderResponse));var eventId;function renderResponse(response){element.replaceWith($compile(response.data)(scope))}},template:'<div class="loadingContainer" ng-activity-indicator="CircledGrey" skip-ng-show="yes"></div>',scope:{eventId:"@"}}}angular.module("srg-play.features").directive("eventModule",eventModule),eventModule.$inject=["$http","$compile"]}(),function(){angular.module("srg-play.features").directive("showsByDateFlyoutToggle",function(){return{restrict:"A",scope:!0,controller:"showsByDateNavigationFlyoutController"}})}(),function(){function subNavFlyoutController(_,$scope,showsFlyoutTrackingService){var flyouts,SHOWS_FLYOUT="shows",TOPICS_FLYOUT="topics",SHOWS_ALPHABETICAL_FLYOUT="alphabetical";function toggleFlyout(type){var selectedFlyout=_.find(_.propEq("type",type),flyouts),otherFlyouts=_.filter(_.pipe(_.propEq("type",type),_.not),flyouts);selectedFlyout.toggle(),otherFlyouts.forEach(_.pipe(_.prop("hide"),_.call))}function flyout(type,scopeKey,trackOpening){return{type:type,scopeKey:scopeKey,hide:function(){$scope[scopeKey]=!1},toggle:function(){$scope[scopeKey]=!$scope[scopeKey],!0===$scope[scopeKey]&&trackOpening&&trackOpening()}}}$scope.showTopicsFlyout=!1,$scope.showShowsFlyout=!1,$scope.showShowsAlphabeticalFlyout=!1,$scope.SHOWS_FLYOUT=SHOWS_FLYOUT,$scope.TOPICS_FLYOUT=TOPICS_FLYOUT,$scope.SHOWS_ALPHABETICAL_FLYOUT=SHOWS_ALPHABETICAL_FLYOUT,flyouts=[flyout(SHOWS_FLYOUT,"showShowsFlyout",showsFlyoutTrackingService.trackShowsFlyoutOpening),flyout(TOPICS_FLYOUT,"showTopicsFlyout"),flyout(SHOWS_ALPHABETICAL_FLYOUT,"showShowsAlphabeticalFlyout")],$scope.toggleFlyout=toggleFlyout}angular.module("srg-play.features").controller("subNavFlyoutController",subNavFlyoutController),subNavFlyoutController.$inject=["_","$scope","showsFlyoutTrackingService"]}(),angular.module("srg-play.features").directive("topicsFlyoutToggle",function(){return{restrict:"A",controller:"topicsNavigationToggleController"}}),function(){function topicsNavigationController(topicsProviderFactory){var navigation=this;navigation.topics=[],topicsProviderFactory().then(function(topicsProvider){return navigation.topics=topicsProvider.topics()})}angular.module("srg-play.features").controller("topicsNavigationController",topicsNavigationController).directive("topicsNavigation",function(){return{restrict:"E",scope:{onTopicsPage:"=",visibility:"=?"},template:'<div class="subNav__flyout topicsNavigation" aria-live="polite" on-escape="navigation.visibility = false;"><ul class="topicList"><li class="topic" ng-repeat="topic in navigation.topics track by topic.id"><a data-cs-referrer=""class="topicLink" ng-click="navigation.visibility = false;"ng-href="[{[ ::topic.url ]}]"><span class="topicTitle">[{[ ::topic.title ]}]</span></a></li></ul></div>',controller:"topicsNavigationController",controllerAs:"navigation",bindToController:!0}}),topicsNavigationController.$inject=["topicsProviderFactory"]}(),function(){angular.module("srg-play.features").factory("searchTab",function(){return function(options){var tab={},active=!1;return tab.title=options.title,tab.translatedInShowsLabel=options.translatedInShowsLabel,tab.translatedInAssetsLabel=options.translatedInAssetsLabel,tab.searchPageUrl=options.searchPageUrl,tab.requestShows=options.requestShows,tab.requestFirstPageOfAssets=options.requestFirstPageOfAssets,tab.requestNextPageOfAssets=options.requestNextPageOfAssets,tab.isActive=function(){return active},tab.activate=function(){active=!0},tab.deactivate=function(){active=!1},tab}})}(),function(){function searchTabSelection(_,$q,SRGConfig,searchTab,tvShowsSearchRequestService,radioShowsSearchRequestService,videosSearchRequestServiceFactory,audiosSearchRequestServiceFactory){return function(currentSubPortal,translatedLabels,searchPageUrls){var tabSelection={},videosSearchRequestService=videosSearchRequestServiceFactory(),audiosSearchRequestService=audiosSearchRequestServiceFactory();return function(){tabSelection.SEARCH_TAB_TV_ID="tv",tabSelection.SEARCH_TAB_RADIO_ID="radio",tabSelection.tabs={},tabSelection.activeTab={},tabSelection.tabs[tabSelection.SEARCH_TAB_TV_ID]=(tvShowsRequest=areShowsAvailable()?requestTvShows:function(){return $q.reject("current BU does not have shows")},searchTab({title:translatedLabels.tv,translatedInAssetsLabel:translatedLabels.inVideos,translatedInShowsLabel:translatedLabels.inShows,searchPageUrl:searchPageUrls.tv,requestShows:tvShowsRequest,requestFirstPageOfAssets:requestFirstPageOfVideos,requestNextPageOfAssets:requestNextPageOfVideos})),SRGConfig.sharedPortal.searchFilter.radio.url&&(tabSelection.tabs[tabSelection.SEARCH_TAB_RADIO_ID]=(radioShowsRequest=areShowsAvailable()?requestRadioShows:function(){return $q.reject("current BU does not have shows")},searchTab({title:translatedLabels.radio,translatedInAssetsLabel:translatedLabels.inAudios,translatedInShowsLabel:translatedLabels.inShows,searchPageUrl:searchPageUrls.radio,requestShows:radioShowsRequest,requestFirstPageOfAssets:requestFirstPageOfAudios,requestNextPageOfAssets:requestNextPageOfAudios})));var radioShowsRequest;var tvShowsRequest;return tabSelection.selectTab=selectTab,tabSelection.isTvTabActive=isTabActive.bind({},tabSelection.SEARCH_TAB_TV_ID),tabSelection.isRadioTabActive=isTabActive.bind({},tabSelection.SEARCH_TAB_RADIO_ID),selectTab(currentSubPortal),tabSelection}();function selectTab(tabId){var targetTab=tabSelection.tabs[tabId],otherTabs=_.omit([tabId],tabSelection.tabs);return targetTab&&(targetTab.activate(),_.values(otherTabs).forEach(function(tab){tab.deactivate()}),tabSelection.activeTab=targetTab),tabSelection.activeTab}function isTabActive(tabId){return tabSelection.tabs[tabId]&&tabSelection.tabs[tabId].isActive()}function areShowsAvailable(){return SRGConfig.areShowsAvailable}function requestTvShows(query,numberOfShows){var requestConfig={searchQuery:encodeURIComponent(query),numberOfShows:numberOfShows};return tvShowsSearchRequestService.request(requestConfig)}function requestRadioShows(query,numberOfShows){var requestConfig={searchQuery:encodeURIComponent(query),numberOfShows:numberOfShows};return radioShowsSearchRequestService.request(requestConfig)}function requestFirstPageOfVideos(query,numberOfAssets){var requestConfig={searchQuery:encodeURIComponent(query),numberOfVideos:numberOfAssets};return videosSearchRequestService.requestFirstPage(requestConfig).then(handleVideosResponse)}function requestNextPageOfVideos(){return videosSearchRequestService.requestNextPage().then(handleVideosResponse)}function requestFirstPageOfAudios(query,numberOfAssets){var requestConfig={searchQuery:encodeURIComponent(query),numberOfAudios:numberOfAssets};return audiosSearchRequestService.requestFirstPage(requestConfig).then(handleAudiosResponse)}function requestNextPageOfAudios(){return audiosSearchRequestService.requestNextPage().then(handleAudiosResponse)}function handleVideosResponse(response){return{assets:response.videos,numberOfAvailableAssets:response.numberOfAvailableVideos,nextPageUrl:response.nextPageUrl}}function handleAudiosResponse(response){return{assets:response.audios,numberOfAvailableAssets:response.numberOfAvailableAudios,nextPageUrl:response.nextPageUrl}}}}angular.module("srg-play.features").factory("searchTabSelection",searchTabSelection),searchTabSelection.$inject=["_","$q","SRGConfig","searchTab","tvShowsSearchRequestService","radioShowsSearchRequestService","videosSearchRequestServiceFactory","audiosSearchRequestServiceFactory"]}(),angular.module("srg-play.features").directive("maRts",["viewPorts","$window",function(viewPorts,$window){function callbackForMediumUpViewPortChange(viewport,scope){"small"==scope.currentViewPort&&moveMaRTS($(scope.mediumUpViewPortParentNode)),scope.currentViewPort=viewport}function moveMaRTS(destination){$("ma-rts").remove().appendTo(destination)}return{restrict:"E",scope:{smallViewPortParentNode:"@",mediumUpViewPortParentNode:"@"},link:function(scope,element){!function(scope,element){viewPorts.callbackForSmall(function(){moveMaRTS($(scope.smallViewPortParentNode)),scope.currentViewPort="small"},function(){$(scope.smallViewPortParentNode).append(element),scope.currentViewPort="small"}),viewPorts.callbackForMedium(function(){callbackForMediumUpViewPortChange("medium",scope)},function(){scope.currentViewPort="medium"}),viewPorts.callbackForLarge(function(){callbackForMediumUpViewPortChange("large",scope)},function(){scope.currentViewPort="large"}),viewPorts.callbackForXLarge(function(){callbackForMediumUpViewPortChange("xlarge",scope)},function(){scope.currentViewPort="xlarge"})}(scope,element)}}}]),function(){function maRtsInfo(CookieService,SRGConfig,GetRequestService){var _peachUserHistory,url,peachCookieName="peach_infos";return isActive()&&isLoggedIn()&&(url=SRGConfig.peachUserHistoryHost,_peachUserHistory=GetRequestService(url,void 0,{withCredentials:!0})),{isActive:isActive,isLoggedIn:isLoggedIn,getPeachUserHistory:function(){return _peachUserHistory},getPeachUserId:function(){return function(){try{return JSON.parse(CookieService.getCookieValue(peachCookieName))}catch(e){return{}}}().userId}};function isActive(){return SRGConfig.isMaRTSActive}function isLoggedIn(){return void 0!==CookieService.getCookieValue(peachCookieName)}}angular.module("srg-play.features").factory("maRtsInfo",maRtsInfo),maRtsInfo.$inject=["CookieService","SRGConfig","GetRequestService"]}(),function(){function showsByDateNavigationFlyoutController($scope,$attrs,moment,URI,$location,$window,$state){var showsByDateUri;function redirectToTodaysShowsByDatePage(){redirectToShowsByDatePage(moment().format("DD-MM-YYYY"))}function redirectToYesterdaysShowsByDatePage(){redirectToShowsByDatePage(moment().subtract(1,"day").format("DD-MM-YYYY"))}function redirectToShowsByDatePage(dateString){angular.isFunction($scope.$parent.toggleNaviMobile)&&$scope.$parent.toggleNaviMobile(),toggleCalendar(),$location.url(function(dateString){return showsByDateUri.setSearch("date",dateString),showsByDateUri.toString()}(dateString))}function toggleCalendar(){$scope.showShowsByDateCalendar=!$scope.showShowsByDateCalendar}showsByDateUri=URI($attrs.showsByDateUrl),$scope.showShowsByDateCalendar=!1,$scope.toggleShowsByDateCalendar=toggleCalendar,$scope.changeDay=redirectToShowsByDatePage,$scope.requestToday=redirectToTodaysShowsByDatePage,$scope.requestYesterday=redirectToYesterdaysShowsByDatePage}angular.module("srg-play.features").controller("showsByDateNavigationFlyoutController",showsByDateNavigationFlyoutController),showsByDateNavigationFlyoutController.$inject=["$scope","$attrs","moment","URI","$location","$window","$state"]}(),function(){function chartbeatService($location,srgChartbeat){return{trackVirtualPageChange:function(newPageTitle){srgChartbeat.virtualPage($location.path(),newPageTitle)}}}angular.module("srg-play.features").service("chartbeatService",chartbeatService),chartbeatService.$inject=["$location","srgChartbeat"]}(),function(){function NetmetrixTrackingImage($location,$document,$window,URI){var TRACKING_DOMAIN="wemfbox.ch",TRACKING_URL_PATH="/cgi-bin/ivw/CP/srgplayer";return{restrict:"E",scope:{subDomain:"@trackingSubDomain",sslSubDomain:"@secureTrackingSubDomain"},template:'<img class="wemfCallImg hideImg" ng-src="[{[ netmetrixTrackingUrl ]}]" width="1" height="1" />',link:function(scope){scope.netmetrixTrackingUrl=buildNetmetrixImageUrl($document.prop("referrer"),scope.subDomain,scope.sslSubDomain),scope.$on("netmetrixReferrerChange",function(event,referrer){scope.netmetrixTrackingUrl=buildNetmetrixImageUrl(referrer,scope.subDomain,scope.sslSubDomain)})}};function getTrackingBaseUrl(subDomain,sslSubDomain){var trackingUrlSubDomain="https"===$location.protocol()?sslSubDomain:subDomain;return $location.protocol()+"://"+trackingUrlSubDomain+"."+TRACKING_DOMAIN}function buildNetmetrixImageUrl(referrer,subDomain,sslSubDomain){var url=new URI(getTrackingBaseUrl(subDomain,sslSubDomain));return url.path(TRACKING_URL_PATH).addQuery(function(referrer){return{r:escape(referrer),d:1e5*Math.random(),x:$window.screen.width+"x"+$window.screen.height}}(referrer)),url.toString()}}angular.module("srg-play.features").directive("netmetrixTrackingImage",NetmetrixTrackingImage),NetmetrixTrackingImage.$inject=["$location","$document","$window","URI"]}(),function(){function peachService($window,$location,$filter,moment){var _recommendations={};return{sendPageView:function(isActive){isActive&&$window._pipe("collect","pageview")},sendRecommendationDisplayed:function(recommendation){recommendation.isLoadedMore=!1,storeRecommendation(recommendation),$window._pipe("collect","recommendation_displayed",setRecommendationEvent("recommendation_displayed",recommendation.id,recommendation.items.slice(0,4)))},sendRecommendationHit:function(recommendationId,teaserId){$window._pipe("collect","recommendation_hit",setRecommendationHitEvent("recommendation_hit",recommendationId,getRecommendation(recommendationId),teaserId))},setRecommendationHitEvent:setRecommendationHitEvent,sendRecommendationDisplayedLoadMore:function(recommendationId){var recommendation=getRecommendation(recommendationId);recommendation.isLoadedMore=!0,$window._pipe("collect","recommendation_displayed",setRecommendationEvent("recommendation_displayed",recommendationId,recommendation.items))},setRecommendationEvent:setRecommendationEvent,getRecommendation:getRecommendation,storeRecommendation:storeRecommendation};function storeRecommendation(recommendation){_recommendations[recommendation.id]=recommendation}function getRecommendation(recommendationId){return _recommendations[recommendationId]}function setRecommendationEvent(type,id,items){var recommendation={context:{}};return recommendation.id="io.ebu.peach:".concat(id),recommendation.type=type,recommendation.event_timestamp=moment().valueOf(),recommendation.context.items=items.map(function(item){return item.urn}),recommendation.context.items_displayed=recommendation.context.items.length,recommendation.context.page_uri=$location.absUrl(),recommendation.context.source="teaserModule",recommendation}function setRecommendationHitEvent(type,id,reco,teaserId){var items=reco.isLoadedMore?reco.items:reco.items.slice(0,4),recommendation={context:{}};return recommendation.context.hit_index=items.indexOf($filter("filter")(items,{id:teaserId})[0]),recommendation.id="io.ebu.peach:".concat(id),recommendation.type=type,recommendation.event_timestamp=moment().valueOf(),recommendation.context.items=items.map(function(item){return item.urn}),recommendation.context.items_displayed=items.length,recommendation.context.page_uri=$location.absUrl(),recommendation.context.source="teaserModule",recommendation}}angular.module("srg-play.features").service("peachService",peachService),peachService.$inject=["$window","$location","$filter","moment"]}(),function(){var gizmo={cssClasses:{openInOverlay:".sg-b-l-t",openInWindow:".sg-b-l-m",dismiss:".sg-js-d",dismissOverlay:".sg-b-p-c"},apiCalls:{initialisation:"init",trackingData:"data",surveyOfferedEvent:"onoffered"},gizmoEvents:{eventName:"surveyGizmoEvent",eventValueOffered:"SurveyOffered",eventValueClicked:"SurveyClicked",surveyIdRegex:/surveygizmo.com\/s3\/([0-9]*)+/}};function srgSurveyGizmo($,surveyGizmo,CookieService){return{restrict:"A",link:function(scope,element,attrs){var surveyGizmoId,isCookieSet,value;surveyGizmoId=attrs.srgSurveyGizmo,surveyGizmo(gizmo.apiCalls.initialisation,surveyGizmoId),isCookieSet=CookieService.getCookieObject("sg_random_sample"),value=Math.floor(101*Math.random()),isCookieSet||CookieService.setCookieValue("sg_random_sample",value,60,!0),surveyGizmo(gizmo.apiCalls.surveyOfferedEvent,gizmoWasOffered),$("html").on("click",gizmo.cssClasses.openInWindow,gizmoWasClicked),$("html").on("click",gizmo.cssClasses.openInOverlay,gizmoWasClicked),$("html").on("click",gizmo.cssClasses.dismiss,gizmoWasDismissed),$("html").on("click",gizmo.cssClasses.dismissOverlay,gizmoWasDismissed)}};function gizmoWasOffered(){$("body").trigger(gizmo.gizmoEvents.eventName,[gizmo.gizmoEvents.eventValueOffered])}function gizmoWasClicked(){$("body").trigger(gizmo.gizmoEvents.eventName,[gizmo.gizmoEvents.eventValueClicked]),setSurveyGizmoCookie("Opened")}function gizmoWasDismissed(){setSurveyGizmoCookie("Dismissed")}function setSurveyGizmoCookie(value){var url,matches,link=$(gizmo.cssClasses.openInWindow),gizmoSurveyId=(url=link.attr("href"),(matches=url.match(gizmo.gizmoEvents.surveyIdRegex))&&matches.length?matches[1]:void 0);gizmoSurveyId&&CookieService.setCookieValue("sg_survey_"+gizmoSurveyId,value,60,!0)}}angular.module("srg-play.features").directive("srgSurveyGizmo",srgSurveyGizmo),srgSurveyGizmo.$inject=["$","surveyGizmo","CookieService"]}(),function(){function tagCommanderBehaviouralDataCollector(tagCommanderStorageService){return{link:function(scope,element,attrs){element.on("click","a[data-cs-referrer]",function(event){var str,referrer=$(this).attr("data-cs-referrer");$(this).parents("[data-cs-referrer]").each(function(){referrer=$(this).attr("data-cs-referrer")+(referrer.length>0?"&"+referrer:"")}),tagCommanderStorageService.setReferrerBehaviouralData((str=referrer,JSON.parse('{"'+decodeURI(str).replace(/"/g,'\\"').replace(/&(amp;)?/g,'","').replace(/=/g,'":"')+'"}')))})},restrict:"A"}}angular.module("srg-play.features").directive("tagCommanderBehaviouralDataCollector",tagCommanderBehaviouralDataCollector),tagCommanderBehaviouralDataCollector.$inject=["tagCommanderStorageService"]}(),function(){function tagCommander($window,angularElement,tagCommanderStorageService,personalizationMetadataProvider,userId,SRGConfig,maRtsInfo){return{link:function(scope,element,attrs){attrs.data&&attrs.scriptUrl&&(SRGConfig.isTcActive||scope.$eval(attrs.ignoreSrgConfigFlag))&&($window.tc_vars=scope.$eval(attrs.data),delete $window.tc_vars.ignoreSrgConfigFlag,$window.tc_vars.page_id_referrer=tagCommanderStorageService.getReferrerPageId(),tagCommanderStorageService.deleteReferrerPageId(),referrerBehaviouralData=tagCommanderStorageService.getReferrerBehaviouralData(),angular.forEach(referrerBehaviouralData,function(value,key){$window.tc_vars[key]=value}),tagCommanderStorageService.deleteReferrerBehaviouralData(),tagCommanderStorageService.setReferrerPageId($window.tc_vars.page_id),function(){$window.tc_vars.personalization_portal_status=personalizationMetadataProvider.getPersonalizationPortalStatus(),$window.tc_vars.personalization_user_status=personalizationMetadataProvider.getPersonalizationUserStatus();var storedUserId=userId.get();storedUserId?$window.tc_vars.user_id_log_in=storedUserId:maRtsInfo.isActive()&&($window.tc_vars.srg_user_is_logged=maRtsInfo.isLoggedIn()?"true":"false")}(),$window.tc_vars=Object.assign({},$window.tc_vars,tagCommanderStorageService.getSrgModuleMeasurement()),(tcContainer=angularElement("<script/>")).attr("src",attrs.scriptUrl),tcContainer.insertAfter(element));var tcContainer;var referrerBehaviouralData},restrict:"E"}}angular.module("srg-play.features").directive("tagCommander",tagCommander),tagCommander.$inject=["$window","angularElement","tagCommanderStorageService","personalizationMetadataProvider","userId","SRGConfig","maRtsInfo"]}(),function(){function tagCommanderStorageService($sessionStorage,$timeout,localStoreFactory){var sessionStorage=$sessionStorage,sessionStorageKeys={PAGE_ID:"tagCommander_referrerPageId",BEHAVIOURAL_DATA:"tagCommander_referrerBehaviouralData"},localStorageKeys={MODULE_MEASUREMENT:"srf:analytics:mod"};return{setReferrerPageId:function(pageId){sessionStorage[sessionStorageKeys.PAGE_ID]=pageId},getReferrerPageId:function(){return sessionStorage[sessionStorageKeys.PAGE_ID]||""},deleteReferrerPageId:function(){delete sessionStorage[sessionStorageKeys.PAGE_ID]},setReferrerBehaviouralData:function(dataObject){sessionStorage[sessionStorageKeys.BEHAVIOURAL_DATA]=dataObject||{}},getReferrerBehaviouralData:function(){return sessionStorage[sessionStorageKeys.BEHAVIOURAL_DATA]||{}},deleteReferrerBehaviouralData:function(){delete sessionStorage[sessionStorageKeys.BEHAVIOURAL_DATA]},getSrgModuleMeasurement:function(){var localStoredMeasurement=localStoreFactory.getStoreEntry([localStorageKeys.MODULE_MEASUREMENT]);$timeout(function(){return localStoreFactory.deleteStoreEntry([localStorageKeys.MODULE_MEASUREMENT])},0);return{srg_mod1:localStoredMeasurement.srg_override_mod1||localStoredMeasurement.srg_mod1||"",srg_mod2:localStoredMeasurement.srg_override_mod2||localStoredMeasurement.srg_mod2||"",srg_mod3:localStoredMeasurement.srg_override_mod3||localStoredMeasurement.srg_mod3||"",srg_mod4:localStoredMeasurement.srg_override_mod4||localStoredMeasurement.srg_mod4||""}}}}angular.module("srg-play.features").service("tagCommanderStorageService",tagCommanderStorageService),tagCommanderStorageService.$inject=["$sessionStorage","$timeout","localStoreFactory"]}(),function(){function personalizationSettingsTracking(tcEvents,PersonalizationSettingsObserver){return{startTrackingSettingChanges:function(){PersonalizationSettingsObserver.onPersonalizationActivation(function(){return callTcEvents("on")}),PersonalizationSettingsObserver.onPersonalizationDeactivation(function(){return callTcEvents("off")})}};function callTcEvents(personalizationStatusString){tcEvents({id:"hidden_event",data:{event_type:"PersonalizationSettings",event_name:"SettingsChanged",event_value_1:personalizationStatusString}})}}angular.module("srg-play.features").factory("personalizationSettingsTracking",personalizationSettingsTracking),personalizationSettingsTracking.$inject=["tcEvents","PersonalizationSettingsObserver"]}(),function(){function personalizationMetadataProvider(SRGConfig,PersonalizationSettings){var on="on",off="off";return{getPersonalizationPortalStatus:function(){return isPersonalizationOffered()?on:off},getPersonalizationUserStatus:function(){return isPersonalizationOffered()&&PersonalizationSettings.isPersonalizationActive()?on:off}};function isPersonalizationOffered(){return SRGConfig.isPersonalizationOffered}}angular.module("srg-play.features").factory("personalizationMetadataProvider",personalizationMetadataProvider),personalizationMetadataProvider.$inject=["SRGConfig","PersonalizationSettings"]}(),function(){function AToZIndexRadioNavigationController(_,$scope,SRGConfig,radioStationChoiceService,AToZIndexNavigationService,UrlPatternResolver){function requestAtoZList(id){var urlType,urlParamObject,params={channelId:id||radioStationChoiceService.getCurrentStation()},url=(urlType=UrlPatternResolver.RADIO_SHOWS_A_TO_Z_LIST,urlParamObject=params,UrlPatternResolver.resolveUrlPattern(urlType,urlParamObject));url&&($scope.requestInProcess=!0,AToZIndexNavigationService.requestAToZList(url,{}).then(function(){$scope.currentIndexList=AToZIndexNavigationService.getAToZIndexList($scope.allKeyTitle)}).catch(function(){$scope.requestInProcess=!1}))}$scope.currentIndexList=[],radioStationChoiceService.registerCallback(function(id){requestAtoZList(id)}),requestAtoZList()}angular.module("srg-play.features").controller("AToZIndexRadioNavigationController",AToZIndexRadioNavigationController),AToZIndexRadioNavigationController.$inject=["_","$scope","SRGConfig","radioStationChoiceService","AToZIndexNavigationService","UrlPatternResolver"]}(),function(){function AToZIndexTvNavigationController(_,$scope,$location,SRGConfig,AToZIndexNavigationService){var url;$scope.currentIndexList=[],$scope.currentIndexLetter=$location.search().index,$scope.$on("$locationChangeStart",function(){$scope.currentIndexLetter=$location.search().index}),(url=SRGConfig.tvPortal.ajaxUrls.showsAtoZList)&&($scope.requestInProcess=!0,AToZIndexNavigationService.requestAToZList(url).then(function(){$scope.currentIndexList=AToZIndexNavigationService.getAToZIndexList($scope.allKeyTitle)}).catch(function(){$scope.requestInProcess=!1}))}angular.module("srg-play.features").controller("AToZIndexTvNavigationController",AToZIndexTvNavigationController),AToZIndexTvNavigationController.$inject=["_","$scope","$location","SRGConfig","AToZIndexNavigationService"]}(),function(){angular.module("srg-play.features").directive("showHistoryFlyoutToggle",function(){return{restrict:"A",controller:"showHistoryMobileNavigationController"}})}(),function(){angular.module("srg-play.features").directive("showsFlyout",function(){return{restrict:"E",template:'<div class="subNav__flyout showsFlyout" on-escape="visibility = false;"><span class="showsFlyout__sectionTitle">[{[ ::showsByDateHeadline ]}]</span><div class="showsFlyout__section showsFlyout__byDate"><div class="showsFlyout__byDateButtons"><a ng-click="flyout.tracking.trackByDateYesterdayClick(); flyout.toggleFlyoutVisibility();" ng-href="[{[ ::showsByDateYesterdayUrl ]}]" class="button">[{[ ::showsByDateYesterday ]}]</a><a ng-click="flyout.tracking.trackByDateTodayClick(); flyout.toggleFlyoutVisibility();" ng-href="[{[ ::showsByDateTodayUrl ]}]" class="button">[{[ ::showsByDateToday ]}]</a><button id="showsFlyout-calendarButton" class="button calendarButton" ng-hide="flyout.showCalendar" ng-click="flyout.switchVisibleSection()"><span class="calendarButton__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M18.222 7.333H5.778v10.111h12.444V7.334zM5.778 17.513c0-.078 0-.107.005-.114.038.042.018.045-.04.045h.035v.07zm.044-.08c0-.005-.01-.014-.023-.025-.008-.008-.013-.013-.016-.009l.039.035zm13.1-11.655c.403 0 .615.04.863.336a.883.883 0 0 1 .207.5c.007.073.008.114.008.238v10.661c0 .136 0 .19-.004.262-.01.23-.041.419-.125.607a1.015 1.015 0 0 1-.949.618H5.564C4.84 19 4 18.233 4 17.513V6.878c0-.548.37-.875.846-1.013.223-.065.458-.087.718-.087h13.358z"/><path d="M5.342 11.056c-.43 0-.778-.274-.778-.612 0-.337.349-.61.778-.61h12.882c.43 0 .778.273.778.61 0 .338-.348.612-.778.612H5.342zM6.556 5A.778.778 0 1 1 8.11 5v1.556a.778.778 0 0 1-1.555 0V5zM15.889 5a.778.778 0 0 1 1.555 0v1.556a.778.778 0 1 1-1.555 0V5z"/><path d="M7.687 13.556a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.195 0 .354.16.354.354v.848c0 .194-.16.354-.354.354h-.848zM12.424 13.556h-.848a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.194 0 .354.16.354.354v.848c0 .194-.16.354-.354.354M16.313 13.556h-.848a.355.355 0 0 1-.354-.354v-.848c0-.195.16-.354.354-.354h.848c.194 0 .354.16.354.354v.848c0 .194-.16.354-.354.354"/></g></svg></span>[{[ showsByDateCalendar ]}]</button><date-selector ng-show="flyout.showCalendar" config="flyout.dateSelectionConfig" date-model="currentDate" on-submit="flyout.onDateSelect(dateString)" hide-next-prev-day-buttons="true"></date-selector></div><date-picker-with-model ng-show="flyout.showCalendar" config="flyout.dateSelectionConfig" date-model="currentDate" on-select="flyout.onDateSelect(dateString)"></date-picker-with-model></div><span class="showsFlyout__sectionTitle" ng-show="flyout.showAToZList">[{[ ::showsAlphabeticalHeadline ]}]</span><a-to-z-navigation ng-click="flyout.tracking.trackAtoZIndexClick(); flyout.toggleFlyoutVisibility();" class="showsFlyout__section showsFlyout__alphabetical" page-url="[{[ ::showsAlphabeticalUrl ]}]" portal-type="tv" all-key-title="[{[ ::showsAlphabeticalAllKeyTitle ]}]" ng-show="flyout.showAToZList"></a-to-z-navigation><span class="showsFlyout__sectionTitle" ng-show="flyout.showShowHistory">[{[ ::showHistoryHeadline ]}]</span><show-history class="showsFlyout__section showsFlyout__history" latest-episode-label="[{[ ::showHistoryLatestEpisode ]}]" ng-show="flyout.showShowHistory"></show-history></div>',scope:{showHistoryHeadline:"@",showHistoryLatestEpisode:"@",showsByDateHeadline:"@",showsByDateToday:"@",showsByDateYesterday:"@",showsByDateTodayUrl:"@",showsByDateYesterdayUrl:"@",showsByDateCalendar:"@",showsByDateCalendarConfig:"@",showsAlphabeticalHeadline:"@",showsAlphabeticalAllKeyTitle:"@",showsAlphabeticalUrl:"@",visibility:"=?"},controller:"showsFlyoutController",controllerAs:"flyout"}})}(),function(){function showsFlyoutController($scope,$attrs,$location,showHistory,UrlPatternResolver,showsFlyoutTrackingService,PersonalizationSettingsObserver,PersonalizationSettings){var flyout=this;function originalFlyoutState(){flyout.showCalendar=!1,flyout.showAToZList=!0,setupShowHistoryVisibility()}function setupShowHistoryVisibility(){flyout.showShowHistory=PersonalizationSettings.isPersonalizationActive()&&showHistory.get().length>0}function onDateSelection(dateString){flyout.tracking.trackByDateDateClick(),toggleFlyoutVisibility(),switchVisibleSection(),function(dateString){$location.url(function(dateString){return UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.SHOWS_BY_DATE,{date:dateString})}(dateString))}(dateString)}function switchVisibleSection(){flyout.showAToZList=!flyout.showAToZList,flyout.showCalendar=!flyout.showCalendar}function toggleFlyoutVisibility(){$scope.visibility=!$scope.visibility}$scope.$watch("visibility",function(newState,oldState){!1===newState&&originalFlyoutState()}),originalFlyoutState(),flyout.switchVisibleSection=switchVisibleSection,flyout.toggleFlyoutVisibility=toggleFlyoutVisibility,flyout.dateSelectionConfig=$scope.$eval($attrs.showsByDateCalendarConfig),flyout.onDateSelect=onDateSelection,PersonalizationSettingsObserver.onPersonalizationDeactivation(function(){flyout.showShowHistory=!1}),setupShowHistoryVisibility(),flyout.tracking={trackByDateDateClick:showsFlyoutTrackingService.trackByDateDateClick,trackAtoZIndexClick:showsFlyoutTrackingService.trackAtoZIndexClick,trackByDateTodayClick:showsFlyoutTrackingService.trackByDateTodayClick,trackByDateYesterdayClick:showsFlyoutTrackingService.trackByDateYesterdayClick}}angular.module("srg-play.features").controller("showsFlyoutController",showsFlyoutController),showsFlyoutController.$inject=["$scope","$attrs","$location","showHistory","UrlPatternResolver","showsFlyoutTrackingService","PersonalizationSettingsObserver","PersonalizationSettings"]}(),function(){function showsFlyoutTrackingService(tcEvents){return{trackShowsFlyoutOpening:function(){tagCommanderTrackShowsFlyoutInteraction({type:"tvSubnavigationShowsFlyout",name:"flyoutInteraction",value_1:"open"})},trackByDateTodayClick:function(){tagCommanderTrackShowsFlyoutInteraction({type:"tvSubnavigationShowsFlyout",name:"byDateClick",value_1:"today"})},trackByDateYesterdayClick:function(){tagCommanderTrackShowsFlyoutInteraction({type:"tvSubnavigationShowsFlyout",name:"byDateClick",value_1:"yesterday"})},trackByDateDateClick:function(){tagCommanderTrackShowsFlyoutInteraction({type:"tvSubnavigationShowsFlyout",name:"byDateClick",value_1:"calendar"})},trackAtoZIndexClick:function(){tagCommanderTrackShowsFlyoutInteraction({type:"tvSubnavigationShowsFlyout",name:"AtoZClick",value_1:"load"})}};function tagCommanderTrackShowsFlyoutInteraction(event){tcEvents({id:"hidden_event",data:{event_type:event.type,event_name:event.name,event_value_1:event.value_1}})}}angular.module("srg-play.features").factory("showsFlyoutTrackingService",showsFlyoutTrackingService),showsFlyoutTrackingService.$inject=["tcEvents"]}(),function(){function audiosSearchRequestServiceFactory(PlayJSONWebservice,UrlPatternResolver,$q){return function(){var nextPageUrl;return{requestFirstPage:function(showsSearchRequestConfig){return getSearchRequestPromise((requestConfig=showsSearchRequestConfig,UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.AUDIOS_SEARCH,requestConfig))).then(saveNextPageUrl);var requestConfig},requestNextPage:function(){return nextPageUrl?getSearchRequestPromise(nextPageUrl).then(saveNextPageUrl):$q.reject("no first page request was made or there are no more pages")}};function getSearchRequestPromise(videosSearchUrl){return PlayJSONWebservice.getResource(videosSearchUrl).get().$promise}function saveNextPageUrl(result){return nextPageUrl=result.nextPageUrl,result}}}angular.module("srg-play.features").factory("audiosSearchRequestServiceFactory",audiosSearchRequestServiceFactory),audiosSearchRequestServiceFactory.$inject=["PlayJSONWebservice","UrlPatternResolver","$q"]}(),function(){function radioShowsSearchRequestService(PlayJSONWebservice,UrlPatternResolver){return{request:function(showsSearchRequestConfig){return requestConfig=showsSearchRequestConfig,showsSearchUrl=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.RADIO_SHOWS_SEARCH,requestConfig),PlayJSONWebservice.getResource(showsSearchUrl).get().$promise;var showsSearchUrl;var requestConfig}}}angular.module("srg-play.features").factory("radioShowsSearchRequestService",radioShowsSearchRequestService),radioShowsSearchRequestService.$inject=["PlayJSONWebservice","UrlPatternResolver"]}(),function(){function tvShowsSearchRequestService(PlayJSONWebservice,UrlPatternResolver){return{request:function(showsSearchRequestConfig){return requestConfig=showsSearchRequestConfig,showsSearchUrl=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.TV_SHOWS_SEARCH,requestConfig),PlayJSONWebservice.getResource(showsSearchUrl).get().$promise;var showsSearchUrl;var requestConfig}}}angular.module("srg-play.features").factory("tvShowsSearchRequestService",tvShowsSearchRequestService),tvShowsSearchRequestService.$inject=["PlayJSONWebservice","UrlPatternResolver"]}(),function(){function videosSearchRequestServiceFactory(PlayJSONWebservice,UrlPatternResolver,$q){return function(){var nextPageUrl;return{requestFirstPage:function(showsSearchRequestConfig){return getSearchRequestPromise((requestConfig=showsSearchRequestConfig,UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.VIDEOS_SEARCH,requestConfig))).then(saveNextPageUrl);var requestConfig},requestNextPage:function(){return nextPageUrl?getSearchRequestPromise(nextPageUrl).then(saveNextPageUrl):$q.reject("no first page request was made or there are no more pages")}};function getSearchRequestPromise(videosSearchUrl){return PlayJSONWebservice.getResource(videosSearchUrl).get().$promise}function saveNextPageUrl(result){return nextPageUrl=result.nextPageUrl,result}}}angular.module("srg-play.features").factory("videosSearchRequestServiceFactory",videosSearchRequestServiceFactory),videosSearchRequestServiceFactory.$inject=["PlayJSONWebservice","UrlPatternResolver","$q"]}(),function(){function srgPlayConfig($locationProvider){browserSupport.supportsHistoryApi&&($locationProvider.html5Mode(!0),$locationProvider.hashPrefix(""))}angular.module("srg-play.features").config(srgPlayConfig),srgPlayConfig.$inject=["$locationProvider"]}(),function(){function clickOutsideDirective($document){return{restrict:"A",scope:{clickOutside:"&"},link:function(scope,el,attr){$document.on("click",function(e){el===e.target||el[0].contains(e.target)||function(e){try{var targetHasClass=function(className){return e.target.classList.contains(className)};return targetHasClass("ui-icon")||targetHasClass("ui-datepicker-next")||targetHasClass("ui-datepicker-prev")}catch(e){return!1}}(e)||scope.$apply(function(){scope.$eval(scope.clickOutside)})})}}}angular.module("srg-play.features").directive("clickOutside",clickOutsideDirective),clickOutsideDirective.$inject=["$document"]}(),function(){function focusInputOnSearchToggle(event){var target=event.target;target.classList.contains("iconImgClose")&&(target=target.parentNode),target.classList.contains("toggleSearch")&&target.classList.contains("active")&&(document.querySelector(".searchFlyout__form").parentNode.classList.remove("ng-hide"),document.querySelector(".searchFlyout__input").focus())}function focusDateInputOnCalendarButtonClick(event){"showsFlyout-calendarButton"===event.target.id&&document.querySelector(".showsFlyout__byDateButtons .dateSelector__input").focus()}window.customListeners={focusInputOnSearchToggle:focusInputOnSearchToggle,focusDateInputOnCalendarButtonClick:focusDateInputOnCalendarButtonClick,init:function(){document.addEventListener("click",focusInputOnSearchToggle),document.addEventListener("click",focusDateInputOnCalendarButtonClick)}},customListeners.init()}(),function(){function localHistory(_,localStoreFactory,PersonalizationSettings){return function(config){var store;return{add:function(entry){return _.ifElse(shouldHistoryEntryBeSaved,addToHistory,_.F)(entry)},get:getHistory,getEntry:function(id){return _.pipe(getHistory,findEntryById(id))()},clean:function(){getStore().history=[]}};function shouldHistoryEntryBeSaved(entry){return PersonalizationSettings.isPersonalizationActive()&&config.entryValidator(entry)}function addToHistory(entry){return _.pipe(getHistory,_.defaultTo([]),_.ifElse(function(entry){return findEntryById(entry.id)}(entry),function(entry){return function(historyList){var index=_.findIndex(_.propEq("id",entry.id),historyList);return _.update(index,entry,historyList)}}(entry),function(entry){return _.prepend(entry)}(entry)),_.sortBy(_.prop("ts")),_.reverse,_.take(config.maxSavedEntries),_.map(config.propertyPicker),setHistory,_.T)()}function findEntryById(id){return _.find(_.propEq("id",id))}function getHistory(){var store=getStore();return store.history}function setHistory(newHistory){var store=getStore();return store.history=newHistory,store.history}function getStore(){return store||((store=localStoreFactory.getStoreEntry(config.localStoreKey)).history=store.history||[]),store}}}angular.module("srg-play.features").factory("localHistory",localHistory),localHistory.$inject=["_","localStoreFactory","PersonalizationSettings"]}(),function(){angular.module("srg-play.features").factory("escapeHtml",function(){return function(string){return string?string.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}})}(),function(){angular.module("srg-play.features").component("srgOpenInPopup",{template:'<button ng-if="::$ctrl.episode.popupUrl" \n                    ng-click="$ctrl.openInPopUp($ctrl.episode.popupUrl)"\n                    title="{{ ::$ctrl.episode.popupText }}"\n                    tabindex="0">\n               <i class="icon-open-in-new"></i>\n            </button>',bindings:{episode:"<"},controller:["OpenUrlInPopUpService",function(OpenUrlInPopUpService){var vm=this;vm.openInPopUp=function(){return OpenUrlInPopUpService.openCentered(vm.episode.popupUrl,624,351)}}]})}(),angular.module("srg-play.features").service("OpenUrlInPopUpService",["$","$window",function($,$window){this.openCentered=function(url,widthInPx,heightInPx,createNew,name){"Safari"===(-1!==$window.navigator.userAgent.indexOf("MSIE")?"MSIE":-1!==$window.navigator.userAgent.indexOf("Firefox")?"Firefox":-1!==$window.navigator.userAgent.indexOf("Opera")?"Opera":-1!==$window.navigator.userAgent.indexOf("Chrome")?"Chrome":-1!==$window.navigator.userAgent.indexOf("Safari")?"Safari":void 0)&&(heightInPx+=20),void 0===createNew&&(createNew=!0),$.popupWindow(url,{width:widthInPx,height:heightInPx,status:"yes",scrollbars:"no",resizable:"no",createNew:createNew,name:name})}}]),function(){function popupLink(OpenUrlInPopUpService){return{restrict:"A",scope:{popupUrl:"@",popupWidth:"=",popupHeight:"=",createNewPopup:"@",popupName:"@"},link:function(scope,element){element.bind("click",function(){"true"===scope.createNewPopup&&OpenUrlInPopUpService.openCentered(scope.popupUrl,scope.popupWidth,scope.popupHeight,"true"===scope.createNewPopup,scope.popupName);return!1}),scope.createNewPopup=angular.isUndefined(scope.createNewPopup)?"true":scope.createNewPopup}}}popupLink.$inject=["OpenUrlInPopUpService"],angular.module("srg-play.features").directive("popupLink",popupLink)}(),angular.module("srg-play.features").directive("srgPreventDefault",function(){return{restrict:"A",link:function(scope,elem){elem.on("click",function(e){e.preventDefault()})}}}),function(){function scrollIntoView($timeout,$window,angularElement){return{restrict:"A",scope:{scrollIntoViewDelay:"@?",scrollIntoViewDuration:"@?",scrollIntoViewCondition:"&?"},link:function(scope,element,attrs){var defaultAnimationDelay=0,defaultAnimationDuration=750,windowElement=angularElement($window),scrollTarget=$(attrs.scrollIntoView);scrollTarget.length&&element.on("click",function(){$timeout(function(){var fold,elementBottom,el,topOfElement,bottomOfElement,topOfScreen;angular.isDefined(scope.scrollIntoViewCondition)&&!scope.scrollIntoViewCondition()||(topOfElement=(el=scrollTarget).offset().top,bottomOfElement=topOfElement+el.outerHeight(),(topOfScreen=windowElement.scrollTop())+windowElement.height()>bottomOfElement&&topOfScreen<topOfElement)||$("html, body").animate({scrollTop:(fold=windowElement.scrollTop()+windowElement.height(),elementBottom=scrollTarget.offset().top+scrollTarget.outerHeight(),windowElement.scrollTop()-(fold-elementBottom))},parseInt(scope.scrollIntoViewDuration,10)||defaultAnimationDuration)},parseInt(scope.scrollIntoViewDelay,10)||defaultAnimationDelay)})}}}angular.module("srg-play.features").directive("scrollIntoView",scrollIntoView),scrollIntoView.$inject=["$timeout","$window","angularElement"]}(),function(){angular.module("srg-play.features").directive("slideUp",function(){return{restrict:"A",link:function(scope,element,attrs){$(attrs.slideOnClickOnElement).on("click",function(){element.slideUp(attrs.slideUp)})}}})}(),function(){function styleWithScope($compile){return{restrict:"A",link:function(scope,element){if(element.html()){var template=$compile("<style>"+element.html()+"</style>");element.replaceWith(template(scope))}}}}angular.module("srg-play.features").directive("styleWithScope",styleWithScope),styleWithScope.$inject=["$compile"]}(),function(){function currentSegment(SRGConfig,UrnIdExtractor,SeoStringGenerator,$state,$stateRegistry,_){var playerContext,urnIdExtractor=new UrnIdExtractor,seoStringGenerator=new SeoStringGenerator,videoUrlState=$stateRegistry.get("tvVideoDetailPage"),radioVideoUrlState=$stateRegistry.get("radioVideoDetailPage"),audioUrlState=$stateRegistry.get("radioAudioDetailPage"),segment={urn:"",assetId:"",title:"",showTitle:"",lead:"",description:"",leadAndDescription:"",isFullLength:!1,isPlayBackContextFullLength:!1,url:"",urlRelative:"",fullLength:{},relatedInformation:[],eventData:""};return segment.update=function(newMetadata){if(!newMetadata)return this;return this.urn=newMetadata.urn||"",this.isVideo=isVideo(newMetadata.urn),this.urlState=getDetailUrlStateForSegment(playerContext,this),this.assetId=urnIdExtractor.extractIdFromUrn(newMetadata.urn)||"",this.showTitle=newMetadata.showTitle||"",this.title=newMetadata.title||"",this.lead=newMetadata.lead||"",this.description=newMetadata.description||"",this.leadAndDescription="".concat(this.lead," ").concat(this.description).replace(/(\r\n|\r|\n)/g,"<br/>"),this.urlParams=getUrlParamsForDetailUrl(segment,this.fullLength),this.url=getDetailUrlAbsolute(this)||"",this.urlRelative=getDetailUrl(this)||"",this.relatedInformation=newMetadata.related||[],this.isFullLength=(currentSegment=segment,currentSegment.fullLength&&currentSegment.urn===currentSegment.fullLength.urn),this.eventData=newMetadata.eventData||"",this;var currentSegment}.bind(segment),segment.setFullLength=function(fullLength){if(!fullLength)return this;return this.fullLength=fullLength,this.fullLength.assetId=urnIdExtractor.extractIdFromUrn(fullLength.urn),this.fullLength.showTitle=fullLength.showTitle,this.fullLength.isVideo=isVideo(fullLength.urn),this.urlState=getDetailUrlStateForSegment(playerContext,this),this.fullLength.urlParams=getUrlParamsForDetailUrl(fullLength,fullLength),this.fullLength.url=getDetailUrlAbsolute(fullLength),this}.bind(segment),segment.setPlayerContext=function(context){if(!context)return;playerContext={isTvVideo:context.isTvVideo,isRadioAudio:context.isRadioAudio,isRadioVideo:context.isRadioVideo}},segment.deepClone=function(){var clonedFullLength=_.clone(segment.fullLength),clonedSegment=_.clone(segment);return clonedSegment.fullLength=clonedFullLength,clonedSegment},segment.reset=function(){segment.urn="",segment.assetId="",segment.title="",segment.showTitle="",segment.lead="",segment.description="",segment.leadAndDescription="",segment.isFullLength=!1,segment.isPlayBackContextFullLength=!1,segment.url="",segment.urlRelative="",segment.urlParams={},segment.fullLength={},segment.relatedInformation=[],segment.eventData=""},segment;function getDetailUrlStateForSegment(context,segment){if(context&&segment){var videoInTvContext=segment.isVideo&&context.isTvVideo,videoInRadioContext=segment.isVideo&&context.isRadioVideo;return videoInTvContext&&videoUrlState?videoUrlState:videoInRadioContext&&radioVideoUrlState?radioVideoUrlState:audioUrlState||void 0}}function isVideo(urn){return urn?urn.indexOf("video")>-1:void 0}function getDetailUrl(segment){var detailState=getDetailUrlStateForSegment(playerContext,segment);return detailState?$state.href(detailState,segment.urlParams):""}function getDetailUrlAbsolute(segment){return SRGConfig.baseHref+getDetailUrl(segment)}function getUrlParamsForDetailUrl(segment,fullLength){return{id:segment.assetId,title:seoStringGenerator.getSeoString(segment.title),showTitle:seoStringGenerator.getSeoString(fullLength.showTitle)}}}angular.module("srg-play.features").factory("currentSegment",currentSegment),currentSegment.$inject=["SRGConfig","UrnIdExtractor","SeoStringGenerator","$state","$stateRegistry","_"]}(),function(){function segments(_,currentSegment){var onSegmentChangedObservers=[],isFullLengthBlocked=!1;return{onSegmentChanged:function(callback){onSegmentChangedObservers=_.append(callback,onSegmentChangedObservers)},technicalPlayerSegmentsLoadedHook:function(segments,fullLength,isPlayBackContextFullLength,initalAsset){segments=segments||[],initalAsset=initalAsset||{},isFullLengthBlocked=!!fullLength&&fullLength.isBlocked,currentSegment.setFullLength(fullLength),currentSegment.update(initalAsset),currentSegment.isPlayBackContextFullLength=isPlayBackContextFullLength,notifySegmentChangeObserver(currentSegment)},technicalPlayerSegmentChangedHook:function(newSegment){if(newSegment.urn===currentSegment.urn)return;currentSegment.update(newSegment),currentSegment.isPlayBackContextFullLength=!0!==isFullLengthBlocked,notifySegmentChangeObserver(currentSegment)}};function notifySegmentChangeObserver(currentSegment){_.forEach(function(callback){callback(currentSegment.deepClone())},onSegmentChangedObservers)}}angular.module("srg-play.features").factory("segments",segments),segments.$inject=["_","currentSegment"]}(),function(){function TechnicalPlayerController($scope,$timeout,debounce,$stateRegistry,$document,$attrs,$location,SRGConfig,technicalPlayerService,userHistoryTracker,videoHistory,segments,currentSegment,browserSupport,userId,PersonalizationSettings,maRtsInfo,chartbeatService){var playerContext={isTvVideo:"video"===$attrs.type,isRadioAudio:"audio"===$attrs.type,isRadioVideo:"radioVideo"===$attrs.type};function resizePlayerForSegmentSlider(event){var segmentsAvailable=event.data;$scope.cssClassForPlayerContainer.withSegments=segmentsAvailable,$scope.cssClassForPlayerContainer.withoutSegments=!segmentsAvailable}function handleSegmentChange(segment){$scope.$apply(function(){$scope.currentMetadata=segment,function(segment){if("false"===$attrs.locationUpdate||playerContext.isRadioAudio||!browserSupport.supportsHistoryApi)return;var detailState=$stateRegistry.get(segment.urlState.name);detailState&&$stateRegistry.deregister(detailState);$location.search().id!==segment.assetId&&segment.urlRelative&&$location.url(segment.urlRelative).replace();$timeout(function(){$stateRegistry.register(detailState)},200)}(segment),function(segment){chartbeatService.trackVirtualPageChange(segment.title+" - "+$document[0].title)}($scope.currentMetadata)})}function isTrackingActive(){var trackingEnabled="true"===$attrs.shouldTrackHistory,trackingEnabledByUser=PersonalizationSettings.isPersonalizationActive();return playerContext.isTvVideo&&trackingEnabled&&trackingEnabledByUser}function continuePlaybackAtStoredPosition(){technicalPlayerService.getMetadata(function(metadata){videoHistory.getEntry(metadata.id).then(function(historyEntry){historyEntry&&historyEntry.position&&technicalPlayerService.seek(historyEntry.position)})})}!function(){try{currentSegment.reset(),currentSegment.setPlayerContext(playerContext),$scope.currentMetadata=currentSegment,$scope.currentMetadata.lead=$attrs.leadText,$scope.playSegment=technicalPlayerService.loadUsingUrn.bind(technicalPlayerService),$scope.cssClassForPlayerContainer={withoutSegments:!0},function(){var options={playerId:"srg_player_technical_player",onSegmentsLoaded:segments.technicalPlayerSegmentsLoadedHook};isTrackingActive()&&(options.userId=userId.get());technicalPlayerService.init(options,$attrs.leadText),technicalPlayerService.onMediaSeekable(continuePlaybackAtStoredPosition),technicalPlayerService.registerSegmentChangeCallbacks(segments.technicalPlayerSegmentChangedHook),technicalPlayerService.whenPlayerHasSegments(resizePlayerForSegmentSlider),segments.onSegmentChanged(debounce(handleSegmentChange,1e3,!1)),isTrackingActive()&&userHistoryTracker.startTracking()}()}catch(error){console.error("Could not initialize the technical player",error)}$scope.$on("$locationChangeSuccess",function(){$timeout(function(){currentSegment.update(technicalPlayerService.getSegmentMetadata(currentSegment.urn))},100)}),$scope.$on("$destroy",function(){isTrackingActive()&&userHistoryTracker.stopTracking()})}()}angular.module("srg-play.features").controller("TechnicalPlayerController",TechnicalPlayerController),TechnicalPlayerController.$inject=["$scope","$timeout","debounce","$stateRegistry","$document","$attrs","$location","SRGConfig","technicalPlayerService","userHistoryTracker","videoHistory","segments","currentSegment","browserSupport","userId","PersonalizationSettings","maRtsInfo","chartbeatService"]}(),function(){function technicalPlayerService(trackingPayloadGenerator){if("undefined"==typeof SRG)return{};var playerApiEvents={loaded:SRG.SrgPlayerEvent.EVT_LOADED,mediaSeekable:SRG.SrgPlayerEvent.EVT_MEDIA_SEEKABLE,playing:SRG.SrgPlayerEvent.EVT_PLAYING,paused:SRG.SrgPlayerEvent.EVT_PAUSED,stopped:SRG.SrgPlayerEvent.EVT_STOPPED,ended:SRG.SrgPlayerEvent.EVT_ENDED,seeking:SRG.SrgPlayerEvent.EVT_SEEKING_CHANGE,timeUpdate:SRG.SrgPlayerEvent.EVT_TIME_UPDATE,segmentChange:SRG.SrgPlayerEvent.EVT_SEGMENT_CHANGE},idCache=[];return SRG.PlayerManager.addGlobalEventListener(playerApiEvents.playing,function(evt){try{if("undefined"==typeof require)return;require(["app/app-history"],function(){var id=new SRG.URN(evt.data.urn).getId();-1==idCache.indexOf(id)&&(AddHistory(id),idCache.push(id))})}catch(unhandled){}}),{player:null,segments:[],fullLengthSegment:null,init:function(options,leadText){if(this.player=SRG.PlayerManager.getPlayer(options.playerId),this.player&&options.onSegmentsLoaded){var $self=this;this.player.getMetadata(function(data){data.lead=leadText,$self.initIncomingMetadata(data,options)})}},initIncomingMetadata:function(data,options){var $self=this;$self.requestedAsset=data,$self.fullLengthSegment=data.fullSegment||{},$self.segments=data.segments||[],function(data){return data.segments&&0===data.segments.length&&void 0===data.fullSegment&&!1===data.isFull}(data)&&function(data){data.isFull=!0,$self.fullLengthSegment=data}(data),$self.fullLengthSegment&&$self.segments.unshift($self.fullLengthSegment),$self.fullLengthSegment.showTitle=$self.requestedAsset.showTitle,options.onSegmentsLoaded($self.segments,$self.fullLengthSegment,data.isFull,$self.requestedAsset),function(player,options){if(!options)return;var payload=trackingPayloadGenerator.addAssetDataToPayload(payload)||{};options.userId&&(payload.userId=options.userId);player.setSocialDataPayload(payload)}($self.player,options)},registerSegmentChangeCallbacks:function(segmentChangeCallback){if(this.player){var $self=this;this.player.addEventListener(playerApiEvents.segmentChange,function(evt){if(-1!=evt.data&&segmentChangeCallback){var segment=$self.getSegmentMetadata(evt.data);segment&&segmentChangeCallback(segment)}else $self.fullLengthSegment&&segmentChangeCallback&&segmentChangeCallback($self.fullLengthSegment)})}},registerTimeUpdateCallback:function(callback){this.player&&(this.timeChangeCallback=function(evt){callback(Math.floor(evt.data.seconds))},this.timeChangeBySeekCallback=function(evt){!evt.data.seeking&&callback(Math.floor(evt.data.time))},this.player.addEventListener(playerApiEvents.timeUpdate,this.timeChangeCallback),this.player.addEventListener(playerApiEvents.seeking,this.timeChangeBySeekCallback))},whenPlayerHasSegments:function(callback){this.player.hasSegments(function(hasSegments){if(hasSegments){callback({data:!0})}})},unregisterTimeChangeCallback:function(){this.player.removeEventListener(playerApiEvents.timeUpdate,this.timeChangeCallback),this.player.removeEventListener(playerApiEvents.seeking,this.timeChangeBySeekCallback)},getSegmentMetadata:function(urn){for(var i=0;i<this.segments.length;i++)if(this.segments[i].urn==urn)return this.segments[i]},play:function(){this.player.play()},pause:function(){this.player.pause()},stop:function(){this.player.stop()},getCurrentTime:function(callbackFunction){this.player.getCurrentTime(function(timeInMillis){callbackFunction(Math.floor(timeInMillis))})},getMetadata:function(callbackFunction){this.player.getMetadata(function(metadata){callbackFunction(metadata)})},seek:function(time){this.player.seek(time)},seekToAbsoluteTime:function(time,offset){this.player.seekToAbsoluteTime(time,offset)},load:function(id,bu,type){this.player.load("urn:"+bu+":"+type+":"+id)},loadUsingUrn:function(urn){this.player.load(urn)},addEventListener:function(event,callbackFunction){this.player.addEventListener(event,callbackFunction)},onPlay:function(callbackFunction){var $self=this;this.addEventListener(playerApiEvents.playing,function(){$self.getMetadata(callbackFunction)})},onPause:function(callbackFunction){this.addEventListener(playerApiEvents.paused,function(){callbackFunction()})},onEnd:function(callbackFunction){this.addEventListener(playerApiEvents.ended,callbackFunction)},onStop:function(callbackFunction){this.addEventListener(playerApiEvents.stopped,callbackFunction)},onMediaSeekable:function(callbackFunction){this.addEventListener(playerApiEvents.mediaSeekable,callbackFunction)},onSeek:function(callbackFunction){this.addEventListener(playerApiEvents.seeking,function(event){event.data.seeking&&callbackFunction()})},afterSeek:function(callbackFunction){var $self=this;this.addEventListener(playerApiEvents.seeking,function(event){!event.data.seeking&&$self.getMetadata(callbackFunction)})}}}angular.module("srg-play.features").factory("technicalPlayerService",technicalPlayerService),technicalPlayerService.$inject=["trackingPayloadGenerator"]}(),function(){function watchTimeObserver(_,$interval,technicalPlayerService){var playerState,$intervalFunction,PLAYER_STATE_PAUSED="paused",PLAYER_STATE_PLAYING="playing",combinedWatchTime=0,watchTimeUpdateCallbacks=[];return{onWatchTimeUpdate:function(callback){watchTimeUpdateCallbacks=_.append(callback,watchTimeUpdateCallbacks)},setupTechnicalPlayerEventCallbacks:function(){technicalPlayerService.onPlay(_.pipe(getWatchTimeTrackingInterval(3e3),setPlayerStateToPlaying)),technicalPlayerService.onPause(_.pipe(stopWatchTimeTrackingInterval,setPlayerStateToPaused)),technicalPlayerService.onStop(stopWatchTimeTrackingInterval),technicalPlayerService.onEnd(stopWatchTimeTrackingInterval),technicalPlayerService.onSeek(stopWatchTimeTrackingInterval),technicalPlayerService.afterSeek(_.ifElse(isPlayerPlaying,getWatchTimeTrackingInterval(3e3),_.F))},reset:function(){stopWatchTimeTrackingInterval(),playerState=void 0,combinedWatchTime=0,watchTimeUpdateCallbacks=[]}};function getWatchTimeTrackingInterval($intervalInMillis){return function(videoMetadata){stopWatchTimeTrackingInterval(),$intervalFunction=$interval(function(){technicalPlayerService.getCurrentTime(function(currentTimeInSeconds){videoMetadata.currentTimeInSeconds=currentTimeInSeconds,combinedWatchTime=combinedWatchTime+$intervalInMillis/1e3,_.pipe(watchTimeTrackingInfoFromVideoMetadata,callTimeUpdateCallbacks)(videoMetadata)})},$intervalInMillis)}}function watchTimeTrackingInfoFromVideoMetadata(videoMetadata){var filterMetadata=_.pick(["id","duration","eventData","currentTimeInSeconds"]),roundDuration=_.over(_.lensProp("duration"),Math.round),addWatchedTime=_.set(_.lensProp("watched"),combinedWatchTime);return _.pipe(filterMetadata,roundDuration,addWatchedTime)(videoMetadata)}function callTimeUpdateCallbacks(trackingInfo){watchTimeUpdateCallbacks.map(function(cb){cb(trackingInfo)})}function stopWatchTimeTrackingInterval(){$intervalFunction&&$interval.cancel($intervalFunction)}function setPlayerStateToPlaying(){playerState=PLAYER_STATE_PLAYING}function setPlayerStateToPaused(){playerState=PLAYER_STATE_PAUSED}function isPlayerPlaying(){return playerState===PLAYER_STATE_PLAYING}}angular.module("srg-play.features").service("watchTimeObserver",watchTimeObserver),watchTimeObserver.$inject=["_","$interval","technicalPlayerService"]}(),angular.module("srg-play.features").directive("hideForTouch",function(){return{restrict:"A",link:function(scope,element){Modernizr.touch&&element.remove()}}}),angular.module("srg-play.features").directive("showForTouch",function(){return{restrict:"A",link:function(scope,element){Modernizr.touch||element.remove()}}}),function(){function touchstart($parse,$rootScope,$exceptionHandler){return{restrict:"A",compile:function($element,attr){var targetFunction=$parse(attr.srgTouchstart);return function(scope,element){element.on("touchstart  ",function(event){var callback=function(){targetFunction(scope,{$event:event})};if($rootScope.$$phase)try{callback()}catch(error){$exceptionHandler(error)}else scope.$apply(callback)})}}}}angular.module("srg-play.features").directive("srgTouchstart",touchstart),touchstart.$inject=["$parse","$rootScope","$exceptionHandler"]}(),function(){function translator(_){var translations={};return{add:function(values){values&&(translations=_.merge(translations,values))},translate:function(key){return translations[key]||key}}}angular.module("srg-play.features").factory("translator",translator),translator.$inject=["_"]}(),function(){function viewPorts(_,$window){var viewPortTypes,self={};function registerCallbackForMediaQuery(type,callback,initialCallback){if(window.matchMedia){isViewportActive(type)&&(initialCallback=initialCallback||callback)(type);var viewPortType,mediaQuery=(viewPortType=type,self.viewPortMediaQueries[viewPortType]);mediaQuery.addListener(function(mediaQuery,viewPortType,callback){return function(){setTimeout(function(){mediaQuery.matches&&callback(viewPortType)},1)}}(mediaQuery,type,callback))}}function isViewportActive(viewPortType){return self.viewPortMediaQueries[viewPortType].matches}function buildMediaQuery(viewPortType){return $window.matchMedia(Foundation.media_queries[function(viewPortType){return viewPortType===self.XLARGE_TYPE?viewPortType:viewPortType+self.VIEWPORT_ONLY_EXTENSION}(viewPortType)])}return self.SMALL_TYPE="small",self.MEDIUM_TYPE="medium",self.LARGE_TYPE="large",self.XLARGE_TYPE="xlarge",self.VIEWPORT_ONLY_EXTENSION="-only",self.viewPorts=[self.SMALL_TYPE,self.MEDIUM_TYPE,self.LARGE_TYPE,self.XLARGE_TYPE],self.viewPortMediaQueries=self.viewPortMediaQueries||_.zipObj(self.viewPorts,(viewPortTypes=self.viewPorts,_.map(buildMediaQuery,viewPortTypes))),self.callbackForSmall=function(callback,initialCallback){registerCallbackForMediaQuery(self.SMALL_TYPE,callback,initialCallback)},self.callbackForMedium=function(callback,initialCallback){registerCallbackForMediaQuery(self.MEDIUM_TYPE,callback,initialCallback)},self.callbackForLarge=function(callback,initialCallback){registerCallbackForMediaQuery(self.LARGE_TYPE,callback,initialCallback)},self.callbackForXLarge=function(callback,initialCallback){registerCallbackForMediaQuery(self.XLARGE_TYPE,callback,initialCallback)},self.callbackForAny=function(callback,initialCallback){self.callbackForSmall(callback,initialCallback),self.callbackForMedium(callback,initialCallback),self.callbackForLarge(callback,initialCallback),self.callbackForXLarge(callback,initialCallback)},self.getCurrent=function(){var activeViewport;return _.forEach(function(viewPortType){isViewportActive(viewPortType)&&(activeViewport=viewPortType)},self.viewPorts),activeViewport},self}angular.module("srg-play.features").factory("viewPorts",viewPorts),viewPorts.$inject=["_","$window"]}(),function(){function indexChangeService(_){var indexChangeCallbacks=[],notifyCallback=_.curry(function(indexLetter,callback){callback(_.clone(indexLetter))});this.changeIndex=function(indexLetter){_.map(notifyCallback(indexLetter),indexChangeCallbacks)},this.registerIndexChangeCallback=function(callback){indexChangeCallbacks.push(callback)}}angular.module("srg-play.features").service("indexChangeService",indexChangeService),indexChangeService.$inject=["_"]}(),function(){function AtoZIndexService($location,_){return function(aToZGroups){aToZGroups=aToZGroups||[];var index,groups,indexes,numericIndexesOf,allIndexes,validateGroupProperty=function(prop){return prop&&prop.length>0},indexesOf=_.pipe(_.filter(function(group){return validateGroupProperty(group.id)&&validateGroupProperty(group.title)}),_.map(function(groupOfShows){var indexItem=_.pick(["id","title"],groupOfShows);return indexItem.cssClass=groupOfShows.containsShows?"active":"",indexItem})),reduceIndexesToChunk=_.reduce(function(chunk,index){return(chunk=chunk||{id:"",title:"",cssClass:""}).id+=index.id,chunk.title+=index.title,"active"===index.cssClass&&(chunk.cssClass=index.cssClass),chunk},null);return{INDEX_ALL:"all",INDEX_ACTIVE:"active",INDEX_SELECTED:"selected",fullIndexList:indexesOf(aToZGroups),chunkedIndexList:(groups=aToZGroups,allIndexes=indexesOf(groups),_.prepend((indexes=allIndexes,numericIndexesOf=_.slice(0,1),_.pipe(numericIndexesOf,reduceIndexesToChunk)(indexes)),function(indexes){var chunkedAlphaIndexes,alphaIndexes=_.remove(0,1,indexes),makeTriplets=_.splitEvery(3);return chunkedAlphaIndexes=26===alphaIndexes.length?function(indexes){var quadsFromLast8=_.pipe(_.takeLast(8),_.splitEvery(4)),tripplesFromFirst18=_.pipe(_.take(18),makeTriplets);return _.concat(tripplesFromFirst18(indexes),quadsFromLast8(indexes))}(alphaIndexes):function(indexes){return makeTriplets(indexes)}(alphaIndexes),_.map(reduceIndexesToChunk,chunkedAlphaIndexes)}(allIndexes))),currentIndex:(index=$location.search().index,index||"all"),changeCurrentIndex:function(index){index&&($location.search("index",index),this.currentIndex=index)}}}}angular.module("srg-play.features").factory("AtoZIndexService",AtoZIndexService),AtoZIndexService.$inject=["$location","_"]}(),function(){angular.module("srg-play.features").factory("atoZIndexServiceUnchunked",atoZIndexServiceUnchunked),atoZIndexServiceUnchunked.$inject=["$location","_"];var INDEX_ALL="all",INDEX_ACTIVE="active",INDEX_SELECTED="selected";function atoZIndexServiceUnchunked($location,_){return function(aToZGroups,indexAllTitle){aToZGroups=aToZGroups||[];var indexService={INDEX_ALL:INDEX_ALL,INDEX_ACTIVE:INDEX_ACTIVE,INDEX_SELECTED:INDEX_SELECTED,currentIndex:$location.search().index||INDEX_ALL,changeCurrentIndex:function(index){if(!index)return;$location.search("index",index),indexService.currentIndex=index,indexService.fullIndexList=generateIndexes(aToZGroups)}};return indexService.fullIndexList=generateIndexes(aToZGroups),indexService;function generateIndexes(aToZGroups){var indexList=aToZGroups.filter(isGroupValid).map(groupToIndexItem);if(indexAllTitle){var indexAll={id:INDEX_ALL,title:indexAllTitle,isActive:!0};indexAll.isCurrent=INDEX_ALL===indexService.currentIndex,indexList.unshift(indexAll)}return indexList}function isGroupValid(group){return group.id&&group.title}function groupToIndexItem(groupOfShows){var indexItem=_.pick(["id","title"],groupOfShows);return indexItem.isActive=!0===groupOfShows.hasShows,indexItem.isCurrent=groupOfShows.id===indexService.currentIndex,indexItem}}}}(),function(){function moduleAbTest(_,localStoreFactory,localStoreKeys,viewPorts){var nameAttr="name",aVariantTagName="a-variant",bVariantTagName="b-variant";return{compile:function(element,attributes){var aVariant=element.find(aVariantTagName),aVariantExists=aVariant.length,bVariant=element.find(bVariantTagName);if(bVariant.length&&aVariantExists){var choosenVariantName,localStoreEntry=localStoreFactory.getStoreEntry(localStoreKeys.abTests),abTestName=element.attr(nameAttr),abTestEntry=localStoreEntry[abTestName];abTestEntry&&abTestEntry.selection?choosenVariantName=function(storedVariantName,aVariant,bVariant){return bVariant.attr(nameAttr)===storedVariantName?(aVariant.remove(),bVariant):(bVariant.remove(),aVariant)}(abTestEntry.selection,aVariant,bVariant).attr(nameAttr):(choosenVariantName=function(aVariant,bVariant){var aVariantChance=aVariant.attr("srg-abtest-chance")||.5;return Math.random()<aVariantChance?(bVariant.remove(),aVariant):(aVariant.remove(),bVariant)}(aVariant,bVariant).attr(nameAttr),localStoreEntry[abTestName]={selection:choosenVariantName}),element.addClass(choosenVariantName)}return function(scope,element,attributes){}},restrict:"E"}}angular.module("srg-play.features").directive("moduleAbTest",moduleAbTest),moduleAbTest.$inject=["_","localStoreFactory","localStoreKeys","viewPorts"]}(),function(){function GetRequestService($http){return function(url,successCallback,config){if(!successCallback)return $http.get(url,config||{});$http.get(url,config||{}).then(function(response){successCallback(response.data)}).catch(function(response){})}}angular.module("srg-play.features").service("GetRequestService",GetRequestService),GetRequestService.$inject=["$http"]}(),function(){function postRequestService($http){return function(url,data,config,successCallback){$http.post(url,data,config).then(function(response){successCallback&&successCallback(response)}).catch(function(response){})}}angular.module("srg-play.features").factory("postRequestService",postRequestService),postRequestService.$inject=["$http"]}(),function(){function PlayJSONWebservice($resource){return{getResource:function(url,parameter,config){parameter=parameter||{};var useCache=!0;!1===(config=config||{}).cache&&(useCache=!1);return $resource(url,void 0,{get:{method:"GET",params:parameter,isArray:config.isArrayResponse,cache:useCache}})}}}angular.module("srg-play.features").factory("PlayJSONWebservice",PlayJSONWebservice),PlayJSONWebservice.$inject=["$resource"]}(),function(){function bootstrap($document,storingJanitor){return{restrict:"A",link:function(){storingJanitor.cleanup(),$document.foundation()}}}angular.module("srg-play.features").directive("srgInit",bootstrap),bootstrap.$inject=["$document","storingJanitor"]}(),function(){function radioStationChoiceService($location,$rootScope,SRGConfig,CookieStore){var stationStore,callbacks,currentStation;return function(){callbacks=[],stationStore=new CookieStore("station"),updateCookieFromUrl();var storedStation=stationStore.getCookieValue();str=storedStation,currentStation="string"==typeof str&&str.length>0&&isValidStationId(storedStation)?storedStation:SRGConfig.radioPortal.defaultStationId;var str;stationStore.saveCookieValue(currentStation),$rootScope.$on("$locationChangeStart",updateCookieFromUrl)}(),{changeRadioStation:changeRadioStation,registerCallback:function(callback){callbacks.push(callback)},getCurrentStation:function(){return currentStation},getCurrentStationInfo:function(){return SRGConfig.radioPortal.channels.filter(function(channel){return channel.id===currentStation})[0]}};function updateCookieFromUrl(){var params=$location.search();params&&params.station&&changeRadioStation(params.station)}function changeRadioStation(id){isValidStationId(id)&&currentStation!==id&&(currentStation=id,stationStore.saveCookieValue(id),callbacks.forEach(function(callback){"function"==typeof callback&&callback(id)}))}function isValidStationId(id){return 0===SRGConfig.radioPortal.availableChannelIds.length||SRGConfig.radioPortal.availableChannelIds.includes(id)}}angular.module("srg-play.features").factory("radioStationChoiceService",radioStationChoiceService),radioStationChoiceService.$inject=["$location","$rootScope","SRGConfig","CookieStore"]}(),function(){function CookieService($window,$cookies){return{getCookieValue:function(name){return $cookies.get(name)},setCookieValue:function(name,value,daysToExpiration,isGeneralDomain){daysToExpiration=daysToExpiration||365;var expires=new Date;expires.setDate(expires.getDate()+daysToExpiration);var options={expires:expires,path:"/"};isGeneralDomain&&(options.domain=getGeneralDomain());return $cookies.put(name,value,options)},getCookieObject:function(name){return $cookies.getObject(name)},setCookieObject:function(name,object,daysToExpiration,isGeneralDomain){daysToExpiration=daysToExpiration||365;var expires=new Date;expires.setDate(expires.getDate()+daysToExpiration);var options={expires:expires,path:"/"};isGeneralDomain&&(options.domain=getGeneralDomain());return $cookies.putObject(name,object,options)}};function getGeneralDomain(){var url=$window.location.host,hostComponents=url.split(".");return hostComponents.length>2&&(url=hostComponents[hostComponents.length-2]+"."+hostComponents[hostComponents.length-1]),url}}angular.module("srg-play.features").factory("CookieService",CookieService),CookieService.$inject=["$window","$cookies"]}(),function(){angular.module("srg-play.features").filter("ellipsis",function(){return function(text,length){if(text){isNaN(length)&&(length=10);return text.length<=length||text.length-"...".length===length?text:String(text).substring(0,length-"...".length)+"..."}}})}(),function(){angular.module("srg-play.features").filter("externalHtmlText",function(){return function(externalText){if(externalText)return externalText.replace("<","&lt;").replace(">","&gt;").replace(/(\r\n|\r|\n)/g,"<br/>")}})}(),function(){function arrowKeyNavigation(keys,keyCodeValidator,$document){return{restrict:"A",scope:{shouldArrowNavigationBeUsed:"&isUsedWhen",focusable:"@"},link:function(scope,element){var callback;function isCurrentFocusWithin(elementSelection){return focusedElementIndexIn(elementSelection)>=0}function focusedElementIndexIn(elementSelection){return elementSelection.index(angular.element($document[0].activeElement))}function getFocusableElements(){return element.find(scope.focusable)}callback=function(){if(scope.shouldArrowNavigationBeUsed()){var elementToFocus=function(){var focusableElements=getFocusableElements();if(isCurrentFocusWithin(focusableElements)){var nextFocusableIndex=focusedElementIndexIn(focusableElements)+1;return focusableElements.get(nextFocusableIndex)}return focusableElements.get(0)}();elementToFocus&&elementToFocus.focus()}},scope.$on(keys.arrowDownKey.eventName,callback),function(callback){scope.$on(keys.arrowUpKey.eventName,callback)}(function(){if(scope.shouldArrowNavigationBeUsed()){var elementToFocus=function(){var focusableElements=getFocusableElements();if(isCurrentFocusWithin(focusableElements)){var previousFocusableIndex=focusedElementIndexIn(focusableElements)-1;if(previousFocusableIndex>=0)return focusableElements.get(previousFocusableIndex)}}();elementToFocus&&elementToFocus.focus()}}),function(){function isArrowKeyEvent(event){return function(event){return keyCodeValidator.doesEventKeyCodeEqual(keyCodeValidator.ARROW_UP,event)}(event)||function(event){return keyCodeValidator.doesEventKeyCodeEqual(keyCodeValidator.ARROW_DOWN,event)}(event)}$document.on("keydown",function(event){scope.shouldArrowNavigationBeUsed()&&isArrowKeyEvent(event)&&event.preventDefault()})}()}}}angular.module("srg-play.features").directive("arrowKeyNavigation",arrowKeyNavigation),arrowKeyNavigation.$inject=["keys","keyCodeValidator","$document"]}(),function(){function srgFlyoutOnClickOutside($document,$timeout,$transitions,$){return{restrict:"A",link:function(scope,flyoutElement,attr){var flyoutButton;function notifyEventHandlerAboutClickOutsideFlyout(event){(function(event){return isFlyoutVisible()&&(clickTarget=event.target,!($.contains(flyoutButton,clickTarget)||clickTarget===flyoutButton))&&!function(event){return event.originalEvent.withinFlyout}(event);var clickTarget})(event)&&scope.$apply(scope.$eval(attr.srgFlyoutOnClickOutside))}function isFlyoutVisible(){return scope.$eval(attr.srgFlyoutIsVisible)}function closeFlyoutIfVisible(){isFlyoutVisible()&&scope.$eval(attr.srgFlyoutOnClickOutside)}function markClickEventAsWithinFlyout(event){event.originalEvent.withinFlyout=!0}$timeout(function(){flyoutButton=$document.find("#"+attr.srgFlyoutToggleButtonId).get(0),handler=notifyEventHandlerAboutClickOutsideFlyout,$document.on("click",handler),function(handler){flyoutElement.on("click",handler)}(markClickEventAsWithinFlyout),scope.closeFlyout=closeFlyoutIfVisible,"true"!==attr.srgFlyoutKeepOpenOnRouteChange&&(callback=closeFlyoutIfVisible,deregisterHook=$transitions.onSuccess({from:"*"},callback),scope.$on("$destroy",deregisterHook));var callback,deregisterHook;var handler},0)}}}angular.module("srg-play.features").directive("srgFlyoutOnClickOutside",srgFlyoutOnClickOutside),srgFlyoutOnClickOutside.$inject=["$document","$timeout","$transitions","$"]}(),function(){function onEscape(keys,$parse){return{restrict:"A",compile:function(element,attrs){var onEscapeExpression=$parse(attrs.onEscape);return function(scope){!function(scope,callback){scope.$on(keys.escapeKey.eventName,function(){scope.$apply(callback)})}(scope,function(){onEscapeExpression(scope)})}}}}angular.module("srg-play.features").directive("onEscape",onEscape),onEscape.$inject=["keys","$parse"]}(),function(){function hideElementOnScrollDown($window,$document,standardInterval,angularElement){return{link:function(scope,element,attrs){var didScroll,windowElem=angularElement($window),documentElem=angularElement($document),lastVerticalPosition=windowElem.scrollTop(),minimumScrollDelta=parseInt(attrs.srgHideElementOnScrollDown)||200;windowElem.scroll(function(){didScroll=!0}),standardInterval(function(){didScroll&&(!function(){var verticalPosition=windowElem.scrollTop();if(Math.abs(lastVerticalPosition-verticalPosition)<=minimumScrollDelta)return;verticalPosition>lastVerticalPosition?(element.addClass("scroll-down-hide"),element.removeClass("scroll-up-show"),attrs.onScrollDown&&scope.$eval(attrs.onScrollDown)):verticalPosition+windowElem.height()<documentElem.height()&&(element.removeClass("scroll-down-hide"),element.addClass("scroll-up-show"));lastVerticalPosition=verticalPosition}(),didScroll=!1)},250)}}}angular.module("srg-play.features").directive("srgHideElementOnScrollDown",hideElementOnScrollDown),hideElementOnScrollDown.$inject=["$window","$document","standardInterval","angularElement"]}(),function(){function lazyImageInterchange(_,viewPorts,interchangeQueries,$window,$interval,imgSrcUpdateQueue){var currentViewPort,updateShouldBeDone=!1,lazyLoadOptions={offsetTop:-400,offsetBottom:400};return $interval(runUpdateQueue,100),addWindowEventListener("scroll",setUpdateFlagActive),{restrict:"A",scope:{skipLazyLoading:"="},link:function(scope,element,attrs){$window.requestAnimationFrame(function(){function queueImageSrcUpdate(){var callback;callback=function(){updateImageSrc(currentViewPort)},imgSrcUpdateQueue.push(callback)}function updateImageSrc(viewPort){$window.requestAnimationFrame(function(){var newImgSrc,oldImgSrc;(scope.skipLazyLoading||isInView())&&(newImgSrc=_.memoize(imgSrcUrlForViewPort)(viewPort),oldImgSrc=element.attr("src"),newImgSrc!==oldImgSrc&&element.attr("src",newImgSrc))})}function imgSrcUrlForViewPort(viewPort){var currentViewPortSettings=_.find(_.propEq("viewPort",viewPort))(scope.imageVariants);return currentViewPortSettings.src}function isInView(){var top,bottom,windowBoundaries=(top=$window.pageYOffset,bottom=top+$window.innerHeight,{top:top,bottom:bottom}),elementBoundaries=function(element){var top=element.offset().top,bottom=top+element.height();return{top:top,bottom:bottom}}(element),windowBoundariesWithOffset={top:windowBoundaries.top+lazyLoadOptions.offsetTop,bottom:windowBoundaries.bottom+lazyLoadOptions.offsetBottom};return elementBoundaries.top<=windowBoundariesWithOffset.bottom&&elementBoundaries.bottom>=windowBoundariesWithOffset.top}scope.imageVariants=scope.$eval(attrs.imgVariants),addWindowEventListener("scroll",queueImageSrcUpdate),callback=_.pipe(function(viewPort){(function(viewPort){var retinaMediaQuery=interchangeQueries[buildRetinaViewPortKey(viewPort)];return $window.matchMedia(retinaMediaQuery).matches})(viewPort)&&(viewPort=buildRetinaViewPortKey(viewPort));return currentViewPort=viewPort},updateImageSrc),viewPorts.callbackForAny(callback),scope.$on("$destroy",function(){event="scroll",callback=queueImageSrcUpdate,$window.removeEventListener(event,callback);var event,callback});var callback})}};function addWindowEventListener(event,callback){$window.addEventListener(event,callback)}function runUpdateQueue(){updateShouldBeDone&&(_.forEach(_.call,imgSrcUpdateQueue),updateShouldBeDone=!1,imgSrcUpdateQueue=[])}function setUpdateFlagActive(){updateShouldBeDone=!0}function buildRetinaViewPortKey(viewPort){return viewPort+"_retina"}}angular.module("srg-play.features").value("imgSrcUpdateQueue",[]).directive("responsiveInterchange",lazyImageInterchange),lazyImageInterchange.$inject=["_","viewPorts","interchangeQueries","$window","$interval","imgSrcUpdateQueue"]}(),function(){angular.module("srg-play.features").component("srgImageZoom",{template:'\n            <div class="image-zoom">\n            <div class="image-zoom__shadow"></div>\n                <ng-transclude></ng-transclude>\n            </div>',transclude:!0,controller:[function(){}]})}(),function(){function keyCodeEvents(_,keys,keyCodeValidator){return{getScopeEventName:function(event){var triggeredKey=_.find(function(key){return keyCodeValidator.doesEventKeyCodeEqual(key.keyCode,event)})(_.values(keys));if(triggeredKey)return triggeredKey.eventName}}}angular.module("srg-play.features").factory("keyCodeEvents",keyCodeEvents),keyCodeEvents.$inject=["_","keys","keyCodeValidator"]}(),function(){angular.module("srg-play.features").factory("keyCodeValidator",function(){return{ARROW_UP:38,ARROW_DOWN:40,ESCAPE:27,doesEventKeyCodeEqual:function(keyCode,event){return event.keyCode===keyCode}}})}(),function(){function keys(keyCodeValidator){return{escapeKey:setupKey(keyCodeValidator.ESCAPE,"SRG_ESCAPE_KEYPRESS"),arrowUpKey:setupKey(keyCodeValidator.ARROW_UP,"SRG_ARROW_UP_KEYPRESS"),arrowDownKey:setupKey(keyCodeValidator.ARROW_DOWN,"SRG_ARROW_DOWN_KEYPRESS")};function setupKey(keyCode,eventName){return{keyCode:keyCode,eventName:eventName}}}angular.module("srg-play.features").factory("keys",keys),keys.$inject=["keyCodeValidator"]}(),angular.module("srg-play.features").service("Modernizr",["$window",function($window){return $window.Modernizr}]),function(){function Stickyfill($window){return $window.Stickyfill}angular.module("srg-play.features").factory("Stickyfill",Stickyfill),Stickyfill.$inject=["$window"]}(),angular.module("srg-play.features").service("ally",["$window",function($window){return $window.ally}]),function(){angular.module("srg-play.features").factory("angularElement",function(){return angular.element})}(),angular.module("srg-play.features").service("browserSupport",["$window",function($window){return $window.browserSupport}]),angular.module("srg-play.features").service("srgChartbeat",function(){return{virtualPage:function(url,title){if(window.pSUPERFLY)return window.pSUPERFLY.virtualPage(url,title)}}}),angular.module("srg-play.features").service("$",["$window",function($window){return $window.$}]),function(){function maRTSPlaylist($window){return{addToPlaylist:function(urn){return $window.MARTS_PLAYLIST&&$window.MARTS_PLAYLIST.addToPlaylist(urn)},addToDefaultPlaylist:function(urn){return $window.MARTS_PLAYLIST&&$window.MARTS_PLAYLIST.addToDefaultPlaylist(urn)}}}angular.module("srg-play.features").factory("maRTSPlaylist",maRTSPlaylist),maRTSPlaylist.$inject=["$window"]}(),function(){function moment($window){return $window.moment}angular.module("srg-play.features").factory("moment",moment),moment.$inject=["$window"]}(),function(){function ramda($window){return $window.R}angular.module("srg-play.features").factory("_",ramda),ramda.$inject=["$window"]}(),function(){angular.module("srg-play.features").factory("standardInterval",function(){return setInterval})}(),function(){var d,e,j,f,c,b;function surveyGizmo($window){return"function"==typeof $window.sg_beacon?$window.sg_beacon:function(){}}angular.module("srg-play.features").service("surveyGizmo",surveyGizmo),surveyGizmo.$inject=["$window"],d=window,e=document,j="script",f="sg_beacon",d.SurveyGizmoBeacon=f,d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},c=e.createElement(j),b=e.getElementsByTagName(j)[0],c.async=1,c.src="//d2bnxibecyz4h5.cloudfront.net/runtimejs/intercept/intercept.js",b.parentNode.insertBefore(c,b)}(),function(){function URI($window){return $window.URI}angular.module("srg-play.features").factory("URI",URI),URI.$inject=["$window"]}(),function(){function monthPicker(moment){return{restrict:"E",scope:{openHoverText:"@",closeHoverText:"@",nextYearHoverText:"@",previousYearHoverText:"@",initialTitle:"@",onMonthChange:"&onChange",onMonthSelect:"&onSelect"},template:'<div class="monthPicker" on-escape="isOpen = false;"><button id="srg_monthpicker_flyout_button"class="monthPicker__button" ng-attr-title="[{[ isOpen ? closeHoverText : openHoverText ]}]" ng-click="toggle()" ng-class="{ \'monthPicker__button--open\': isOpen }"><div class="iconImg iconImgArrow " ng-class="isOpen ? \'iconImgArrowUpSmall\' : \'iconImgArrowDownSmall\'"></div><div class="iconImg iconImgCalendar"></div><div class="monthPicker__title">[{[ title ]}]</div></button><div srg-flyout-is-visible="isOpen"srg-flyout-on-click-outside="toggle()"srg-flyout-toggle-button-id="srg_monthpicker_flyout_button"class="monthPickerFlyout" aria-live="polite" ng-show="isOpen"><div class="monthPickerFlyout__header"><button class="monthPickerFlyout__button monthPickerFlyout__previousYear" ng-click="previousYear()" title="[{[ previousYearHoverText ]}]"><span class="monthPickerFlyout__buttonContent"><span class="iconImg iconImgArrowLeftSmall"></span></span></button><div class="monthPickerFlyout__button monthPickerFlyout__button--selected monthPickerFlyout__selectedYear"><span class="monthPickerFlyout__buttonContent">[{[ visibleYear ]}]</span></div><button class="monthPickerFlyout__button monthPickerFlyout__nextYear" ng-if="isNextYearAvailable(visibleYear)" title="[{[ nextYearHoverText ]}]" ng-click="nextYear()"><span class="monthPickerFlyout__buttonContent"><span class="iconImg iconImgArrowRightSmall"></span></span></button><div class="monthPickerFlyout__button monthPickerFlyout__button--disabled monthPickerFlyout__nextYear" ng-if="!isNextYearAvailable(visibleYear)"><span class="monthPickerFlyout__buttonContent"><span class="iconImg iconImgArrowRightSmall"></span></span></div></div><ul class="monthPickerFlyout__body"><li ng-repeat="(index, month) in months" class="monthPickerFlyout__month"><button class="monthPickerFlyout__button" ng-class="{\'monthPickerFlyout__button--selected\': isSelectedMonth(index)}" ng-if="!isMonthInFuture(index)" ng-click="selectMonth(index, visibleYear)"><span class="monthPickerFlyout__buttonContent">[{[ ::month ]}]</span></button><div class="monthPickerFlyout__button monthPickerFlyout__button--disabled" ng-if="isMonthInFuture(index)"><span class="monthPickerFlyout__buttonContent">[{[ ::month ]}]</span></div></li></ul></div></div><div ng-show="isOpen" class="transparentPane monthPicker__transparentPane" ng-click="toggle()"></div>',link:function(scope,element,attrs){function monthTitle(index){return scope.months[index]}scope.isOpen=!1,scope.visibleYear=currentYear(),scope.lastSelectedYear=scope.visibleYear,scope.selectedMonth=currentMonth(),scope.months=scope.$eval(attrs.months),scope.toggle=function(){scope.isOpen=!scope.isOpen},scope.nextYear=function(){scope.visibleYear+=1},scope.previousYear=function(){scope.visibleYear-=1},scope.isNextYearAvailable=function(){return scope.visibleYear<currentYear()},scope.isMonthInFuture=function(month){return scope.visibleYear===currentYear()&&month>currentMonth()},scope.isSelectedMonth=function(month){return scope.lastSelectedYear===scope.visibleYear&&scope.selectedMonth===month},scope.updateTitle=function(title){scope.title=title||monthTitle(scope.selectedMonth)+" "+scope.lastSelectedYear,scope.onMonthChange({month:monthTitle(scope.selectedMonth)})},scope.selectMonth=function(month,year){scope.selectedMonth=month,scope.lastSelectedYear=year,scope.toggle(),scope.updateTitle(),scope.onMonthSelect({monthString:function(month,year){return moment().year(year).month(month).format("MM-YYYY")}(month,year)})},scope.updateTitle(scope.initialTitle)}};function currentYear(){return moment().year()}function currentMonth(){return moment().month()}}angular.module("srg-play.features").directive("monthPicker",monthPicker),monthPicker.$inject=["moment"]}(),function(){function pageContent(){return{restrict:"EA",template:pageContentTemplate,link:function(scope,element,attrs){function onNgIncludeEvent(eventName,callback){scope.$on(eventName,function(event,requestedUrl){requestedUrl===scope.srcUrl&&callback()})}scope.$watch(attrs.src,function(){scope.srcUrl=scope.$eval(attrs.src),scope.isContentLoading=!0,scope.hasContentLoadingFailed=!1}),onNgIncludeEvent("$includeContentError",function(){scope.isContentLoading=!1,scope.hasContentLoadingFailed=!0}),onNgIncludeEvent("$includeContentLoaded",function(){scope.isContentLoading=!1,scope.hasContentLoadingFailed=!1})}}}function pageContentTemplate(element,attrs){return'<ng-include src="srcUrl" ng-hide="isContentLoading"></ng-include><div class="loadingContainer loadingContainer--big" ng-activity-indicator="CircledGrey" skip-ng-show="yes" ng-show="isContentLoading"></div><div class="noContentMessage" ng-show="!isContentLoading && hasContentLoadingFailed">'+attrs.errorMessage+"</div>"}angular.module("srg-play.features").directive("pageContent",pageContent),pageContent.$inject=[]}(),function(){function keyup($document,keyCodeEvents){return{restrict:"A",link:function(scope){function broadcastScopeKeyupEvent(event){var scopeEvent=keyCodeEvents.getScopeEventName(event);scopeEvent&&scope.$broadcast(scopeEvent)}$document.on("keyup",broadcastScopeKeyupEvent),scope.$on("$destroy",function(){$document.off("keyup",broadcastScopeKeyupEvent)})}}}angular.module("srg-play.features").directive("keyup",keyup),keyup.$inject=["$document","keyCodeEvents"]}(),function(){function progressIndicator(videoHistory,PersonalizationSettings,maRtsInfo,$timeout){return{restrict:"A",scope:{assetId:"<",duration:"<"},link:function(scope,element,attrs){videoHistory.getEntry(scope.assetId).then(function(historyEntry){historyEntry&&historyEntry.position&&function(element,historyEntryPosition,duration){element.addClass("with-progress-indicator");var durationInSeconds=function(duration){var splitted=duration.split(":");return 60*splitted[0]+parseInt(splitted[1])}(duration),progress=function(position,duration){var percentage=Math.min(Math.ceil(100*position/duration),100);return 5*Math.round(percentage/5)}(parseFloat(historyEntryPosition),durationInSeconds);$timeout(function(){return element.addClass("progress-"+progress)})}(element,historyEntry.position,scope.duration)})}}}angular.module("srg-play.features").directive("progressIndicator",progressIndicator),progressIndicator.$inject=["videoHistory","PersonalizationSettings","maRtsInfo","$timeout"]}(),function(){function showOverflowText(viewPorts,$compile,$timeout,$location){var showMoreButton='<button ng-click="toggleOverflow()" class="overflow-show-more-button" ng-class="isOverflowVisible ? \'less\' : \'more\'">\n      <span>[{[(isOverflowVisible ? showMoreLessLabels.less : showMoreLessLabels.more)]}]</span>\n    </button>';return{restrict:"A",scope:{showMoreLessLabels:"<",bindContent:"="},link:function(scope,element,attrs){function expandDescriptionByParam(){var expandUrlParam=($location.search()||{}).expandDescription;"true"===expandUrlParam&&(scope.isOverflowVisible||toggleOverflow())}function viewportChangeHandler(){hideOverflow(),toggleHasOverflowClass()}function toggleHasOverflowClass(){element.toggleClass("has-overflow",element.prop("scrollHeight")>element.prop("offsetHeight"))}function toggleOverflow(){scope.isOverflowVisible=!scope.isOverflowVisible,element.toggleClass("overflow-visible",scope.isOverflowVisible)}function hideOverflow(){scope.isOverflowVisible=!1,element.removeClass("overflow-visible")}scope.isOverflowVisible=!1,scope.toggleOverflow=toggleOverflow,function(){element.addClass("overflow-container"),void 0!==attrs.bindContent&&(element.append($compile('<span ng-bind-html="bindContent"></span>')(scope)),scope.$watch("bindContent",function(newVal){hideOverflow(),$timeout(function(){toggleHasOverflowClass(),expandDescriptionByParam()})}));element.append($compile(showMoreButton)(scope)),toggleHasOverflowClass(),viewPorts.callbackForAny(viewportChangeHandler,function(){}),expandDescriptionByParam()}()}}}angular.module("srg-play.features").directive("showOverflowText",showOverflowText),showOverflowText.$inject=["viewPorts","$compile","$timeout","$location"]}(),function(){function srgStickyElement(Stickyfill,viewPorts,$timeout){return{link:function(scope,element,attrs){attrs.srgStickyOn&&(setStickinessOfElementInViewport(viewPorts.getCurrent()),viewPorts.callbackForAny(setStickinessOfElementInViewport,function(){}));function setStickinessOfElementInViewport(viewport){var domElement=element[0];!function(viewport){return attrs.srgStickyOn.split(" ").indexOf(viewport)>-1}(viewport)?Stickyfill.remove(domElement):(Stickyfill.add(domElement),$timeout(Stickyfill.rebuild,0))}},restrict:"A"}}angular.module("srg-play.features").directive("srgStickyElement",srgStickyElement),srgStickyElement.$inject=["Stickyfill","viewPorts","$timeout"]}(),function(){function storingJanitor(_,localStoreFactory,CookieStore,SRGConfig){return{cleanup:function(){_.pipe(getLocalStoreEntriesToDelete,_.forEach(deleteStoreEntry))(),_.pipe(getCookieEntriesToDelete,_.forEach(deleteCookie))()}};function getLocalStoreEntriesToDelete(){return getListFromMaintenanceConfig("localStoreToDelete")}function getCookieEntriesToDelete(){return getListFromMaintenanceConfig("cookiesToDelete")}function getListFromMaintenanceConfig(listName){return _.pathOr([],["sharedPortal","maintenance",listName],SRGConfig)}function deleteStoreEntry(key){localStoreFactory.deleteStoreEntry(key)}function deleteCookie(key){var cookie=new CookieStore(key);cookie.remove(),cookie=null}}angular.module("srg-play.features").factory("storingJanitor",storingJanitor),storingJanitor.$inject=["_","localStoreFactory","CookieStore","SRGConfig"]}(),function(){function CookieStore(CookieService){return function(key,value){return key=key||"",this.saveCookieValue=function(value){value&&CookieService.setCookieValue(key,value)},this.saveCookieObject=function(object,daysToExpiration){object&&CookieService.setCookieObject(key,object,daysToExpiration)},this.getCookieValue=function(){return CookieService.getCookieValue(key)},this.getCookieObject=function(){return CookieService.getCookieObject(key)},this.remove=function(){CookieService.remove(key)},"string"==typeof value?this.saveCookieValue(value):"object"===_typeof(value)&&this.saveCookieObject(value),this}}angular.module("srg-play.features").factory("CookieStore",CookieStore),CookieStore.$inject=["CookieService"]}(),function(){function localStoreFactory($localStorage){return{getStoreList:function(key){return $localStorage[key]=$localStorage[key]||[],$localStorage[key]},getStoreEntry:function(key){return $localStorage[key]=$localStorage[key]||{},$localStorage[key]},deleteStoreEntry:function(key){delete $localStorage[key]}}}angular.module("srg-play.features").factory("localStoreFactory",localStoreFactory),localStoreFactory.$inject=["$localStorage"]}(),function(){angular.module("srg-play.features").factory("localStoreKeys",function(){return{videoHistory:"playVHistory",showHistory:"playSHistory",userId:"playUserIdv2",personalizationSettings:"personalizationSettings",userSettings:"userSettings",abTests:"abTests",favShows:"favShows",generalInformationMessages:"generalInformationMessages",search:"search",watchLater:"watchLater"}})}(),function(){function URLParameterCookieStore(CookieStore,URLParameterStore){return function(key,value){this.urlStore=new URLParameterStore(key,value),this.cookieStore=new CookieStore(key,value);var urlValue=this.urlStore.getUrlValue(),cookieValue=this.cookieStore.getCookieValue();return urlValue&&urlValue!==cookieValue&&this.cookieStore.saveCookieValue(urlValue),this.save=function(value){this.cookieStore.saveCookieValue(value),this.urlStore.saveUrlValue(value)},this.get=function(){var urlValue=this.urlStore.getUrlValue();if(urlValue)return urlValue;var cookieValue=this.cookieStore.getCookieValue();return cookieValue||null},this.syncUrlParamIfEmpty=function(){var urlValue=this.urlStore.getUrlValue(),cookieValue=this.cookieStore.getCookieValue();!urlValue&&cookieValue&&this.urlStore.saveUrlValue(cookieValue)},this}}angular.module("srg-play.features").factory("URLParameterCookieStore",URLParameterCookieStore),URLParameterCookieStore.$inject=["CookieStore","URLParameterStore"]}(),function(){function URLParameterStore($location){return function(key,value){if(this.value=value,this.key=key,this.saveUrlValue=function(value){value&&($location.search(this.key,value).replace(),this.value=value)},this.getUrlValue=function(){return this.value=this.urlFromLocation(),this.value},this.urlFromLocation=function(){return $location.search()[this.key]},this.value)this.saveUrlValue(this.value);else{var urlValue=this.urlFromLocation();urlValue&&(this.value=urlValue)}return this}}angular.module("srg-play.features").factory("URLParameterStore",URLParameterStore),URLParameterStore.$inject=["$location"]}(),function(){function URLPathStore($location){var store={path:$location.path(),changeAndSavePath:function(path){path&&($location.path(path),store.path=path)},getUrlPath:function(){return store.path=$location.path(),store.path}};return store}angular.module("srg-play.features").factory("URLPathStore",URLPathStore),URLPathStore.$inject=["$location"]}(),function(){function teaserModule(){return{restrict:"E",scope:{src:"=",onLoad:"&",onError:"&"},template:teaserModuleTemplate,link:function(scope,element){scope.isContentLoading=!0,scope.$on("$includeContentRequested",function(){scope.isContentLoading=!0}),scope.$on("$includeContentLoaded",function(){scope.isContentLoading=!1,scope.onLoad(),element.show()}),scope.$on("$includeContentError",function(){scope.isContentLoading=!1,scope.onError(),element.hide()})}}}function teaserModuleTemplate(){return'<ng-include src="src" ng-hide="isContentLoading"></ng-include>'}angular.module("srg-play.features").directive("teaserModule",teaserModule),teaserModule.$inject=[]}(),function(){function tcEvents($window,$interval,SRGConfig){var eventQueue,availabilityChecker;return SRGConfig.isTcActive?function(event){isTcEventsDefined()?trackEvent(event):(!function(event){(eventQueue=eventQueue||[]).push(event)}(event),availabilityChecker=availabilityChecker||$interval(stopWhenTcEventsAvailable,300,100))}:function(){};function stopWhenTcEventsAvailable(){isTcEventsDefined()&&($interval.cancel(availabilityChecker),availabilityChecker=void 0,eventQueue.forEach(trackEvent),eventQueue=null)}function trackEvent(event){var eventCopy=angular.merge({},event);$window.tc_events_6.call(null,null,eventCopy.id,eventCopy.data)}function isTcEventsDefined(){return $window.tc_events_6 instanceof Function}}angular.module("srg-play.features").factory("tcEvents",tcEvents),tcEvents.$inject=["$window","$interval","SRGConfig"]}(),function(){function trackingPayloadGenerator(SRGConfig,_){var detailPageConfig=_.pathOr({},["sharedPortal","detailPage"],SRGConfig);return{addAssetDataToPayload:function(payloadContainer){var payload=payloadContainer||{};return function(payload){var topics=detailPageConfig.associatedTopicIds;topics&&topics.length>0&&(payload.topics=topics)}(payload),function(payload){var channels=detailPageConfig.associatedChannelIds;channels&&channels.length>0&&(payload.channelIds=channels)}(payload),function(payload){var showId=detailPageConfig.showId;showId&&(payload.assetGroupId=showId)}(payload),function(payload){var assetSubSetId=detailPageConfig.assetSubSetId;assetSubSetId&&(payload.assetSubSetId=assetSubSetId)}(payload),function(payload){var assetSetId=detailPageConfig.assetSetId;assetSetId&&(payload.assetSetId=assetSetId)}(payload),function(payload){var timestamp=detailPageConfig.assetSetPublishedDateTimestamp;timestamp&&(payload.publishedDate=1e3*timestamp)}(payload),payload}}}angular.module("srg-play.features").factory("trackingPayloadGenerator",trackingPayloadGenerator),trackingPayloadGenerator.$inject=["SRGConfig","_"]}(),angular.module("srg-play.features").filter("encodeURIComponent",function(){return window.encodeURIComponent}),function(){angular.module("srg-play.features").factory("SeoStringGenerator",function(){return function(){return this.getSeoString=function(stringToConvert){var convertedString=stringToConvert;return stringToConvert&&"string"==typeof stringToConvert?convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=(convertedString=convertedString.toLowerCase()).replace(/ - /g,"-")).replace(//g,"-")).replace(/ /g,"-")).replace(/\./g,"-")).replace(/~\\x{00a0}~siu/g,"-")).replace(//g,"ae")).replace(//g,"oe")).replace(//g,"ue")).replace(/[]/g,"e")).replace(/[]/g,"a")).replace(/[]/g,"u")).replace(/[]/g,"o")).replace(/[^a-zA-Z0-9\-_]*/g,"")).replace(/[\s\n\t]/g,"-"):"-"},this}})}(),function(){function UrlPatternResolver(SRGConfig,URI){return{resolveUrlPattern:function(urlType,replacerMap,additionalParams){var resolvedUrl,propertyValue,propertyName,urlMap=function(keys,patterns){var urls={};patterns.urlPattern&&(urls[keys.DETAIL]=patterns.urlPattern[keys.DETAIL],urls[keys.TOPICS]=patterns.urlPattern[keys.TOPICS],urls[keys.SHOWS_BY_DATE]=patterns.urlPattern[keys.SHOWS_BY_DATE],urls[keys.FAVOURITE_SHOWS]=patterns.urlPattern[keys.FAVOURITE_SHOWS],urls[keys.VIDEO_HISTORY_TODAY]=patterns.urlPattern[keys.VIDEO_HISTORY_TODAY],urls[keys.VIDEO_HISTORY_OLDER_THAN_ONE_DAY]=patterns.urlPattern[keys.VIDEO_HISTORY_OLDER_THAN_ONE_DAY],urls[keys.VIDEO_HISTORY_COMPLETE]=patterns.urlPattern[keys.VIDEO_HISTORY_COMPLETE],urls[keys.SEARCH_MEDIA]=patterns.urlPattern[keys.SEARCH_MEDIA],urls[keys.SEARCH_SHOWS]=patterns.urlPattern[keys.SEARCH_SHOWS],urls[keys.SEARCH_TRACK_SHOW_CLICK]=patterns.urlPattern[keys.SEARCH_TRACK_SHOW_CLICK],urls[keys.TV_SHOWS_SEARCH]=patterns.urlPattern[keys.TV_SHOWS_SEARCH],urls[keys.VIDEOS_SEARCH]=patterns.urlPattern[keys.VIDEOS_SEARCH],urls[keys.RADIO_SHOWS_SEARCH]=patterns.urlPattern[keys.RADIO_SHOWS_SEARCH],urls[keys.RADIO_SHOWS_A_TO_Z_LIST]=patterns.urlPattern[keys.RADIO_SHOWS_A_TO_Z_LIST],urls[keys.AUDIOS_SEARCH]=patterns.urlPattern[keys.AUDIOS_SEARCH],urls[keys.DETAIL_RELATIVE]=patterns.urlPattern[keys.DETAIL_RELATIVE],urls[keys.FACEBOOKSHARE]=patterns.urlPattern[keys.FACEBOOKSHARE],urls[keys.TWITTERSHARE]=patterns.urlPattern[keys.TWITTERSHARE],urls[keys.WHATSAPPSHARE]=patterns.urlPattern[keys.WHATSAPPSHARE],urls[keys.REDIRECT]=patterns.urlPattern[keys.REDIRECT],urls[keys.SHAREGET]=patterns.urlPattern[keys.SHAREGET],urls[keys.SHARECOUNT]=patterns.urlPattern[keys.SHARECOUNT],urls[keys.SOCIAL_SHARES]=patterns.urlPattern[keys.SOCIAL_SHARES],urls[keys.SOCIAL_LIKE_TRACKING]=patterns.urlPattern[keys.SOCIAL_LIKE_TRACKING],urls[keys.SOCIAL_SHARE_TRACKING]=patterns.urlPattern[keys.SOCIAL_SHARE_TRACKING],urls[keys.LIKECOUNT]=patterns.urlPattern[keys.LIKECOUNT],urls[keys.TRENDING_MODULE]=patterns.urlPattern[keys.TRENDING_MODULE],urls[keys.VIDEO_RECOMMENDATIONS_MODULE]=patterns.urlPattern[keys.VIDEO_RECOMMENDATIONS_MODULE],urls[keys.EMBEDPLAYERURL]=patterns.urlPattern[keys.EMBEDPLAYERURL],urls[keys.REMOTE_VIDEO_HISTORY]=patterns.urlPattern[keys.REMOTE_VIDEO_HISTORY],urls[keys.USER_SURVEY]=patterns.urlPattern[keys.USER_SURVEY],urls[keys.TOPICS_BY_USERID]=patterns.urlPattern[keys.TOPICS_BY_USERID],urls[keys.DATE_OF_LATEST_EPISODE]=patterns.urlPattern[keys.DATE_OF_LATEST_EPISODE]);return urls}(this,SRGConfig);if(void 0===urlMap[urlType])return;for(propertyName in resolvedUrl=urlMap[urlType],replacerMap)if(replacerMap.hasOwnProperty(propertyName))for(propertyValue=replacerMap[propertyName]||"";-1!==resolvedUrl.indexOf("["+propertyName+"]");)resolvedUrl=resolvedUrl.replace("["+propertyName+"]",propertyValue);if(string=resolvedUrl,-1!==string.indexOf("[")||-1!==string.indexOf("]"))return;var string;additionalParams&&(resolvedUrl=new URI(resolvedUrl).addQuery(additionalParams).toString());return resolvedUrl},DETAIL:"detail",DETAIL_RELATIVE:"detailRelative",TOPICS:"topicsListUrl",SHOWS_BY_DATE:"showsByDateUrl",FAVOURITE_SHOWS:"favouriteShowsUrl",SEARCH_MEDIA:"searchMedia",SEARCH_SHOWS:"searchShows",SEARCH_TRACK_SHOW_CLICK:"searchTrackShowClick",TV_SHOWS_SEARCH:"tvShowsSearch",VIDEOS_SEARCH:"videosSearch",RADIO_SHOWS_SEARCH:"radioShowsSearch",RADIO_SHOWS_A_TO_Z_LIST:"radioShowsAtoZList",AUDIOS_SEARCH:"audiosSearch",FACEBOOKSHARE:"facebookShare",TWITTERSHARE:"twitterShare",WHATSAPPSHARE:"whatsAppShare",REDIRECT:"redirect",SHAREGET:"sharecountGet",SHARECOUNT:"shareCount",SOCIAL_SHARES:"socialShares",SOCIAL_LIKE_TRACKING:"socialLikeTracking",SOCIAL_SHARE_TRACKING:"socialShareTracking",LIKECOUNT:"likeCount",TRENDING_MODULE:"trendingModuleByUserId",VIDEO_RECOMMENDATIONS_MODULE:"videoRecommendations",EMBEDPLAYERURL:"embedPlayerUrl",REMOTE_VIDEO_HISTORY:"remoteVideoHistory",USER_SURVEY:"userSurvey",TOPICS_BY_USERID:"topicsByUserIdUrl",DATE_OF_LATEST_EPISODE:"dateOfLatestEpisode"}}angular.module("srg-play.features").factory("UrlPatternResolver",UrlPatternResolver),UrlPatternResolver.$inject=["SRGConfig","URI"]}(),function(){angular.module("srg-play.features").factory("UrnIdExtractor",function(){return function(){return this.extractIdFromUrn=function(urn){return"string"!=typeof urn||urn.length<1?"":urn.substring(urn.lastIndexOf(":")+1)},this}})}(),function(){function userId(_,userIdEvents,localStoreFactory,localStoreKeys,GetRequestService,PersonalizationSettings,SRGConfig){var localUserIdStore,userIdResetWasInvoked=!1,userIdRefreshWasInvoked=!1;return PersonalizationSettings.isPersonalizationActive()&&(createLocalUserIdStore(),localUserIdStore.userId||generateNewUserId(),userIdEvents.onInvalidUserIdEvent(reset),userIdEvents.onExpiredUserIdEvent(refresh)),{get:get,reset:reset,refresh:refresh,destroy:function(){deleteLocalUserIdStore()}};function get(){if(localUserIdStore)return localUserIdStore.userId}function reset(){userIdResetWasInvoked||(resetUserIdStore(),generateNewUserId(),userIdResetWasInvoked=!0)}function refresh(){if(!userIdRefreshWasInvoked){var oldUserId=get();resetUserIdStore(),function(oldUserId){var url=function(oldUserId){var userIdConfig=["sharedPortal","personalization","userId"],servicePath=_.path(_.append("service",userIdConfig),SRGConfig),refreshPath=_.path(_.append("refreshId",userIdConfig),SRGConfig);if(servicePath&&refreshPath&&oldUserId)return servicePath+refreshPath+"/"+oldUserId}(oldUserId);if(!url)return;GetRequestService(url,handleUserIdResponse)}(oldUserId),userIdRefreshWasInvoked=!0}}function resetUserIdStore(){deleteLocalUserIdStore(),createLocalUserIdStore()}function createLocalUserIdStore(){localUserIdStore=localStoreFactory.getStoreEntry(localStoreKeys.userId)}function deleteLocalUserIdStore(){localStoreFactory.deleteStoreEntry(localStoreKeys.userId),localUserIdStore=null}function generateNewUserId(){var url=function(){var userIdConfig=["sharedPortal","personalization","userId"],servicePath=_.path(_.append("service",userIdConfig),SRGConfig),newIdPath=_.path(_.append("newId",userIdConfig),SRGConfig);if(servicePath&&newIdPath)return servicePath+newIdPath}();url&&GetRequestService(url,handleUserIdResponse)}function handleUserIdResponse(userId){localUserIdStore.userId=userId}}angular.module("srg-play.features").factory("userId",userId),userId.$inject=["_","userIdEvents","localStoreFactory","localStoreKeys","GetRequestService","PersonalizationSettings","SRGConfig"]}(),function(){function userIdEvents(_){var invalidUserIdCallbacks=[],expiredUserIdCallbacks=[];return{markUserIdInvalid:function(){_.forEach(_.call,invalidUserIdCallbacks)},markUserIdExpired:function(){_.forEach(_.call,expiredUserIdCallbacks)},onInvalidUserIdEvent:function(callback){invalidUserIdCallbacks.push(callback)},onExpiredUserIdEvent:function(callback){expiredUserIdCallbacks.push(callback)}}}angular.module("srg-play.features").factory("userIdEvents",userIdEvents),userIdEvents.$inject=["_"]}(),function(){function remoteVideoHistory(_,userId,postRequestService,UrlPatternResolver){return{add:function(entry){entry=entry||{};var uid=userId.get(),assetId=entry.id,eventData=entry.ev,progress=entry.vf,url=UrlPatternResolver.resolveUrlPattern(UrlPatternResolver.REMOTE_VIDEO_HISTORY,{id:assetId}),stringProps=[uid,url,eventData,assetId],numberProps=[progress],properties=_.concat(stringProps,numberProps);if(_.none(_.isNil,properties)&&_.all(_.length,stringProps)&&_.all(_.lt(0),numberProps)){var postBody={userId:uid,progress:progress,eventData:eventData};postRequestService(url,postBody)}}}}angular.module("srg-play.features").factory("remoteVideoHistory",remoteVideoHistory),remoteVideoHistory.$inject=["_","userId","postRequestService","UrlPatternResolver"]}(),function(){function videoHistory(_,localStoreKeys,localHistory,maRtsInfo,PersonalizationSettings,$q){var _localHistory=localHistory({localStoreKey:localStoreKeys.videoHistory,maxSavedEntries:100,propertyPicker:_.pick(["id","ts","vf","position"]),entryValidator:function(entry){return _.not(_.isNil(entry.id))&&_.not(_.isNil(entry.ts))&&_.not(_.isNil(entry.position))&&_.not(_.isNil(entry.vf))}});return{getEntry:function(assetId){if(PersonalizationSettings.isPersonalizationActive())return function(assetId){var entry=_localHistory.getEntry(assetId);return $q.resolve(entry)}(assetId);if(maRtsInfo.isLoggedIn())return function(assetId){return maRtsInfo.getPeachUserHistory().then(function(response){var rtsIdentifier="urn:rts:video:".concat(assetId),position=response.data?response.data[rtsIdentifier]:void 0;if(position)return{position:position}})}(assetId);return $q.resolve()},add:function(entry){return _localHistory.add(entry)},get:function(){return _localHistory.getHistory()},clean:function(){_localHistory.clean()},getEntrySync:_localHistory.getEntry}}angular.module("srg-play.features").factory("videoHistory",videoHistory),videoHistory.$inject=["_","localStoreKeys","localHistory","maRtsInfo","PersonalizationSettings","$q"]}(),function(){function videoHistoryUpdater(_,videoHistory,remoteVideoHistory,watchTimeObserver){var VIEW_FLAGS_PERCENTAGE=[1,10,20,40,60,80,99],mapOfIDsToViewFlagChangeTimeInSeconds={},timeWatchedInEarlierSessions=0,handleNewVideo=_.ifElse(function(video){return percentageWatched(video.watched,video.duration)>=VIEW_FLAGS_PERCENTAGE[0]},function(video){var entry={id:video.id,ts:Date.now(),vf:getViewFlag(video),position:video.currentTimeInSeconds,ev:video.eventData};memorizeTimeOfAViewFlagChange(entry.id,video.watched),videoHistory.add(entry),remoteVideoHistory.add(entry)},_.F),handleExistingVideo=_.pipe(function(video){return _.pipe(getHistoryEntryByVideo,function(oldEntry){var assetId=oldEntry.id;id=assetId,0===function(id){return mapOfIDsToViewFlagChangeTimeInSeconds[id]||0}(id)&&(percentage=oldEntry.vf,num=video.duration,timeWatchedInEarlierSessions=num/100*percentage||0);var percentage,num;var id;var viewFlagPassAt,updatedViewFlag=function(video){return getViewFlag({watched:video.watched+timeWatchedInEarlierSessions,duration:video.duration})}(video),didViewFlagChange=oldEntry.vf<updatedViewFlag;didViewFlagChange&&video.watched&&(viewFlagPassAt=video.watched,memorizeTimeOfAViewFlagChange(assetId,viewFlagPassAt));return{updatedEntry:{id:assetId,ts:Date.now(),vf:updatedViewFlag,position:video.currentTimeInSeconds,ev:video.eventData},didViewFlagChanged:didViewFlagChange}})(video)},function(entryContainer){entryContainer.didViewFlagChanged&&remoteVideoHistory.add(entryContainer.updatedEntry);return entryContainer},function(entryContainer){videoHistory.add(entryContainer.updatedEntry)}),getHistoryEntryByVideo=_.pipe(_.prop("id"),videoHistory.getEntrySync),handleOnWatchTimeUpdate=_.ifElse(getHistoryEntryByVideo,handleExistingVideo,handleNewVideo);return{startUpdatingHistory:function(){watchTimeObserver.onWatchTimeUpdate(handleOnWatchTimeUpdate)},stopUpdatingHistory:function(){watchTimeObserver.reset()}};function memorizeTimeOfAViewFlagChange(id,timeInSeconds){mapOfIDsToViewFlagChangeTimeInSeconds[id]=timeInSeconds}function getViewFlag(timeInfo){var per=percentageWatched(timeInfo.watched,timeInfo.duration);return _.pipe(_.always(VIEW_FLAGS_PERCENTAGE),_.takeWhile(function(viewflag){return per>=viewflag}),_.takeLast(1),_.find(function(viewflag){return viewflag>0}))()}function percentageWatched(amount,num){return amount/num*100}}angular.module("srg-play.features").factory("videoHistoryUpdater",videoHistoryUpdater),videoHistoryUpdater.$inject=["_","videoHistory","remoteVideoHistory","watchTimeObserver"]}(),angular.module("srg-play.features").component("srgViewStack",{controller:["$compile","$element","$timeout","$document","angularElement","viewStack",function($compile,$element,$timeout,$document,angularElement,viewStack){var vm=this;vm.$onInit=function(){viewStack.setController(vm),vm.views=[]},vm.push=function(view){validate(view)&&(compileAndShow(view),updateBodyScroll(),focusTopView())},vm.pop=function(){var view=vm.views.pop();hide(view),updateBodyScroll()},vm.clear=function(){var length=vm.views.length;vm.views.map(function(view,index){length===index+1?hide(view):removeFromDOM(view)}),vm.views=[],updateBodyScroll()};var compileAndShow=function(view){var template=templateFor(view),scope=view.scope.$new(!1);scope.closeDialog=closeDialog,scope.clear=vm.clear;var element=$compile(template)(scope);vm.views.push({element:element,scope:scope,template:view.template,isDialog:view.isDialog,previousFocus:getCurrentFocus()}),$element.append(element)},closeDialog=function(event){event.target.className.indexOf("view-stack-item")>-1&&viewStack.pop()},templateFor=function(view){return view.isDialog?'<div class="view-stack-item view-stack-item--dialog" ng-click="closeDialog($event)">'.concat(view.template,"</div>"):view.isSideNav?"".concat(isEmpty()?'<div class="view-stack-item__backdrop" ng-click="clear($event)" />':"",'\n                  <div class="view-stack-item view-stack-item--side-nav">').concat(view.template,"</div>"):'<div class="view-stack-item">'.concat(view.template,"</div>")},hide=function(view){view&&(view.isDialog?removeFromDOM(view):(view.element.addClass("view-stack-item--slide-out"),$timeout(function(){return removeFromDOM(view)},190)))},removeFromDOM=function(view){view.element.remove(),view.scope.$destroy(),view.previousFocus.focus()},updateBodyScroll=function(){var shouldLockBodyScroll=vm.views.length>0,body=angularElement($document[0].body);shouldLockBodyScroll?body.addClass("locked-body"):body.removeClass("locked-body")},validate=function(view){if(!(view&&view.template&&view.scope&&view.scope.$new))throw new Error("Items pushed to the viewStackComponent need a template and an AngularJS scope. Invalid view: \n'".concat(JSON.stringify(view),"'"));return isDifferentFromTopView(view.template)},isDifferentFromTopView=function(template){return template!==(getTopView()||{}).template},getTopView=function(){return vm.views[vm.views.length-1]},getCurrentFocus=function(){return angularElement($document[0].activeElement)},isEmpty=function(){return 0===vm.views.length},focusTopView=function(){var topView=getTopView();if(topView){var delay=topView.isDialog?0:190;$timeout(function(){topView.element.find('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])')[0].focus()},delay)}}}]}),function(){function viewStack(_){var initialized=!1,dialogOnTop=!1,controller={pushDialog:function(){},pushSideNav:function(){},push:function(){},pop:function(){},clear:function(){}};return{setController:function(newController){if(initialized)throw new Error("It is not allowed to set the view stack controller more than once.");controller=newController,initialized=!0},pushDialog:function(item){return function(item){if(dialogOnTop)return;dialogOnTop=!0,controller.push(item)}(_.merge(item,{isDialog:!0}))},pushSideNav:function(item){return push(_.merge(item,{isSideNav:!0}))},push:push,pop:function(){dialogOnTop=!1,controller.pop()},clear:function(){dialogOnTop=!1,controller.clear()}};function push(item){dialogOnTop||controller.push(_.merge(item,{isDialog:!1}))}}angular.module("srg-play.features").factory("viewStack",viewStack),viewStack.$inject=["_"]}(),function(){function personalizationRequestInterceptor(userIdEvents,$q){var USER_ID_EXPIRED_STATUS_CODE=202,USER_ID_INVALID_STATUS_CODE=402;return{response:function(response){responseHttpStatus=response.status,responseHttpStatus===USER_ID_EXPIRED_STATUS_CODE&&userIdEvents.markUserIdExpired();var responseHttpStatus;return response},responseError:function(error){responseHttpStatus=error.status,responseHttpStatus===USER_ID_INVALID_STATUS_CODE&&userIdEvents.markUserIdInvalid();var responseHttpStatus;return $q.reject(error)}}}angular.module("srg-play.features").factory("personalizationRequestInterceptor",personalizationRequestInterceptor),personalizationRequestInterceptor.$inject=["userIdEvents","$q"]}(),function(){function teaserScopeModelMakerFactory(_){return function(teaserLayout){var makeRowSeperator=function(subsequentModelId){return{id:subsequentModelId+"-break",class:"small-12 columns rowSeparator"}};return{convertToScopeModels:function(dto){var teaserList=(dto=dto||{}).teaserList||[],viewport=dto.viewport||"",startIndex=dto.startIndexForTeaserLayout||0;return _.addIndex(_.reduce)(function(scopeModels,teaser,teaserIndex){var index=startIndex+teaserIndex,model=_.merge(_.clone(teaser),function(index,viewport){return{type:teaserLayout.teaserTypeForIndexInViewport(index,viewport),class:teaserLayout.cssClassForTeaserAtIndex(index,viewport),width:teaserLayout.gridWidthForViewPortAtIndex(viewport,index)}}(index,viewport));return function(scopeModels,model){scopeModels.summarizedWidth=scopeModels.summarizedWidth||12,scopeModels.summarizedWidth>=12&&model.width<12&&(scopeModels.summarizedWidth=0,scopeModels.push(makeRowSeperator(model.id))),scopeModels.summarizedWidth+=model.width}(scopeModels,model),scopeModels.push(model),scopeModels})([],teaserList)}}}}angular.module("srg-play.features").factory("teaserScopeModelMakerFactory",teaserScopeModelMakerFactory),teaserScopeModelMakerFactory.$inject=["_"]}(),function(){function teaserLayoutFactory(_){return function($viewports){$viewports=$viewports||[];var defaultOrFallbackPageSize=_.propOr(5,"defaultPageSize"),defaultOrFallbackWidth=_.propOr(12,"teaserWidth"),defaultOrFallbackType=_.propOr("","defaultType"),itemFromList=_.curry(function(listname,index){var find=_.addIndex(_.find);return _.pipe(_.propOr([],listname),find(function(val,idx){return idx===index}))});return{firstPageSizeForViewPort:_.memoize(function(viewPortKey){var findPageSize=_.either(_.prop("firstPageSize"),defaultOrFallbackPageSize);return _.pipe(findViewport(viewPortKey),findPageSize)()}),defaultPageSizeForViewPort:_.memoize(function(viewPortKey){return _.pipe(findViewport(viewPortKey),defaultOrFallbackPageSize)()}),cssClassForTeaserAtIndex:_.memoize(function(index){return _.pipe(_.always($viewports),_.map(function(vpconf){return{width:findTeaserWidthAtIndex(index)(vpconf),name:vpconf.viewport}}),_.reduce(function(classString,viewport){return classString+viewport.name+"-"+viewport.width+" "})(""),_.flip(_.concat)("columns"))()}),teaserTypeForIndexInViewport:_.memoize(function(index,viewPortKey){return _.pipe(findViewport(viewPortKey),function(index){return _.either(itemFromList("types")(index),defaultOrFallbackType)}(index))()}),gridWidthForViewPortAtIndex:_.memoize(function(viewPortKey,index){return _.pipe(findViewport(viewPortKey),findTeaserWidthAtIndex(index))()})};function findViewport(vpname){return _.pipe(_.always($viewports),_.find(_.propEq("viewport",vpname)),_.defaultTo({}))}function findTeaserWidthAtIndex(index){return _.either(itemFromList("customTeaserWidths")(index),defaultOrFallbackWidth)}}}angular.module("srg-play.features").factory("teaserLayoutFactory",teaserLayoutFactory),teaserLayoutFactory.$inject=["_"]}();
//# sourceMappingURL=srg-play.f9118.js.map
